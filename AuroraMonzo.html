<!-- ===================== SECTION: Aurora Monzo Dashboard v1.5 (Pay-Period DDs + Flex + Total Due) ===================== -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Aurora Monzo Dashboard v1.5 ‚Äì Neon Blue + Coral Glow</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Orbitron:wght@500&display=swap" rel="stylesheet" />

<style>
:root {
  --bg-color:#05060a;
  --card-bg:rgba(255,255,255,0.05);
  --text-color:#ffffff;
  --glow-cyan:#00fff7;
  --glow-coral:#ff6f61;
}

/* === GLOBAL === */
body{margin:0;padding:0;font-family:'Inter',sans-serif;background:var(--bg-color);color:var(--text-color);overflow-x:hidden;}
h1,h2,h3{font-family:'Orbitron',sans-serif;text-transform:uppercase;letter-spacing:1px;}
.container{max-width:1100px;margin:auto;padding:20px;}

/* === HEADER === */
header{text-align:center;padding:25px 10px;
  background:linear-gradient(90deg,var(--glow-cyan),var(--glow-coral));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  animation:pulseGlow 4s ease-in-out infinite;}
@keyframes pulseGlow{
  0%,100%{text-shadow:0 0 10px var(--glow-coral),0 0 20px var(--glow-cyan);}
  50%{text-shadow:0 0 25px var(--glow-coral),0 0 35px var(--glow-cyan);}
}

/* === CARD DESIGN === */
.card{background:var(--card-bg);border-radius:14px;padding:18px 20px;margin-bottom:15px;
  box-shadow:0 0 15px rgba(0,255,247,0.08);backdrop-filter:blur(6px);
  transition:transform .25s ease,box-shadow .25s ease;}
.card:hover{transform:translateY(-2px);box-shadow:0 0 18px rgba(255,111,97,0.25);}

/* === CARD GLOW EFFECT (Soft Pulse for All Sections) === */
.card {
  background: var(--card-bg);
  border-radius: 14px;
  padding: 18px 20px;
  margin-bottom: 15px;
  box-shadow: 0 0 12px rgba(0,255,247,0.12),
              0 0 24px rgba(255,111,97,0.08);
  backdrop-filter: blur(6px);
  position: relative;
  transition: transform 0.25s ease, box-shadow 0.25s ease;
  animation: cardGlow 4s ease-in-out infinite alternate;
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 20px rgba(255,111,97,0.35),
              0 0 35px rgba(0,255,247,0.25);
}

@keyframes cardGlow {
  0% {
    box-shadow: 0 0 8px rgba(0,255,247,0.15),
                0 0 20px rgba(255,111,97,0.08);
  }
  50% {
    box-shadow: 0 0 14px rgba(0,255,247,0.25),
                0 0 35px rgba(255,111,97,0.15);
  }
  100% {
    box-shadow: 0 0 8px rgba(0,255,247,0.15),
                0 0 20px rgba(255,111,97,0.08);
  }
}

/* === PROGRESS BAR === */
.progress-container{background:rgba(255,255,255,0.08);border-radius:10px;height:14px;overflow:hidden;margin-top:6px;}
.progress-bar{height:100%;background:linear-gradient(90deg,var(--glow-cyan),var(--glow-coral));
  border-radius:10px;width:0;transition:width .8s ease-in-out;}

/* === POTS CAROUSEL (Refined Fit, Snap & Vertical Offset) === */
.pot-carousel {
  display: flex;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  scroll-behavior: smooth;
  gap: 80px;
  padding: 45px 0 30px 45px;  /* 10px top padding lowers cards inside */
  scroll-padding-left: 35px;
  -webkit-overflow-scrolling: touch;
}

.pot-card {
  flex: 0 0 80%;
  scroll-snap-align: start;
  background: rgba(255,255,255,0.05);
  border-radius: 14px;
  padding: 18px;
  text-align: center;
  margin-top: 10px;           /* üëà pushes the pot card downward inside section */
  box-shadow: 0 0 15px var(--glow-cyan);
  animation: potPulse 2s infinite alternate;
  transition: transform 0.3s ease;
}
/* === Smooth last-pot centering === */
.pot-carousel::after {
  content: "";
  flex: 0 0 20px; /* tweak width until last card centers */
}

.pot-card:hover { transform: scale(1.03); }

@keyframes potPulse {
  from { box-shadow: 0 0 15px var(--glow-cyan); }
  to   { box-shadow: 0 0 25px var(--glow-coral); }
}

@keyframes potPulse {
  from { box-shadow: 0 0 15px var(--glow-cyan); }
  to   { box-shadow: 0 0 25px var(--glow-coral); }
}

/* === RESPONSIVE (tightened mobile) === */
@media(max-width:600px){
  .container{padding:10px;}
  h1{font-size:1.4em;}
  .card{padding:12px 14px;margin-bottom:10px;}
  h2{font-size:1rem;margin-bottom:6px;}
  p,td,th{font-size:.9rem;}
  table{font-size:.85rem;}
  footer{font-size:.75em;padding:5px 0 8px 0;}
}
/* === CARD TEXT + TABLE CLEANUP (Aurora Neon Layout) === */

/* Consistent section headers */
.card h2 {
  font-size: 1.1rem;
  letter-spacing: 1.2px;
  color: var(--glow-cyan);
  margin-bottom: 10px;
  text-shadow: 0 0 8px rgba(0,255,247,0.5);
}

/* Improve paragraph spacing */
.card p {
  margin: 5px 0;
  line-height: 1.4em;
}

/* Table layout refinement */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 6px;
  font-size: 0.93rem;
  border-radius: 8px;
  overflow: hidden;
}

/* Header row style */
th {
  color: var(--glow-cyan);
  font-weight: 600;
  padding: 10px 8px;
  border-bottom: 1px solid rgba(255,255,255,0.08);
  text-align: left;
  text-shadow: 0 0 6px rgba(0,255,247,0.4);
}

/* Table rows: spacing + even row glow */
td {
  padding: 9px 8px;
  color: #e7e7e7;
  border-bottom: 1px solid rgba(255,255,255,0.03);
}

tr:nth-child(even) td {
  background: rgba(255,255,255,0.02);
}

tr:hover td {
  background: rgba(255,111,97,0.05);
  color: #fff;
  text-shadow: 0 0 8px rgba(255,111,97,0.3);
  transition: all 0.25s ease;
}

/* Direct Debits total row highlight */
#ddTable tr:last-child td {
  background: rgba(0,255,247,0.05);
  color: var(--glow-cyan);
  font-weight: 700;
  text-shadow: 0 0 10px rgba(0,255,247,0.4);
  border-top: 1px solid rgba(0,255,247,0.15);
}

/* Consistent glow around key data */
#recent-transactions td:nth-child(3),
#subscriptions td:nth-child(2),
#direct-debits td:nth-child(2) {
  color: var(--glow-coral);
  font-weight: 600;
  text-shadow: 0 0 8px rgba(255,111,97,0.3);
}
</style>
<!-- ===================== PART 2 START (BODY LAYOUT) ===================== -->
<body>
<header>
  <h1>Aurora Monzo Dashboard</h1>
  <h3>Live Data Sync ‚Äì Neon Blue + Coral Glow Edition</h3>
</header>

<div class="container">

  <!-- üè¶ MAIN ACCOUNT -->
  <section id="account-summary" class="card">
    <h2>üè¶ Main Account</h2>
    <p><strong>Balance:</strong> ¬£<span id="mainBalance">0.00</span></p>
    <p><strong>Payday:</strong> <span id="payday">‚Äì</span> (Received ¬£<span id="payReceived">0.00</span>)</p>
  </section>

  <!-- üïì DAILY SPENDING TRACKER -->
  <section id="daily-tracker" class="card">
    <h2>üïì Daily Spending Tracker</h2>
    <p><strong>Today‚Äôs Spend:</strong> ¬£<span id="todaySpend">0.00</span></p>
    <div class="progress-container">
      <div id="dailyBar" class="progress-bar"></div>
    </div>
    <p><small><span id="remainingText">Remaining: ¬£0.00</span></small></p>
    <p><small id="weeklyOverview">Week total: ¬£0.00 / ¬£0.00</small></p>
  </section>

  <!-- üí≥ FLEX SUMMARY -->
  <section id="flex-summary" class="card">
    <h2>üí≥ Flex Summary</h2>
    <p><strong>Total Balance:</strong> ¬£<span id="flexBalance">0.00</span></p>
    <p><strong>Next Payment:</strong> ¬£419.00 on 2025-12-01</p>
  </section>

  <!-- üí∞ POTS CAROUSEL -->
  <section id="pots-section" class="card">
    <h2>üí∞ Pots Overview</h2>
    <div class="pot-carousel" id="potCarousel"></div>
  </section>

  <!-- üíº WORK TRACKER -->
  <section id="work-tracker" class="card">
    <h2>üíº Work Spending Tracker</h2>
    <p><strong>This week‚Äôs work spend:</strong> ¬£<span id="workSpend">0.00</span></p>
    <p id="workTransferStatus">Auto-transfer scheduled: Friday 08:00</p>
  </section>

  <!-- üîÅ DIRECT DEBITS -->
  <section id="direct-debits" class="card">
    <h2>üîÅ Direct Debits</h2>
    <table id="ddTable">
      <thead>
        <tr><th>Payee</th><th>Amount (¬£)</th><th>Due Date</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- üì± SUBSCRIPTIONS -->
  <section id="subscriptions" class="card">
    <h2>üì± Subscriptions</h2>
    <table id="subTable">
      <thead>
        <tr><th>Service</th><th>Amount (¬£)</th><th>Renewal Date</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

 <!-- üßæ RECENT TRANSACTIONS -->
  <section id="recent-transactions" class="card">
    <h2>üßæ Recent Transactions</h2>
    <table id="txnTable">
      <thead>
        <tr><th>Date</th><th>Merchant</th><th>Amount (¬£)</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

</div>

<!-- üü¢ CONNECTED FOOTER -->
<footer>
  <span id="syncStatus">üü¢ Connected ‚Äì Live Sync Active</span>
</footer>
<!-- ===================== PART 2 END / PART 3 START ===================== -->
<!-- ===================== PART 3-1 START (Setup + Fetch) ===================== -->
<script>
async function loadAuroraMonzo() {
  const status = document.getElementById("syncStatus");
  const monzoJSON =
    "https://raw.githubusercontent.com/webbchrisuk-max/Aurora/refs/heads/main/AuroraMonzo.json";

  try {
    const res = await fetch(monzoJSON + "?nocache=" + Date.now());
    if (!res.ok) throw new Error("HTTP " + res.status);
    const data = await res.json();

    /* --- Core account objects --- */
    const core = data.monzo.account_core;
    const pots = core.pots || {};
    const dd = data.monzo.direct_debits || [];
    const subs = data.monzo.subscriptions_from_main || [];
    const txns = data.monzo.transactions_feed?.recent || [];

    /* --- Update account and flex cards --- */
    document.getElementById("mainBalance").textContent =
      core.main_balance.toFixed(2);
    document.getElementById("payday").textContent = core.payday_last || "‚Äî";
    document.getElementById("payReceived").textContent =
      core.income_received?.toFixed(2) || "0.00";
    document.getElementById("flexBalance").textContent = (
      pots["Flex Repayment"] || 0
    ).toFixed(2);

    /* --- Determine current week window (Friday ‚Üí Thursday) --- */
    const today = new Date();
    const weekday = today.getDay(); // 0=Sun ‚Ä¶ 6=Sat
    let lastFriday = new Date(today);
    const offset = weekday >= 5 ? weekday - 5 : 7 - (5 - weekday);
    lastFriday.setDate(today.getDate() - offset);
    if (weekday === 5) lastFriday = new Date(today);
    const nextFriday = new Date(lastFriday);
    nextFriday.setDate(lastFriday.getDate() + 7);

    const weeklyLimit = core.main_balance / 4; // dynamic weekly limit
    const dailyAllowance = weeklyLimit / 7;
    /* ===================== PART 3-2 START (Daily & Weekly Tracker + UK-Date Parser) ===================== */

/* ---------- Sum of today's and this week's spend (UK-format safe) ---------- */
let todaySpend = 0,
  weekSpend = 0;

function parseUKDate(str) {
  if (!str) return null;
  // expect "dd/mm/yyyy" or "dd/mm/yyyy hh:mm:ss"
  const parts = str.split(/[ /:]/); // ["08","11","2025","09","33","04"]
  if (parts.length < 3) return null;
  const [d, m, y] = parts;
  const hh = parts[3] || 0,
    mm = parts[4] || 0,
    ss = parts[5] || 0;
  return new Date(y, m - 1, d, hh, mm, ss);
}

txns.forEach((tx) => {
  const raw = tx.Date || tx.date;
  const txDate = parseUKDate(raw);
  const amt = parseFloat(tx["Amount (¬£)"] || tx.amount || 0);
  if (!txDate || !amt) return;

  if (txDate.toDateString() === today.toDateString()) todaySpend += amt;
  if (txDate >= lastFriday && txDate < nextFriday) weekSpend += amt;
});

const remainingToday = Math.max(dailyAllowance - todaySpend, 0);
const pctUsed = Math.min((todaySpend / dailyAllowance) * 100, 100);

document.getElementById("todaySpend").textContent = todaySpend.toFixed(2);
document.getElementById(
  "remainingText"
).textContent = `Remaining: ¬£${remainingToday.toFixed(2)}`;
document.getElementById(
  "weeklyOverview"
).textContent = `Week total: ¬£${weekSpend.toFixed(2)} / ¬£${weeklyLimit.toFixed(
  2
)}`;
document.getElementById("dailyBar").style.width = 100 - pctUsed + "%";

/* ===================== PART 3-2 END / PART 3-3 START ===================== */
/* ===================== PART 3-3 START (Work + DD + Pots + Footer) ===================== */

/* ---------- Work Spending Tracker ---------- */
let workSpend = 0;
txns.forEach((tx) => {
  const cat = (tx.Category || tx.category || "").toLowerCase();
  const date = parseUKDate(tx.Date || tx.date);
  const amt = parseFloat(tx["Amount (¬£)"] || tx.amount || 0);
  if (cat === "work" && date >= lastFriday && date < nextFriday) workSpend += amt;
});
document.getElementById("workSpend").textContent = workSpend.toFixed(2);

const now = new Date();
const nextTransfer = new Date(lastFriday);
nextTransfer.setDate(lastFriday.getDate() + 7);
nextTransfer.setHours(8, 0, 0, 0);

const statusEl = document.getElementById("workTransferStatus");
if (now.getDay() === 5 && now.getHours() >= 8) {
  statusEl.innerHTML = "‚úÖ Transfer completed";
  statusEl.style.color = "var(--glow-cyan)";
} else if (nextTransfer - now < 24 * 60 * 60 * 1000) {
  statusEl.innerHTML = "‚ö†Ô∏è Transfer due soon (Fri 08:00)";
  statusEl.style.color = "var(--glow-coral)";
} else {
  statusEl.innerHTML = "Auto-transfer scheduled: Friday 08:00";
  statusEl.style.color = "";
}

/* ---------- Direct Debits (filtered + total) ---------- */
const ddBody = document.querySelector("#ddTable tbody");
ddBody.innerHTML = "";

const start = new Date(core.payday_last);
start.setHours(0, 0, 0, 0);
const end = new Date(start);
end.setDate(start.getDate() + 28);
end.setHours(23, 59, 59, 999);

const ddInWindow = dd
  .map((e) => ({ ...e, dateObj: new Date(e.due_date) }))
  .filter((e) => e.dateObj >= start && e.dateObj <= end)
  .sort((a, b) => a.dateObj - b.dateObj);

let totalDue = 0;
if (ddInWindow.length === 0) {
  const row = document.createElement("tr");
  row.innerHTML =
    '<td colspan="3" style="text-align:center;color:#888;">No direct debits left before payday</td>';
  ddBody.appendChild(row);
} else {
  ddInWindow.forEach((item) => {
    totalDue += item.amount;
    const row = document.createElement("tr");
    row.innerHTML = `<td>${item.payee}</td><td>${item.amount.toFixed(
      2
    )}</td><td>${item.due_date}</td>`;
    ddBody.appendChild(row);
  });

  const totalRow = document.createElement("tr");
  totalRow.innerHTML = `<td><strong>Total Due Before Payday</strong></td><td colspan="2"><strong>¬£${totalDue.toFixed(
    2
  )}</strong></td>`;
  totalRow.style.borderTop = "1px solid rgba(255,255,255,0.1)";
  totalRow.style.color = "var(--glow-cyan)";
  ddBody.appendChild(totalRow);
}

/* ---------- Subscriptions ---------- */
const subBody = document.querySelector("#subTable tbody");
subBody.innerHTML = "";
subs.forEach((item) => {
  const row = document.createElement("tr");
  row.innerHTML = `<td>${item.service}</td><td>${item.amount.toFixed(
    2
  )}</td><td>${item.renewal_date}</td>`;
  subBody.appendChild(row);
});

/* ---------- Recent Transactions ---------- */
const txnBody = document.querySelector("#txnTable tbody");
txnBody.innerHTML = "";
txns.slice(0, 5).forEach((tx) => {
  const date = tx.Date || tx.date || "‚Äî";
  const name = tx.Name || tx.merchant || "Unknown";
  const amt = parseFloat(tx["Amount (¬£)"] || tx.amount || 0);
  const r = document.createElement("tr");
  r.innerHTML = `<td>${date}</td><td>${name}</td><td>${amt.toFixed(2)}</td>`;
  txnBody.appendChild(r);
});

/* ---------- Render Pots Carousel ---------- */
renderPotCarousel(pots);

/* ---------- Pots Carousel ---------- */
function renderPotCarousel(pots) {
  const carousel = document.getElementById("potCarousel");
  carousel.innerHTML = "";
  const goals = {
    "Flex Repayment": 419,
    "Direct Debits": 416,
    Holiday: 800,
    "Coventry City FC": 500,
    IGTrading: 400,
    "Car Maintenance": 400,
    "Work Buffer": 65,
    Savings: 1000,
  };
  Object.entries(pots).forEach(([name, balance]) => {
    if (name === "Flex Repayment") return;
    const goal = goals[name] || 500;
    const pct = Math.min((balance / goal) * 100, 100).toFixed(1);
    const card = document.createElement("div");
    card.className = "pot-card";
    card.innerHTML = `
      <h3>${name}</h3>
      <p>¬£${balance.toFixed(2)} / ¬£${goal}</p>
      <div class="progress-container">
        <div class="progress-bar" style="width:${pct}%"></div>
      </div>`;
    carousel.appendChild(card);
  });
}

/* ---------- Sync Indicator ---------- */
status.innerHTML = "üü¢ Connected ‚Äì Live Sync Active";
status.style.animationPlayState = "running";
} catch (err) {
  console.error("‚ùå Aurora Monzo load error:", err);
  const status = document.getElementById("syncStatus");
  status.innerHTML = "üî¥ Disconnected ‚Äì Retrying‚Ä¶";
  status.style.color = "#ff6666";
  status.style.textShadow = "0 0 8px #ff4444";
  status.style.animationPlayState = "paused";
}
}

/* ---------- Initialise ---------- */
document.addEventListener("DOMContentLoaded", loadAuroraMonzo);
</script>
<!-- ===================== PART 3-3 END / PART 4 START ===================== -->
<!-- ===================== PART 4 START (Closing Section) ===================== -->
</body>
</html>
<!-- ===================== END: Aurora Monzo Dashboard v1.5 ‚Äì Stable Edition ===================== -->
