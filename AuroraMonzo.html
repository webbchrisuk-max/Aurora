<!-- ===================== SECTION: Aurora Monzo Dashboard v1.4 (Manual Pot Carousel + 4-Weekly Payday + DD Filter) ===================== -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aurora Monzo Dashboard v1.4 ‚Äì Neon Blue + Coral Glow</title>

<!-- ===================== SECTION: FONTS & BASE ===================== -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Orbitron:wght@500&display=swap" rel="stylesheet" />

<style>
:root {
  --bg-color: #05060a;
  --card-bg: rgba(255,255,255,0.05);
  --text-color: #ffffff;
  --glow-cyan: #00fff7;
  --glow-coral: #ff6f61;
}

/* ===================== SECTION: GLOBAL ===================== */
body{
  margin:0;
  padding:0;
  font-family:'Inter',sans-serif;
  color:var(--text-color);
  overflow-x:hidden;
  min-height:100vh;
  position:relative;
}
body::before{
  content:"";
  position:fixed;
  top:0;left:0;right:0;bottom:0;
  z-index:-1;
  background:radial-gradient(circle at top right,#05060a 0%,#090d16 70%);
  animation:auroraPulse 18s ease-in-out infinite alternate;
  background-attachment:fixed;
  will-change:background;
}
@keyframes auroraPulse{
  0%{background:radial-gradient(circle at top right,#05060a 0%,#090d16 70%);}
  100%{background:radial-gradient(circle at bottom left,#0b1020 0%,#04060a 80%);}
}

h1,h2,h3{
  font-family:'Orbitron',sans-serif;
  text-transform:uppercase;
  letter-spacing:1px;
}

.container{max-width:1100px;margin:auto;padding:20px;}

/* ===================== SECTION: HEADER ===================== */
header{
  text-align:center;
  padding:25px 10px;
  background:linear-gradient(90deg,var(--glow-cyan),var(--glow-coral));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  animation:pulseGlow 4s ease-in-out infinite;
}
@keyframes pulseGlow{
  0%,100%{text-shadow:0 0 10px var(--glow-coral),0 0 20px var(--glow-cyan);}
  50%{text-shadow:0 0 25px var(--glow-coral),0 0 35px var(--glow-cyan);}
}

/* ===================== SECTION: CARD DESIGN ===================== */
.card{
  background:var(--card-bg);
  border-radius:14px;
  padding:18px 20px;
  margin-bottom:15px;
  box-shadow:0 0 15px rgba(0,255,247,0.08);
  backdrop-filter:blur(6px);
  transition:transform .25s ease,box-shadow .25s ease;
}
.card:hover{transform:translateY(-2px);box-shadow:0 0 18px rgba(255,111,97,0.25);}

/* ===================== SECTION: POT CAROUSEL (MANUAL SCROLL) ===================== */
.pot-carousel{
  display:flex;
  overflow-x:auto;
  scroll-snap-type:x mandatory;
  gap:20px;
  padding:10px 0 20px 0;
  -webkit-overflow-scrolling:touch;
  scrollbar-width:none;
}
.pot-carousel::-webkit-scrollbar{display:none;}

.pot-card{
  flex:0 0 85%;
  scroll-snap-align:center;
  background:rgba(255,255,255,0.05);
  border-radius:14px;
  padding:20px;
  text-align:center;
  box-shadow:0 0 15px var(--glow-cyan);
  animation:potPulse 2s infinite alternate;
  transition:transform 0.3s ease;
}
.pot-card:hover{transform:scale(1.03);}
@keyframes potPulse{from{box-shadow:0 0 15px var(--glow-cyan);}to{box-shadow:0 0 25px var(--glow-coral);}}
.pot-card h3{color:var(--glow-coral);text-shadow:0 0 8px var(--glow-coral);}
.pot-progress{height:10px;border-radius:8px;background:rgba(255,255,255,0.1);margin-top:10px;overflow:hidden;}
.pot-fill{height:100%;background:linear-gradient(90deg,var(--glow-cyan),var(--glow-coral));border-radius:8px;transition:width .8s ease-in-out;}

/* ===================== SECTION: TABLES ===================== */
table{width:100%;border-collapse:collapse;margin-top:10px;font-size:.95rem;}
th,td{text-align:left;padding:8px;}
th{color:var(--glow-cyan);border-bottom:1px solid rgba(255,255,255,0.1);}
tr:nth-child(even){background:rgba(255,255,255,0.03);}

/* ===================== SECTION: RESPONSIVE ===================== */
@media(max-width:600px){.container{padding:10px;}h1{font-size:1.4em;}}
</style>
</head>

<body>
<!-- ===================== SECTION: HEADER ===================== -->
<header>
  <h1>Aurora Monzo Dashboard</h1>
  <h3>Live Data Sync ‚Äì Neon Blue + Coral Glow Edition</h3>
</header>

<!-- ===================== SECTION: MAIN ===================== -->
<div class="container">

  <!-- ===================== SECTION: ACCOUNT SUMMARY ===================== -->
  <section id="account-summary" class="card">
    <h2>üè¶ Main Account</h2>
    <p><strong>Balance:</strong> ¬£<span id="mainBalance">0.00</span></p>
    <p>
      <strong>Payday (last):</strong> <span id="paydayLast">‚Äì</span> &nbsp;‚Ä¢&nbsp;
      <strong>Payday (next 4-weekly):</strong> <span id="paydayNext">‚Äì</span>
    </p>
    <p><strong>Income received:</strong> ¬£<span id="payReceived">0.00</span></p>
    <p id="payPeriodNote" style="opacity:.8;font-size:.9rem;"></p>
  </section>

  <!-- ===================== SECTION: FLEX SUMMARY ===================== -->
  <section id="flex-summary" class="card">
    <h2>üí≥ Flex Summary</h2>
    <p><strong>Total Balance:</strong> ¬£<span id="flexBalance">0.00</span></p>
    <p><strong>Next Payment:</strong> ¬£419.00 on 2025-12-01</p>
  </section>

  <!-- ===================== SECTION: POTS CAROUSEL ===================== -->
  <section id="pots-section" class="card">
    <h2>üí∞ Pots Overview</h2>
    <div class="pot-carousel" id="potCarousel"></div>
  </section>

  <!-- ===================== SECTION: DIRECT DEBITS ===================== -->
  <section id="direct-debits" class="card">
    <h2>üîÅ Direct Debits (up to next payday)</h2>
    <table id="ddTable">
      <thead><tr><th>Payee</th><th>Amount (¬£)</th><th>Due Date</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- ===================== SECTION: SUBSCRIPTIONS ===================== -->
  <section id="subscriptions" class="card">
    <h2>üì± Subscriptions</h2>
    <table id="subTable">
      <thead><tr><th>Service</th><th>Amount (¬£)</th><th>Renewal Date</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- ===================== SECTION: RECENT TRANSACTIONS ===================== -->
  <section id="recent-transactions" class="card">
    <h2>üßæ Recent Transactions</h2>
    <table id="txnTable">
      <thead><tr><th>Date</th><th>Merchant</th><th>Amount (¬£)</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <footer style="text-align:center;margin-top:25px;color:#aaa;font-size:.85em;">
    <span id="lastUpdated">Loading data‚Ä¶</span>
  </footer>
</div>

<!-- ===================== SECTION: SCRIPT ===================== -->
<script>
/* ---------- Helpers ---------- */
function addDays(d, days){ const r=new Date(d); r.setDate(r.getDate()+days); return r; }
function formatISO(d){ return d.toISOString().split('T')[0]; }

/* Compute the next 4-weekly payday from the last payday */
function computeNextPayday28(lastPaydayISO) {
  const today = new Date(); today.setHours(0,0,0,0);
  let next = new Date(lastPaydayISO);
  next.setHours(0,0,0,0);
  // add +28 days repeatedly until strictly AFTER today
  while (next <= today) next = addDays(next, 28);
  return next;
}

async function loadAuroraMonzo(){
  const status=document.getElementById("lastUpdated");
  const monzoJSON="https://raw.githubusercontent.com/webbchrisuk-max/Aurora/refs/heads/main/AuroraMonzo.json";
  try{
    const res=await fetch(monzoJSON+"?nocache="+Date.now());
    if(!res.ok)throw new Error("HTTP "+res.status);
    const data=await res.json();

    const core=data.monzo.account_core;
    const pots=core.pots||{};
    const dd=data.monzo.direct_debits||[];
    const subs=data.monzo.subscriptions_from_main||[];
    const txns=data.transactions_feed?.recent||[];

    // ---- Account summary + payday logic (4-weekly) ----
    const lastPaydayISO = core.payday_last;               // e.g., "2025-11-07"
    const nextPaydayDate = computeNextPayday28(lastPaydayISO);
    const nextPaydayISO = formatISO(nextPaydayDate);

    document.getElementById("mainBalance").textContent=core.main_balance.toFixed(2);
    document.getElementById("paydayLast").textContent=lastPaydayISO;
    document.getElementById("paydayNext").textContent=nextPaydayISO;
    document.getElementById("payReceived").textContent=core.income_received.toFixed(2);

    // Pay period info line
    const note = `Current pay period: ${lastPaydayISO} ‚Üí ${nextPaydayISO} (4-weekly cycle)`;
    document.getElementById("payPeriodNote").textContent = note;

    // ---- Direct Debits (filtered up to next payday) ----
    const ddBody=document.querySelector("#ddTable tbody");
    ddBody.innerHTML="";
    const nextPayday = new Date(nextPaydayISO);
    const upcomingDDs = dd
      .map(e => ({...e, _due: new Date(e.due_date)}))
      .filter(e => e._due <= nextPayday)
      .sort((a,b)=>a._due - b._due);

    if (upcomingDDs.length === 0) {
      const row=document.createElement("tr");
      row.innerHTML = `<td colspan="3" style="text-align:center;color:#888;">No direct debits due before next payday</td>`;
      ddBody.appendChild(row);
    } else {
      upcomingDDs.forEach(e=>{
        const r=document.createElement("tr");
        r.innerHTML=`<td>${e.payee}</td><td>${e.amount.toFixed(2)}</td><td>${e.due_date}</td>`;
        ddBody.appendChild(r);
      });
    }

    // ---- Subscriptions (unchanged) ----
    const subBody=document.querySelector("#subTable tbody");
    subBody.innerHTML="";
    subs.forEach(i=>{
      const r=document.createElement("tr");
      r.innerHTML=`<td>${i.service}</td><td>${i.amount.toFixed(2)}</td><td>${i.renewal_date}</td>`;
      subBody.appendChild(r);
    });

    // ---- Transactions (matches your keys) ----
    const txnBody=document.querySelector("#txnTable tbody");
    txnBody.innerHTML="";
    if(!Array.isArray(txns) || txns.length===0){
      const row=document.createElement("tr");
      row.innerHTML=`<td colspan="3" style="text-align:center;color:#888;">No recent transactions available</td>`;
      txnBody.appendChild(row);
    }else{
      txns.slice(0,5).forEach(tx=>{
        const date=tx["Date"]||"‚Äî";
        const merchant=tx["Name"]||"Unknown";
        const amountStr=tx["Amount (¬£)"]||"0.00";
        const amount=parseFloat(amountStr.replace(/[^\d.-]/g,""))||0;
        const r=document.createElement("tr");
        r.innerHTML=`<td>${date}</td><td>${merchant}</td><td>${amount.toFixed(2)}</td>`;
        txnBody.appendChild(r);
      });
    }

    // ---- Pots (manual carousel) ----
    renderPotCarousel(pots);

    status.textContent="‚úÖ Data loaded ‚Äì "+new Date().toLocaleString();
  }catch(err){
    console.error("‚ùå Aurora Monzo load error:",err);
    status.textContent="‚ùå Failed to load Monzo data: "+err.message;
  }
}

/* ===================== SECTION: POT CAROUSEL RENDER ===================== */
function renderPotCarousel(pots){
  const carousel=document.getElementById("potCarousel");
  carousel.innerHTML="";
  const goals={
    "Flex Repayment":419,"Direct Debits":416,"Holiday":800,
    "Coventry City FC":500,"IGTrading":400,"Car Maintenance":400,
    "Work Buffer":65,"Christmas":300,"Savings":1000
  };

  Object.entries(pots).forEach(([name,balance])=>{
    // Show all pots, including Flex Repayment here if you want; remove this if you want to hide.
    const goal=goals[name]||500;
    const pct=Math.min((balance/goal)*100,100).toFixed(1);
    const card=document.createElement("div");
    card.className="pot-card";
    card.innerHTML=`
      <h3>${name}</h3>
      <p>¬£${Number(balance).toFixed(2)} / ¬£${goal}</p>
      <div class="pot-progress"><div class="pot-fill" style="width:${pct}%"></div></div>`;
    carousel.appendChild(card);
  });
}

document.addEventListener("DOMContentLoaded",loadAuroraMonzo);
</script>
</body>
</html>
<!-- ===================== END: Aurora Monzo Dashboard v1.4 (Manual Pot Carousel + 4-Weekly Payday + DD Filter) ===================== -->
