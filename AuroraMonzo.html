<!-- ===================== SECTION: Aurora Monzo Dashboard v1.4 (4-Weekly Payday + Direct Debits in Pay Period + Flex Restored) ===================== -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Aurora Monzo Dashboard v1.4 ‚Äì Neon Blue + Coral Glow</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Orbitron:wght@500&display=swap" rel="stylesheet" />

<style>
:root {
  --bg-color:#05060a;
  --card-bg:rgba(255,255,255,0.05);
  --text-color:#fff;
  --glow-cyan:#00fff7;
  --glow-coral:#ff6f61;
}
body{margin:0;padding:0;font-family:'Inter',sans-serif;color:var(--text-color);background:var(--bg-color);overflow-x:hidden;}
header{text-align:center;padding:25px 10px;background:linear-gradient(90deg,var(--glow-cyan),var(--glow-coral));-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:pulse 4s ease-in-out infinite;}
@keyframes pulse{0%,100%{text-shadow:0 0 10px var(--glow-coral),0 0 20px var(--glow-cyan);}50%{text-shadow:0 0 25px var(--glow-coral),0 0 35px var(--glow-cyan);}}
.container{max-width:1100px;margin:auto;padding:20px;}
.card{background:var(--card-bg);border-radius:14px;padding:18px 20px;margin-bottom:15px;box-shadow:0 0 15px rgba(0,255,247,.08);backdrop-filter:blur(6px);}
.pot-carousel{display:flex;overflow-x:auto;scroll-snap-type:x mandatory;gap:20px;padding:10px 0 20px 0;-webkit-overflow-scrolling:touch;scrollbar-width:none;}
.pot-carousel::-webkit-scrollbar{display:none;}
.pot-card{flex:0 0 85%;scroll-snap-align:center;background:rgba(255,255,255,.05);border-radius:14px;padding:20px;text-align:center;box-shadow:0 0 15px var(--glow-cyan);}
.pot-card h3{color:var(--glow-coral);text-shadow:0 0 8px var(--glow-coral);}
.pot-progress{height:10px;border-radius:8px;background:rgba(255,255,255,.1);margin-top:10px;overflow:hidden;}
.pot-fill{height:100%;background:linear-gradient(90deg,var(--glow-cyan),var(--glow-coral));border-radius:8px;}
table{width:100%;border-collapse:collapse;margin-top:10px;font-size:.95rem;}
th,td{text-align:left;padding:8px;}
th{color:var(--glow-cyan);border-bottom:1px solid rgba(255,255,255,.1);}
tr:nth-child(even){background:rgba(255,255,255,.03);}
</style>
</head>

<body>
<header>
  <h1>Aurora Monzo Dashboard</h1>
  <h3>Live Data Sync ‚Äì Neon Blue + Coral Glow Edition</h3>
</header>

<div class="container">
  <section id="account-summary" class="card">
    <h2>üè¶ Main Account</h2>
    <p><strong>Balance:</strong> ¬£<span id="mainBalance">0.00</span></p>
    <p><strong>Payday (last):</strong> <span id="paydayLast">‚Äì</span> ‚Ä¢ <strong>Next (4-weekly):</strong> <span id="paydayNext">‚Äì</span></p>
    <p><strong>Income received:</strong> ¬£<span id="payReceived">0.00</span></p>
    <p id="payPeriodNote" style="opacity:.8;font-size:.9rem;"></p>
  </section>

  <section id="flex-summary" class="card">
    <h2>üí≥ Flex Summary</h2>
    <p><strong>Total Balance:</strong> ¬£<span id="flexBalance">0.00</span></p>
    <p><strong>Next Payment:</strong> ¬£<span id="nextFlexDue">0.00</span> on <span id="nextFlexDate">‚Äì</span></p>
  </section>

  <section id="pots-section" class="card">
    <h2>üí∞ Pots Overview</h2>
    <div class="pot-carousel" id="potCarousel"></div>
  </section>

  <section id="direct-debits" class="card">
    <h2>üîÅ Direct Debits (this pay period)</h2>
    <table id="ddTable">
      <thead><tr><th>Payee</th><th>Amount (¬£)</th><th>Due Date</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <section id="subscriptions" class="card">
    <h2>üì± Subscriptions</h2>
    <table id="subTable">
      <thead><tr><th>Service</th><th>Amount (¬£)</th><th>Renewal Date</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <section id="recent-transactions" class="card">
    <h2>üßæ Recent Transactions</h2>
    <table id="txnTable">
      <thead><tr><th>Date</th><th>Merchant</th><th>Amount (¬£)</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <footer style="text-align:center;margin-top:25px;color:#aaa;font-size:.85em;">
    <span id="lastUpdated">Loading data‚Ä¶</span>
  </footer>
</div>

<script>
function addDays(d,days){const r=new Date(d);r.setDate(r.getDate()+days);return r;}
function formatISO(d){return d.toISOString().split('T')[0];}
function computeNextPayday28(lastISO){
  const today=new Date();today.setHours(0,0,0,0);
  let next=new Date(lastISO);next.setHours(0,0,0,0);
  while(next<=today)next=addDays(next,28);
  return next;
}

async function loadAuroraMonzo(){
  const status=document.getElementById("lastUpdated");
  const url="https://raw.githubusercontent.com/webbchrisuk-max/Aurora/refs/heads/main/AuroraMonzo.json";
  try{
    const res=await fetch(url+"?nocache="+Date.now());
    if(!res.ok)throw new Error("HTTP "+res.status);
    const data=await res.json();

    const core=data.monzo.account_core;
    const pots=core.pots||{};
    const dd=data.monzo.direct_debits||[];
    const subs=data.monzo.subscriptions_from_main||[];
    const txns=data.transactions_feed?.recent||[];

    const lastPaydayISO=core.payday_last;
    const nextPaydayDate=computeNextPayday28(lastPaydayISO);
    const nextPaydayISO=formatISO(nextPaydayDate);

    // Account summary
    document.getElementById("mainBalance").textContent=core.main_balance.toFixed(2);
    document.getElementById("paydayLast").textContent=lastPaydayISO;
    document.getElementById("paydayNext").textContent=nextPaydayISO;
    document.getElementById("payReceived").textContent=core.income_received.toFixed(2);
    document.getElementById("payPeriodNote").textContent=`Pay period: ${lastPaydayISO} ‚Üí ${nextPaydayISO} (4-weekly)`;

    // Flex summary
    if(core.flex){
      document.getElementById("flexBalance").textContent=core.flex.total_balance.toFixed(2);
      document.getElementById("nextFlexDue").textContent=core.flex.next_payment_due.toFixed(2);
      document.getElementById("nextFlexDate").textContent=core.flex.next_due_date;
    }

    // Direct Debits (current pay period)
    const ddBody=document.querySelector("#ddTable tbody");
    ddBody.innerHTML="";
    const start=new Date(core.payday_last);start.setHours(0,0,0,0);
    const end=new Date(start);end.setDate(start.getDate()+28);end.setHours(23,59,59,999);

    const periodDDs=dd
      .map(e=>{const d=new Date(e.due_date);d.setHours(0,0,0,0);return{...e,_due:d};})
      .filter(e=>e._due>=start&&e._due<=end)
      .sort((a,b)=>a._due-b._due);

    if(periodDDs.length===0){
      const row=document.createElement("tr");
      row.innerHTML=`<td colspan="3" style="text-align:center;color:#888;">No direct debits in this pay period</td>`;
      ddBody.appendChild(row);
    }else{
      periodDDs.forEach(e=>{
        const r=document.createElement("tr");
        r.innerHTML=`<td>${e.payee}</td><td>${e.amount.toFixed(2)}</td><td>${e.due_date}</td>`;
        ddBody.appendChild(r);
      });
    }

    // Subscriptions
    const subBody=document.querySelector("#subTable tbody");
    subBody.innerHTML="";
    subs.forEach(i=>{
      const r=document.createElement("tr");
      r.innerHTML=`<td>${i.service}</td><td>${i.amount.toFixed(2)}</td><td>${i.renewal_date}</td>`;
      subBody.appendChild(r);
    });

    // Transactions
    const txnBody=document.querySelector("#txnTable tbody");
    txnBody.innerHTML="";
    if(!Array.isArray(txns)||txns.length===0){
      const row=document.createElement("tr");
      row.innerHTML=`<td colspan="3" style="text-align:center;color:#888;">No recent transactions available</td>`;
      txnBody.appendChild(row);
    }else{
      txns.slice(0,5).forEach(tx=>{
        const date=tx["Date"]||"‚Äî";
        const merchant=tx["Name"]||"Unknown";
        const amountStr=tx["Amount (¬£)"]||"0.00";
        const amount=parseFloat(amountStr.replace(/[^\d.-]/g,""))||0;
        const r=document.createElement("tr");
        r.innerHTML=`<td>${date}</td><td>${merchant}</td><td>${amount.toFixed(2)}</td>`;
        txnBody.appendChild(r);
      });
    }

    renderPotCarousel(pots);
    status.textContent="‚úÖ Data loaded ‚Äì "+new Date().toLocaleString();
  }catch(err){
    console.error("‚ùå Aurora Monzo load error:",err);
    status.textContent="‚ùå Failed to load Monzo data: "+err.message;
  }
}

function renderPotCarousel(pots){
  const carousel=document.getElementById("potCarousel");
  carousel.innerHTML="";
  const goals={
    "Flex Repayment":419,"Direct Debits":416,"Holiday":800,
    "Coventry City FC":500,"IGTrading":400,"Car Maintenance":400,
    "Work Buffer":65,"Christmas":300,"Savings":1000
  };
  Object.entries(pots).forEach(([name,balance])=>{
    const goal=goals[name]||500;
    const pct=Math.min((balance/goal)*100,100).toFixed(1);
    const card=document.createElement("div");
    card.className="pot-card";
    card.innerHTML=`<h3>${name}</h3><p>¬£${Number(balance).toFixed(2)} / ¬£${goal}</p><div class="pot-progress"><div class="pot-fill" style="width:${pct}%"></div></div>`;
    carousel.appendChild(card);
  });
}

document.addEventListener("DOMContentLoaded",loadAuroraMonzo);
</script>
</body>
</html>
<!-- ===================== END: Aurora Monzo Dashboard v1.4 (Pay-Period DDs + Flex Restored) ===================== -->
