<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aurora ISA ‚Äì Ultra Aurora Mode (Atmosphere B)</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />

<style>
/* ===========================================================
   ULTRA AURORA MODE ‚Äì VARIABLES
   =========================================================== */
:root{
  --cyan:#5eefff;
  --teal:#3affd9;
  --magenta:#ff6bff;
  --purple:#a07bff;
  --amber:#ffc36a;
  --green:#72ff72;
  --bg:#020710;
}

/* ===========================================================
   GLOBAL ‚Äì BACKGROUND REMOVED + AURORA ANIMATION ADDED
   =========================================================== */
body{
  margin:0;
  padding:0;
  font-family:'Orbitron',sans-serif;

  background:#01040a;
  background:linear-gradient(180deg,#020710,#00040a 60%);

  color:#fff;
  overflow-x:hidden;
  position:relative;
  z-index:1;
}

/* ===========================================================
   AURORA ANIMATED BACKGROUND LAYER (MEDIUM)
   =========================================================== */
body::before{
  content:"";
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  pointer-events:none;
  z-index:-1;

  background:
    radial-gradient(circle at 25% 35%, rgba(94,255,255,0.16), transparent 55%),
    radial-gradient(circle at 75% 65%, rgba(255,105,255,0.18), transparent 60%),
    radial-gradient(circle at 40% 80%, rgba(60,255,220,0.14), transparent 70%),
    radial-gradient(circle at 60% 20%, rgba(160,123,255,0.12), transparent 65%);

  animation:auroraFlow 18s ease-in-out infinite alternate;
  filter:blur(12px);
}

@keyframes auroraFlow{
  0% { transform:translateY(0px) scale(1); opacity:0.55; }
  50% { transform:translateY(-25px) scale(1.05); opacity:0.75; }
  100% { transform:translateY(20px) scale(1.03); opacity:0.60; }
}

/* ===========================================================
   STARFIELD SPARKLE (SUBTLE)
   =========================================================== */
body::after{
  content:"";
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  pointer-events:none;
  z-index:-2;

  background-image:
    radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,0.18), transparent),
    radial-gradient(2px 2px at 70% 80%, rgba(255,255,255,0.12), transparent),
    radial-gradient(2px 2px at 50% 10%, rgba(255,255,255,0.15), transparent);

  animation:starsPulse 6s infinite ease-in-out alternate;
}

@keyframes starsPulse{
  0% { opacity:0.18; }
  100% { opacity:0.35; }
}

/* ===========================================================
   WRAPPER
   =========================================================== */
.wrapper{
  max-width:1400px;
  margin:auto;
  padding:20px;
  position:relative;
  z-index:5;
}

/* ===========================================================
   CARDS ‚Äì **UNCHANGED**
   =========================================================== */
.card{
  background: rgba(255,255,255,0.10);
  backdrop-filter: blur(14px) brightness(1.25);
  border: 1px solid rgba(255,255,255,0.22);
  box-shadow: 0 0 20px rgba(0,255,255,0.15);
  border-radius:20px;
  padding:22px;
  margin-bottom:30px;
}

.frost-card{
  background: rgba(255,255,255,0.12);
  border-radius:22px;
  padding:22px;
  backdrop-filter: blur(14px) brightness(1.3);
  border: 1px solid rgba(255,255,255,0.25);
  box-shadow: 0 0 25px rgba(0,255,255,0.25);
  margin-bottom:28px;
}

.card h2{
  margin-top:0;
  text-align:center;
  color:var(--cyan);
  text-shadow:0 0 14px var(--cyan);
}

.section-title{
  font-size:22px;
  font-weight:700;
  color:#b7f7ff;
  text-shadow:0 0 14px #6beaff;
  margin-bottom:14px;
  text-align:center;
}

/* ===========================================================
   CHARTS ‚Äì AURORA ANIMATED REVEAL
   =========================================================== */
canvas{
  animation:fadeSlideIn 1.15s ease-out;
}

@keyframes fadeSlideIn{
  0% { opacity:0; transform:translateY(20px); }
  100% { opacity:1; transform:translateY(0); }
}

/* ===========================================================
   HOLDINGS TABLE ‚Äî **UNCHANGED** WITH SMALL GLOW IMPROVEMENT
   =========================================================== */
.holdings-table-wrapper{
  background:rgba(0,0,0,0.38);
  padding:18px;
  border-radius:20px;
  backdrop-filter:blur(14px) brightness(0.95);
  border:1px solid rgba(0,255,255,0.18);
  box-shadow:0 0 30px rgba(0,255,255,0.25);
  margin-top:14px;
  overflow-x:auto;
}

.holdings-table{
  width:100%;
  border-collapse:collapse;
  background:rgba(0,0,0,0.55);
  border-radius:16px;
  table-layout:fixed;
  word-wrap:break-word;
}

.holdings-table th{
  color:var(--cyan);
  padding:12px;
  font-size:15px;
  background:rgba(0,0,0,0.65);
  border-bottom:1px solid rgba(0,255,255,0.25);
  text-shadow:0 0 8px rgba(0,255,255,0.6);
  font-weight:600;
}

.holdings-table td{
  padding:12px;
  font-size:14px;
  color:rgba(255,255,255,0.92);
  border-bottom:1px solid rgba(255,255,255,0.10);
}

.holdings-table tr:hover{
  background:rgba(0,255,255,0.08);
  transition:0.25s;
}

/* ===========================================================
   EXPANDERS ‚Äî UNCHANGED
   =========================================================== */
.toggle{
  margin-top:15px;
  padding:10px 20px;
  background:var(--glass-light);
  border:1px solid rgba(255,255,255,0.2);
  border-radius:30px;
  text-align:center;
  color:var(--cyan);
  cursor:pointer;
}

.expander{
  max-height:0;
  overflow:hidden;
  transition:max-height .35s ease;
}
</style>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const URL_JSON = "https://raw.githubusercontent.com/webbchrisuk-max/Aurora/main/AuroraSync.json";

async function loadJSON(){
  const r = await fetch(URL_JSON + "?nocache=" + Date.now());
  return r.json();
}

async function init(){
  const sync = await loadJSON();
  renderOverview(sync);
  renderHoldings(sync);
  renderSectorBreakdown(sync);
  renderQuarterlyIncome(sync);
}

/* ===========================================================
   OVERVIEW
   =========================================================== */
function renderOverview(sync){
  const ig = sync?.isa?.holdings?.ig_isa || [];
  const t2 = sync?.isa?.holdings?.trade212_isa || [];

  const igVal = ig.reduce((a,h)=>a + (+h.value||0),0);
  const t2Val = t2.reduce((a,h)=>a + (+h.value||0),0);

  document.getElementById("overview").innerHTML = `
    <p><strong>IG ISA:</strong> ¬£${igVal.toFixed(2)}</p>
    <p><strong>Trade212 ISA:</strong> ¬£${t2Val.toFixed(2)}</p>
    <p style="color:var(--cyan); font-size:1.2rem; margin-top:10px;">
      <strong>Total Portfolio:</strong> ¬£${(igVal+t2Val).toFixed(2)}
    </p>`;
}

/* ===========================================================
   HOLDINGS
   =========================================================== */
function renderHoldings(sync){
  const all = [
    ...(sync?.isa?.holdings?.ig_isa || []),
    ...(sync?.isa?.holdings?.trade212_isa || [])
  ];

  let html = `
    <div class="holdings-table-wrapper">
      <table class="holdings-table">
        <thead>
          <tr>
            <th>Ticker</th>
            <th>Shares</th>
            <th>Value</th>
            <th>Gain</th>
          </tr>
        </thead>
        <tbody>
  `;

  all.forEach(h=>{
    const col = h.gain_value >= 0 ? "var(--green)" : "var(--magenta)";
    html += `
      <tr>
        <td>${h.ticker}</td>
        <td>${h.shares}</td>
        <td>¬£${h.value.toFixed(2)}</td>
        <td style="color:${col};">¬£${h.gain_value.toFixed(2)}</td>
      </tr>`;
  });

  html += `
        </tbody>
      </table>
    </div>
  `;

  document.getElementById("holdings-full").innerHTML = html;
}

/* ===========================================================
   SECTOR CHART
   =========================================================== */
function renderSectorBreakdown(sync){
  const all = [
    ...(sync?.isa?.holdings?.ig_isa || []),
    ...(sync?.isa?.holdings?.trade212_isa || [])
  ];

  const sectors = {};
  all.forEach(h=>{
    const s = h.sector || "Unknown";
    sectors[s] = (sectors[s] || 0) + Number(h.value);
  });

  const ctx = document.getElementById("sectorChart");

  new Chart(ctx, {
    type:"doughnut",
    data:{
      labels:Object.keys(sectors),
      datasets:[{
        data:Object.values(sectors),
        backgroundColor:[
          "rgba(94,255,255,0.70)",
          "rgba(58,255,217,0.70)",
          "rgba(160,123,255,0.70)",
          "rgba(255,107,255,0.70)",
          "rgba(255,195,106,0.70)",
          "rgba(114,255,114,0.70)"
        ],
        borderColor:"#fff",
        borderWidth:1.5
      }]
    },
    options:{
      animation:{
        animateRotate:true,
        animateScale:true
      },
      plugins:{
        legend:{ labels:{ color:"#e9ffff" } }
      }
    }
  });
}

/* ===========================================================
   QUARTER CHART
   =========================================================== */
function renderQuarterlyIncome(sync){
  const q4_2025 = 1965.68;
  const q1_2026 = 589.76;
  const q2_2026 = 1749.24;
  const q3_2026 = 412.20;

  let future = 0;
  (sync?.isa?.dividends?.upcoming || []).forEach(r=>{
    if(!r.pay_date) return;
    const d = new Date(r.pay_date);
    if(d.getFullYear()>=2026 && d.getMonth()>=9){
      future += Number(r.total_dividend);
    }
  });

  new Chart(document.getElementById("quarterChart"), {
    type:"bar",
    data:{
      labels:["Q4 2025","Q1 2026","Q2 2026","Q3 2026","Q4 2026+"],
      datasets:[{
        label:"¬£ Income",
        data:[q4_2025,q1_2026,q2_2026,q3_2026,future],
        backgroundColor:[
          "rgba(94,255,255,0.65)",
          "rgba(58,255,217,0.65)",
          "rgba(160,123,255,0.65)",
          "rgba(255,107,255,0.65)",
          "rgba(255,195,106,0.65)"
        ],
        borderColor:"#fff",
        borderWidth:2
      }]
    },
    options:{
      animation:{
        duration:1100,
        easing:"easeOutQuart"
      },
      scales:{
        x:{ ticks:{ color:"#d8faff" } },
        y:{ ticks:{ color:"#d8faff" } }
      },
      plugins:{
        legend:{ labels:{ color:"#d8faff" } }
      }
    }
  });
}

/* ===========================================================
   EXPANDERS
   =========================================================== */
document.addEventListener("click",e=>{
  if(e.target.classList.contains("toggle")){
    const box = e.target.nextElementSibling;
    box.style.maxHeight = box.style.maxHeight ? null : box.scrollHeight + "px";
  }
});
</script>

</head>

<body onload="init()">
<div class="wrapper">

<h1 style="color:var(--cyan); text-align:center; text-shadow:0 0 18px var(--cyan);">
  ‚ùÑ Aurora ISA ‚Äî Ultra Aurora Mode (Atmosphere B)
</h1>

<!-- OVERVIEW -->
<div class="card">
  <h2>üìä ISA Overview</h2>
  <div id="overview"></div>
</div>

<!-- SECTOR -->
<div class="frost-card">
  <div class="section-title">üìä Sector Breakdown</div>
  <canvas id="sectorChart"></canvas>
</div>

<!-- QUARTERS -->
<div class="frost-card">
  <div class="section-title">üìÜ Quarterly Income Projection</div>
  <canvas id="quarterChart"></canvas>
</div>

<!-- HOLDINGS -->
<div class="card">
  <h2>üìà ISA Holdings</h2>
  <div class="toggle">Show Holdings ‚ñº</div>
  <div class="expander">
    <div id="holdings-full" style="padding-top:15px;"></div>
  </div>
</div>

</div>
</body>
</html>