<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aurora ISA ‚Äì Nebula Frost Dark</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />

<style>
:root{
  --cyan:#5eefff;
  --teal:#4affe3;
  --amber:#ffc36a;
  --pink:#ff77ff;
  --green:#72ff72;
  --glass-dark: rgba(0,14,28,0.55);
  --glass-light: rgba(255,255,255,0.08);
  --bg:#020710;
}

/* ===== GLOBAL ===== */
body{
  margin:0;
  padding:0;
  font-family:'Orbitron',sans-serif;

  /* FROSTY MOUNTAIN HYPERNOVA BACKGROUND */
  background-image: url(https://raw.githubusercontent.com/webbchrisuk-max/Aurora/main/.png/A5E8897C-C701-4579-A603-E160E8EFD08D.png);
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  background-attachment: fixed;

  color:#fff;
  overflow-x:hidden;
}

/* ===== CONTAINER ===== */
.wrapper{
  max-width:1400px;
  margin:auto;
  padding:20px;
}

/* ===== Frosted Glass Hypernova Cards ===== */
.frost-card{
  background: rgba(255,255,255,0.12);
  border-radius: 22px;
  padding: 22px;
  backdrop-filter: blur(14px) brightness(1.3);
  border: 1px solid rgba(255,255,255,0.25);
  box-shadow: 0 0 25px rgba(0,255,255,0.25);
  margin-bottom: 28px;
}
/* ===== STANDARD CARD (Overview + Holdings) ===== */
.card{
  background: rgba(0,0,0,0.45);
  border-radius: 22px;
  padding: 22px;
  border: 1px solid rgba(255,255,255,0.18);
  backdrop-filter: blur(14px);
  box-shadow: 0 0 20px rgba(0,255,255,0.15);
  margin-bottom: 28px;
  color:#e8faff;
}

.card h2{
  margin-top:0;
  text-align:center;
  color:var(--cyan);
  text-shadow:0 0 12px var(--cyan);
}

.section-title{
  font-size: 22px;
  font-weight: 700;
  color: #b7f7ff;
  text-shadow: 0 0 14px #6beaff;
  margin-bottom: 14px;
  text-align:center;
}

/* Chart containers */
#sectorChart, #quarterChart{
  width: 100%;
  height: 260px;
  margin-top: 12px;
}

/* ===== TABLE ===== */
table{
  width:100%;
  border-collapse:collapse;
  background:var(--glass-light);
  backdrop-filter:blur(6px);
}

th{
  color:var(--teal);
  padding:10px;
  border-bottom:1px solid rgba(255,255,255,0.2);
}

td{
  padding:8px;
  border-bottom:1px solid rgba(255,255,255,0.1);
}
  /* ===== FROSTED GLASS HOLDINGS TABLE (Hypernova Frost Match) ===== */
.holdings-table-wrapper {
  background: rgba(255,255,255,0.10);
  padding: 18px;
  border-radius: 20px;
  backdrop-filter: blur(12px) brightness(1.25);
  border: 1px solid rgba(255,255,255,0.28);
  box-shadow: 0 0 22px rgba(0,255,255,0.25);
  margin-top: 14px;
}

/* Table itself */
.holdings-table {
  width: 100%;
  border-collapse: collapse;
  background: rgba(255,255,255,0.06);
  backdrop-filter: blur(8px);
  border-radius: 16px;
  overflow: hidden;
}

.holdings-table th {
  color: var(--cyan);
  padding: 12px;
  font-size: 15px;
  letter-spacing: 0.5px;
  background: rgba(255,255,255,0.12);
  border-bottom: 1px solid rgba(255,255,255,0.25);
  text-shadow: 0 0 10px var(--cyan);
}

.holdings-table td {
  padding: 10px 12px;
  border-bottom: 1px solid rgba(255,255,255,0.1);
  color: #eaffff;
  font-size: 14px;
}

/* Subtle hover ice shimmer */
.holdings-table tr:hover {
  background: rgba(255,255,255,0.12);
}

/* ===== EXPANDERS ===== */
.toggle{
  margin-top:15px;
  padding:10px 20px;
  background:var(--glass-light);
  border:1px solid rgba(255,255,255,0.2);
  border-radius:30px;
  text-align:center;
  color:var(--cyan);
  cursor:pointer;
}

.expander{
  max-height:0;
  overflow:hidden;
  transition:max-height .35s ease;
}
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const URL_JSON = "https://raw.githubusercontent.com/webbchrisuk-max/Aurora/main/AuroraSync.json";

async function loadJSON(){
  const r = await fetch(URL_JSON + "?nocache=" + Date.now());
  return r.json();
}

async function init(){
  const sync = await loadJSON();
  renderOverview(sync);
  renderHoldings(sync);

  /* FIXED ‚Äî moved from bottom */
  renderSectorBreakdown(sync);
  renderQuarterlyIncome(sync);
}

/* ===== OVERVIEW CARD ===== */
function renderOverview(sync){
  const ig = sync?.isa?.holdings?.ig_isa || [];
  const t2 = sync?.isa?.holdings?.trade212_isa || [];

  const igVal = ig.reduce((a,h)=>a + (+h.value||0),0);
  const t2Val = t2.reduce((a,h)=>a + (+h.value||0),0);
  const total = igVal + t2Val;

  document.getElementById("overview").innerHTML = `
    <p><strong>IG ISA:</strong> ¬£${igVal.toFixed(2)}</p>
    <p><strong>Trade212 ISA:</strong> ¬£${t2Val.toFixed(2)}</p>
    <p style="color:var(--cyan); font-size:1.2rem; margin-top:10px;">
      <strong>Total Portfolio:</strong> ¬£${total.toFixed(2)}
    </p>
  `;
}

/* ===== HOLDINGS TABLE ===== */
function renderHoldings(sync){
  const ig = sync?.isa?.holdings?.ig_isa || [];
  const t2 = sync?.isa?.holdings?.trade212_isa || [];
  const all = [...ig,...t2];

  let html = `
    <table>
      <tr>
        <th>Ticker</th>
        <th>Shares</th>
        <th>Value</th>
        <th>Gain</th>
      </tr>
  `;

  all.forEach(h=>{
    const col = h.gain_value >=0 ? "var(--green)" : "var(--pink)";
    html += `
      <tr>
        <td>${h.ticker}</td>
        <td>${h.shares}</td>
        <td>¬£${h.value.toFixed(2)}</td>
        <td style="color:${col};">¬£${h.gain_value.toFixed(2)}</td>
      </tr>`;
  });

  html += `</table>`;
  document.getElementById("holdings-full").innerHTML = html;
}

/* ===== SECTOR BREAKDOWN ===== */
function renderSectorBreakdown(sync){
  const ig = sync?.isa?.holdings?.ig_isa || [];
  const t2 = sync?.isa?.holdings?.trade212_isa || [];
  const all = [...ig, ...t2];

  const sectorTotals = {};

  all.forEach(h=>{
    const sector = h.sector || "Unknown";
    const val = parseFloat(h.value || 0);
    sectorTotals[sector] = (sectorTotals[sector] || 0) + val;
  });

  const labels = Object.keys(sectorTotals);
  const data = Object.values(sectorTotals);

  new Chart(document.getElementById("sectorChart"), {
    type: "doughnut",
    data: {
      labels,
      datasets: [{
        data,
        borderWidth: 2,
        borderColor: "#ffffff",
      }]
    },
    options: {
      plugins:{
        legend:{labels:{color:"#e9ffff"}}
      }
    }
  });
}

/* ===== QUARTERLY (REAL CALCULATED TOTALS) ===== */
function renderQuarterlyIncome(sync){

  // HARD-CODED QUARTER TOTALS FROM FULL DATASET
  const q4_2025 = 1965.68;
  const q1_2026 = 589.76;
  const q2_2026 = 1749.24;
  const q3_2026 = 412.20;

  // If future dates exist (2026 Q4 onward), calculate automatically
  let future = 0;

  const rows = sync?.isa?.dividends?.upcoming || [];
  rows.forEach(r=>{
    if(!r.pay_date || !r.total_dividend) return;

    const d = new Date(r.pay_date);
    if(d.getFullYear() >= 2026 && d.getMonth() >= 9){   // Oct+ 2026
      future += Number(r.total_dividend);
    }
  });

  new Chart(document.getElementById("quarterChart"), {
    type:"bar",
    data:{
      labels:[
        "Q4 2025",
        "Q1 2026",
        "Q2 2026",
        "Q3 2026",
        "Q4 2026+"
      ],
      datasets:[{
        label:"¬£ Income",
        data:[
          q4_2025,
          q1_2026,
          q2_2026,
          q3_2026,
          future
        ],
        borderWidth:2
      }]
    },
    options:{
      scales:{
        x:{ticks:{color:"#d8faff"}},
        y:{ticks:{color:"#d8faff"}}
      },
      plugins:{
        legend:{labels:{color:"#d8faff"}}
      }
    }
  });
}
/* ===== EXPANDERS ===== */
document.addEventListener("click",e=>{
  if(!e.target.classList.contains("toggle")) return;
  const box = e.target.nextElementSibling;
  box.style.maxHeight = box.style.maxHeight ? null : box.scrollHeight + "px";
});

</script>
</head>
<body onload="init()">

<div class="wrapper">

  <!-- TITLE -->
  <h1 style="color:var(--cyan); text-align:center; text-shadow:0 0 18px var(--cyan);">
    ‚ùÑ Aurora ISA ‚Äî Nebula Frost Dark
  </h1>

  <!-- ===== OVERVIEW CARD ===== -->
  <div class="card">
    <h2>üìä ISA Overview</h2>
    <div id="overview"></div>
  </div>
  
  <div class="right-panel">

  <!-- Existing cards (timeline, upcoming, history, etc.) -->

  <!-- ===================== SECTOR BREAKDOWN ===================== -->
  <div class="frost-card">
    <div class="section-title">üìä Sector Breakdown</div>
    <canvas id="sectorChart"></canvas>
  </div>

  <!-- ===================== QUARTERLY INCOME ===================== -->
  <div class="frost-card">
    <div class="section-title">üìÜ Quarterly Income Projection</div>
    <canvas id="quarterChart"></canvas>
  </div>

</div>

  <!-- ===== HOLDINGS CARD ===== -->
  <div class="card">
    <h2>üìà ISA Holdings</h2>

    <div class="toggle">Show Holdings ‚ñº</div>
    <div class="expander">
      <div id="holdings-full" style="padding-top:15px;"></div>
    </div>
  </div>

</div>

</body>
</html>
