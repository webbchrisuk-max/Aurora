<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta content="width=device-width, initial-scale=1.0" name="viewport" />
<title>Aurora Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet" />

<style>
:root{
  --cyan:#00ffff;
  --green:#00ff99;
  --bg1:#060018;
  --bg2:#120035;
  --bg3:#001a33;
}

body{
  margin:0;padding:0;
  font-family:'Orbitron',sans-serif;
  color:#fff;
  background:linear-gradient(120deg,var(--bg1),var(--bg2),var(--bg3));
  background-size:600% 600%;
  animation:auroraDrift 45s ease-in-out infinite;
  overflow-x:hidden;
}
@keyframes auroraDrift{
  0%{background-position:0% 50%;}
  25%{background-position:50% 100%;}
  50%{background-position:100% 50%;}
  75%{background-position:50% 0%;}
  100%{background-position:0% 50%;}
}

h1{text-align:center;font-size:1.8rem;margin:20px 0;color:#fff;
    text-shadow:0 0 14px rgba(0,255,255,0.7),0 0 28px rgba(0,255,255,0.35);}
h2,h3{color:#fff;text-shadow:0 0 10px rgba(0,255,255,0.55);margin-top:.5em;}

.dashboard{
  display:grid;grid-template-columns:repeat(2,1fr);gap:20px;
  margin:0 auto;max-width:1200px;padding:0 20px 30px;align-items:start;
}
@media(max-width:820px){.dashboard{grid-template-columns:1fr;padding:0 16px 24px;}}

.card{
  background:rgba(10,10,30,0.65);
  border:1px solid rgba(0,255,255,0.25);
  border-radius:10px;padding:20px;
  box-shadow:0 0 20px rgba(0,255,255,0.15);
  backdrop-filter:blur(6px);
  animation:fadeIn .8s ease-in-out;
}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}

/* Sync indicator */
#auroraSyncStatus{position:fixed;top:10px;right:20px;font-size:.85rem;color:#fff;}
#auroraSyncDot{display:inline-block;width:10px;height:10px;border-radius:50%;
  background:var(--cyan);box-shadow:0 0 10px var(--cyan);
  margin-right:6px;vertical-align:middle;animation:pulseGlow 3s ease-in-out infinite;}
@keyframes pulseGlow{0%,100%{box-shadow:0 0 10px var(--cyan);}50%{box-shadow:0 0 25px var(--cyan);}}
#syncTime{display:block;font-size:.75rem;color:#aaa;margin-top:2px;}

.amount-green{color:var(--green);}
.date-pink{color:#ff66cc;}

/* Target bar */
#targetBarFill {transition:width 1s ease, box-shadow 1s;}
#targetBarFill.full {
  box-shadow:0 0 20px var(--cyan), 0 0 40px var(--cyan);
  animation:pulseFull 3s ease-in-out infinite;
}
@keyframes pulseFull {0%,100%{opacity:1;}50%{opacity:.6;}}

/* Chart containers */
#quarterlyChart,#monthlyChart{text-align:center;margin-top:20px;}
#quarterlyBars,#monthlyBars{display:flex;justify-content:space-around;align-items:flex-end;height:240px;gap:10px;}
.barBlock{display:flex;flex-direction:column;align-items:center;}
.barFill{border-radius:6px 6px 0 0;background:linear-gradient(180deg,#9dfcff,var(--cyan));box-shadow:0 0 15px var(--cyan);transition:height 1s ease;}
.barLabel{margin-top:6px;font-size:.8rem;text-align:center;}
.barFill.monthly{width:22px;}
.barFill.quarterly{width:60px;}

/* Holdings tables */
.table-holder{overflow-x:auto;max-height:350px;}
table{width:100%;border-collapse:collapse;font-size:.85rem;}
th,td{padding:6px 8px;text-align:left;}
th{color:#00ffff;text-shadow:0 0 8px rgba(0,255,255,0.45);}
tr:nth-child(even){background:rgba(255,255,255,0.05);}
tr:hover{background:rgba(0,255,255,0.10);}
.value{color:var(--cyan);}
.gain-pos{color:var(--green);}
.gain-neg{color:#ff5555;}

.icon-title{display:flex;align-items:center;gap:10px;}
.icon-title span{font-size:1.3rem;}
</style>
</head>

<body>
<h1>Aurora Tracker</h1>

<div id="auroraSyncStatus">
  <span id="auroraSyncDot"></span>Synced
  <span id="syncTime">Last updated --:-- Â· Next sync in 5 min</span>
</div>

<div class="dashboard">

  <!-- ===== Portfolio Summary ===== -->
  <div class="card" id="portfolio-summary">
    <h2>Portfolio Summary</h2>
    <p>Total Target: Â£<span id="targetValue">0.00</span></p>
    <div style="width:90%;background:rgba(255,255,255,0.1);border-radius:8px;height:16px;overflow:hidden;margin-top:6px;">
      <div id="targetBarFill" style="height:100%;width:0%;background:linear-gradient(90deg,var(--cyan),#9dfcff);box-shadow:0 0 10px var(--cyan);"></div>
    </div>
    <p style="font-size:.8rem;margin-top:6px;">Progress: <span id="targetProgress">0%</span></p>
    <p>Dividend Yield: <span id="divYield">0.00</span>%</p>
    <p>Total Gain: <span id="totalGain">0.00</span> ( <span id="gainPercent">0.00</span>% )</p>
  </div>

  <!-- ===== ISA Balances ===== -->
  <div class="card" id="isa-balances">
    <h2>ISA Balances</h2>
    <p>IG ISA: Â£<span id="igBalance">0.00</span></p>
    <p>Trade212 ISA: Â£<span id="t212Balance">0.00</span></p>
  </div>

  <!-- ===== Holdings ===== -->
  <div class="card" id="holdings">
    <h2>Holdings</h2>
    <h3>IG ISA</h3>
    <div class="table-holder">
      <table id="igTable">
        <thead><tr><th>Name</th><th>Shares</th><th>Live Price (Â£)</th><th>Value (Â£)</th><th>Gain (Â£)</th><th>Gain (%)</th><th>Yield (%)</th><th>Income (Â£)</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
    <h3>Trade212 ISA</h3>
    <div class="table-holder">
      <table id="t212Table">
        <thead><tr><th>Name</th><th>Shares</th><th>Live Price (Â£)</th><th>Value (Â£)</th><th>Gain (Â£)</th><th>Gain (%)</th><th>Yield (%)</th><th>Income (Â£)</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- ===== Dividends Centre ===== -->
  <div class="card" id="dividends">
    <div class="icon-title"><span>ðŸ’°</span><h2>Next 5 Dividends</h2></div>
    <ul id="nextDivs" style="list-style:none;padding:0;margin:0;"></ul>

    <div class="icon-title" style="margin-top:15px;"><span>ðŸ“…</span><h2>Next 5 Ex-Dividends</h2></div>
    <ul id="nextExDivs" style="list-style:none;padding:0;margin:0;"></ul>
  </div>

  <!-- ===== Dividend Overview + Charts ===== -->
  <div class="card" id="dividend-overview">
    <h2>Dividend Overview</h2>
    <h3>Dividend Forecast</h3>
    <p>Forecast Annual Income: Â£<span id="forecastTotal">0.00</span></p>
    <p>YTD Received: Â£<span id="receivedYTD">0.00</span></p>
    <div style="width:90%;margin:0 auto;background:rgba(255,255,255,0.1);border-radius:8px;height:16px;overflow:hidden;">
      <div id="forecastProgress" style="height:100%;width:0%;background:linear-gradient(90deg,var(--cyan),#9dfcff);box-shadow:0 0 10px var(--cyan);transition:width 1s ease;"></div>
    </div>
    <p style="font-size:.8rem;margin-top:6px;">Progress to Â£6 000 Goal: <span id="forecastPercent">0%</span></p>

    <div id="quarterlyChart">
      <h3>Quarterly Totals</h3>
      <div id="quarterlyBars"></div>
    </div>

    <div id="monthlyChart">
      <h3>Dividend Payments by Month</h3>
      <div id="monthlyBars"></div>
    </div>
  </div>

</div>

<script>
const JSON_URL="https://raw.githubusercontent.com/webbchrisuk-max/Aurora/refs/heads/main/AuroraSync.json?ts=";
const asNum=v=>isNaN(+v)?0:+v;

async function loadAuroraSync(){
  const dot=document.getElementById("auroraSyncDot");
  const time=document.getElementById("syncTime");
  try{
    const res=await fetch(JSON_URL+Date.now(),{cache:"no-store"});
    if(!res.ok)throw new Error(res.status);
    const data=await res.json();
    renderAll(data);
    dot.style.background="#00ffcc";
    time.textContent="Last updated "+new Date().toLocaleTimeString();
  }catch(e){
    dot.style.background="#ff3333";
    console.error("Sync error:",e);
  }
}

function renderAll(data){
  document.getElementById("targetValue").textContent=asNum(data.isa.portfolio_summary.annual_target_value).toFixed(2);
  document.getElementById("divYield").textContent=asNum(data.isa.portfolio_summary.dividend_yield).toFixed(2);
  document.getElementById("igBalance").textContent=asNum(data.isa.ig_isa.balance).toFixed(2);
  document.getElementById("t212Balance").textContent=asNum(data.isa.trade212_isa.balance).toFixed(2);
  renderTargetBar(data);
  renderTable("#igTable tbody",data.isa_feed.filter(x=>x.account==="IG ISA"));
  renderTable("#t212Table tbody",data.isa_feed.filter(x=>x.account==="TRADE212"));
  renderDividends(data);
  renderForecast(data);
  renderQuarterly(data);
  renderMonthly(data);
}

function renderTable(sel,list){
  const el=document.querySelector(sel);el.innerHTML="";
  list.forEach(h=>{
    el.insertAdjacentHTML("beforeend",
    `<tr><td>${h.name}</td><td>${h.shares}</td><td>${asNum(h.live_price).toFixed(2)}</td>
     <td>${asNum(h.value).toFixed(2)}</td><td class='${asNum(h.gain_value)>=0?"gain-pos":"gain-neg"}'>${asNum(h.gain_value).toFixed(2)}</td>
     <td>${asNum(h.gain_percentage).toFixed(2)}%</td><td>${asNum(h.annual_div_yield).toFixed(2)}%</td>
     <td>${asNum(h.annual_income).toFixed(2)}</td></tr>`);
  });
}

function renderDividends(data){
  const now=new Date();
  const next=document.getElementById("nextDivs");
  const nextEx=document.getElementById("nextExDivs");
  next.innerHTML="";nextEx.innerHTML="";
  const pays=(data.dividends_feed||[]).filter(d=>new Date(d.pay_date)>now).slice(0,5);
  const exes=(data.dividends_feed||[]).filter(d=>new Date(d.ex_div_date)>now).slice(0,5);
  pays.forEach(d=>next.insertAdjacentHTML("beforeend",`<li style="margin:6px 0;">${d.name}<br><span class='amount-green'>Â£${asNum(d.total_dividend).toFixed(2)}</span><br><span class='date-pink'>${d.pay_date}</span></li>`));
  exes.forEach(d=>nextEx.insertAdjacentHTML("beforeend",`<li style="margin:6px 0;">${d.name}<br><span class='date-pink'>${d.ex_div_date}</span></li>`));
}

function renderForecast(data){
  const f=data.dividend_planner||{};
  document.getElementById("forecastTotal").textContent=asNum(f.forecast_total).toFixed(2);
  document.getElementById("receivedYTD").textContent=asNum(f.received_ytd).toFixed(2);
  const pct=(asNum(f.forecast_total)/6000*100).toFixed(1);
  document.getElementById("forecastPercent").textContent=pct+"%";
  document.getElementById("forecastProgress").style.width=Math.min(pct,100)+"%";
}

function renderQuarterly(data){
  const el=document.getElementById("quarterlyBars");
  el.innerHTML="";
  const qd=data.dividend_planner?.quarterly_breakdown||{};
  const max=Math.max(1,...Object.values(qd));
  Object.entries(qd).forEach(([q,v])=>{
    const wrap=document.createElement("div");
    wrap.className="barBlock";
    const bar=document.createElement("div");
    bar.className="barFill quarterly";
    bar.style.height=(v/max*190)+"px";
    const label=document.createElement("div");
    label.className="barLabel";
    label.innerHTML=`${q}<br>Â£${v.toFixed(2)}`;
    wrap.appendChild(bar);
    wrap.appendChild(label);
    el.appendChild(wrap);
  });
}

function renderMonthly(data){
  const el=document.getElementById("monthlyBars");
  el.innerHTML="";
  const mb=(data.dividend_planner?.monthly_breakdown)||[];
  const max=Math.max(1,...mb.map(m=>asNum(m.total_estimated_income)));
  mb.forEach(m=>{
    const wrap=document.createElement("div");
    wrap.className="barBlock";
    const bar=document.createElement("div");
    bar.className="barFill monthly";
    bar.style.height=(asNum(m.total_estimated_income)/max*190)+"px";
    const label=document.createElement("div");
    label.className="barLabel";
    label.innerHTML=`${m.month}<br>Â£${asNum(m.total_estimated_income).toFixed(0)}`;
    wrap.appendChild(bar);
    wrap.appendChild(label);
    el.appendChild(wrap);
  });
}

function renderTargetBar(data){
  const target=asNum(data.isa.portfolio_summary.annual_target_value);
  const current=asNum(data.isa.ig_isa.balance)+asNum(data.isa.trade212_isa.balance);
  const pct=Math.min((current/target)*100,100);
  document.getElementById("targetProgress").textContent=pct.toFixed(1)+"%";
  const bar=document.getElementById("targetBarFill");
  bar.style.width=pct+"%";
  bar.classList.toggle("full",pct>=100);
}

document.addEventListener("DOMContentLoaded",loadAuroraSync);
</script>
</body>
</html>
