<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aurora Tracker v4.2 – Live Data + Next Dividend</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&display=swap" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* ===================== SECTION: GLOBAL ===================== */
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'Orbitron', sans-serif;
  color: #fff;
  background: #05010f;
  overflow-x: hidden;
  height: 100vh;
  display: flex;
  flex-direction: column;
}

/* Animated HyperGrid background */
body::before {
  content: "";
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background-image:
    linear-gradient(0deg, transparent 24%, rgba(0,204,255,0.1) 25%, rgba(0,204,255,0.1) 26%, transparent 27%, transparent 74%, rgba(255,0,204,0.1) 75%, rgba(255,0,204,0.1) 76%, transparent 77%, transparent),
    linear-gradient(90deg, transparent 24%, rgba(0,204,255,0.1) 25%, rgba(0,204,255,0.1) 26%, transparent 27%, transparent 74%, rgba(255,0,204,0.1) 75%, rgba(255,0,204,0.1) 76%, transparent 77%, transparent);
  background-size: 80px 80px;
  animation: gridMove 20s linear infinite;
  z-index: 0;
}
@keyframes gridMove {
  from { background-position: 0 0, 0 0; }
  to { background-position: 80px 80px, 80px 80px; }
}

/* Layout container */
.container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  padding: 20px;
  z-index: 1;
  flex: 1;
  overflow-y: auto;
}

/* Responsive for small screens (single column) */
@media (max-width: 1024px) {
  .container { grid-template-columns: 1fr; }
}

/* Card styling */
.card {
  background: rgba(10, 10, 30, 0.6);
  border: 1px solid rgba(0, 204, 255, 0.3);
  border-radius: 10px;
  padding: 15px 20px;
  margin-bottom: 15px;
  box-shadow: 0 0 15px rgba(0,204,255,0.3);
  position: relative;
}
.card h2 {
  font-size: 1rem;
  color: #00ccff;
  border-bottom: 1px solid rgba(255,0,204,0.3);
  padding-bottom: 5px;
  margin-bottom: 10px;
}
.value {
  font-size: 1.3rem;
  color: #fff;
  text-shadow: 0 0 5px #00ccff;
}
.holdings-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.9rem;
}
.holdings-table th, .holdings-table td {
  padding: 6px 8px;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}
.holdings-table th {
  text-align: left;
  color: #ff00cc;
}

/* Dividends split */
.dividend-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}
@media (max-width: 1024px) {
  .dividend-grid { grid-template-columns: 1fr; }
}
.div-feed {
  max-height: 300px;
  overflow-y: auto;
}

/* Chart styling */
.chart-container {
  width: 100%;
  height: 250px;
}

/* Scrollbar custom */
::-webkit-scrollbar {
  width: 6px;
}
::-webkit-scrollbar-thumb {
  background: rgba(0,204,255,0.4);
  border-radius: 3px;
}
</style>
</head>

<body>
<h1 style="text-align:center;margin:15px 0;font-weight:600;color:#00ccff;text-shadow:0 0 10px #ff00cc;">Aurora Tracker</h1>

<div class="container">

  <!-- ===================== LEFT COLUMN ===================== -->
  <div id="leftColumn">
    <div class="card" id="portfolioSummary">
      <h2>Portfolio Summary</h2>
      <div id="portfolioValues" class="value">Loading...</div>
    </div>

    <div class="card" id="isaTotals">
      <h2>ISA Totals</h2>
      <p>IG ISA: <span id="igTotal" class="value">--</span></p>
      <p>Trade212 ISA: <span id="t212Total" class="value">--</span></p>
    </div>

    <div class="card" id="nextDividend">
      <h2>Next Dividend</h2>
      <div id="nextDividendContent" class="value">Loading...</div>
    </div>

    <div class="card" id="igHoldings">
      <h2>IG ISA Holdings</h2>
      <table class="holdings-table" id="igTable"></table>
    </div>

    <div class="card" id="t212Holdings">
      <h2>Trade212 Holdings</h2>
      <table class="holdings-table" id="t212Table"></table>
    </div>
  </div>

  <!-- ===================== RIGHT COLUMN ===================== -->
  <div id="rightColumn">
    <div class="dividend-grid">
      <div class="card">
        <h2>Next 5 Dividends</h2>
        <div id="next5Dividends" class="div-feed">Loading...</div>
      </div>
      <div class="card">
        <h2>Next 5 Ex-Dividends</h2>
        <div id="next5ExDividends" class="div-feed">Loading...</div>
      </div>
    </div>

    <div class="card chart-container">
      <h2>Dividend Chart</h2>
      <canvas id="dividendChart"></canvas>
    </div>
  </div>

</div>

<script>
async function loadAuroraData() {
  try {
    const response = await fetch("https://raw.githubusercontent.com/webbchrisuk-max/Aurora/main/AuroraSync.json?nocache=" + Date.now());
    const data = await response.json();

    // Portfolio summary
    const ig = data.isa.ig_isa.balance;
    const t212 = data.isa.trade212_isa.balance;
    const total = (ig + t212).toFixed(2);
    document.getElementById("portfolioValues").innerHTML = `£${total}`;
    document.getElementById("igTotal").innerHTML = `£${ig.toLocaleString()}`;
    document.getElementById("t212Total").innerHTML = `£${t212.toLocaleString()}`;

    // Next Dividend
    if (data.dividends_feed && data.dividends_feed.length > 0) {
      const next = data.dividends_feed[0];
      document.getElementById("nextDividendContent").innerHTML =
        `${next.ticker} – £${next.amount} in ${next.days_left} days`;
    }

    // Holdings split
    const igHoldings = data.isa_feed.filter(h => h.account === "IG");
    const t212Holdings = data.isa_feed.filter(h => h.account === "Trade212");

    function buildTable(arr, targetId) {
      const table = document.getElementById(targetId);
      table.innerHTML = "<tr><th>Ticker</th><th>Value</th></tr>";
      arr.slice(0, 10).forEach(h => {
        const row = document.createElement("tr");
        row.innerHTML = `<td>${h.ticker}</td><td>£${Number(h.value).toLocaleString()}</td>`;
        table.appendChild(row);
      });
    }
    buildTable(igHoldings, "igTable");
    buildTable(t212Holdings, "t212Table");

    // Dividends feed split
    const divs = data.dividends_feed || [];
    const next5 = divs.slice(0, 5);
    const next5Ex = divs.filter(d => d.ex_date).slice(0, 5);

    function buildFeed(list, targetId) {
      const container = document.getElementById(targetId);
      container.innerHTML = "";
      list.forEach(d => {
        const div = document.createElement("div");
        div.style.marginBottom = "6px";
        div.innerHTML = `<strong>${d.ticker}</strong> – £${d.amount} (${d.date || d.ex_date})`;
        container.appendChild(div);
      });
    }
    buildFeed(next5, "next5Dividends");
    buildFeed(next5Ex, "next5ExDividends");

    // Chart
    const ctx = document.getElementById("dividendChart").getContext("2d");
    new Chart(ctx, {
      type: "bar",
      data: {
        labels: divs.slice(0, 6).map(d => d.ticker),
        datasets: [{
          label: "Dividend (£)",
          data: divs.slice(0, 6).map(d => d.amount),
          backgroundColor: "rgba(0,204,255,0.6)",
          borderColor: "#ff00cc",
          borderWidth: 1
        }]
      },
      options: {
        plugins: { legend: { display: false } },
        scales: {
          x: { ticks: { color: "#fff" }, grid: { color: "rgba(255,255,255,0.1)" } },
          y: { ticks: { color: "#fff" }, grid: { color: "rgba(255,255,255,0.1)" } }
        }
      }
    });

  } catch (err) {
    console.error("AuroraSync load error:", err);
    document.getElementById("portfolioValues").textContent = "Sync Error";
  }
}

loadAuroraData();
</script>

</body>
</html>
