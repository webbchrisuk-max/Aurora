<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aurora Master Dashboard â€“ Ultra Edition (Mobile Fixed)</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet" />

<style>
:root{
  --cyan:#00ffff;
  --coral:#ff7f50;
  --teal:#00ffd0;
  --amber:#ffb347;
  --bg1:#060018;
  --bg2:#120035;
  --bg3:#001a33;
}
body{
  margin:0;padding:0;
  font-family:'Orbitron',sans-serif;
  color:#fff;
  background:linear-gradient(120deg,var(--bg1),var(--bg2),var(--bg3));
  background-size:600% 600%;
  animation:auroraDrift 45s ease-in-out infinite;
  overflow-x:hidden;
}
@keyframes auroraDrift{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}
h1{text-align:center;font-size:1.8rem;margin:20px 0;text-shadow:0 0 14px rgba(0,255,255,.7);}
.dashboard{display:grid;grid-template-columns:repeat(auto-fit,minmax(360px,1fr));gap:20px;max-width:1200px;margin:0 auto;padding:0 20px 30px;}
.card{
  background:rgba(10,10,30,0.65);
  border:1px solid rgba(0,255,255,0.25);
  border-radius:10px;
  padding:20px;
  box-shadow:0 0 20px rgba(0,255,255,0.15);
  backdrop-filter:blur(6px);
  animation:fadeIn .8s ease-in-out;
}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
.targetBar{width:100%;background:rgba(255,255,255,.1);border-radius:10px;height:16px;margin-top:8px;overflow:hidden;}
.targetFill{height:100%;width:0%;background:linear-gradient(90deg,var(--cyan),#9dfcff);transition:width 1s ease;}
.divTable{width:100%;border-collapse:collapse;font-size:.9rem;margin-top:6px;}
.divTable th,.divTable td{padding:6px 8px;border-bottom:1px solid rgba(255,255,255,.08);text-align:left;}
.divTable th{color:var(--cyan);font-weight:600;text-shadow:0 0 8px rgba(0,255,255,.5);}
.divTable tr:hover{background:rgba(0,255,255,.08);transition:background .3s;}
.divTable td span.amount{color:#00ffcc;text-shadow:0 0 6px rgba(0,255,255,.5);}
.divTable td span.date{color:#ff66cc;text-shadow:0 0 6px rgba(255,102,204,.4);}

/* Holdings Table */
.holdingsTable{width:100%;border-collapse:collapse;font-size:.9rem;margin-top:8px;}
.holdingsTable th,.holdingsTable td{padding:6px 8px;border-bottom:1px solid rgba(255,255,255,.08);text-align:left;}
.holdingsTable th{color:var(--teal);font-weight:600;text-shadow:0 0 8px var(--teal);}
.holdingsTable tr:nth-child(even){background:rgba(255,255,255,.03);}
.holdingsTable tr:hover{background:rgba(0,255,255,.08);transition:background .3s;}

/* Responsive fix for Holdings Tables (iPhone portrait safe) */
.holdingsTable-wrapper {
  width: 100%;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  padding-bottom: 6px;
  margin-bottom: 6px;
}
.holdingsTable-wrapper::-webkit-scrollbar {
  height: 6px;
}
.holdingsTable-wrapper::-webkit-scrollbar-thumb {
  background: rgba(0,255,255,0.4);
  border-radius: 3px;
}
@media (max-width: 600px){
  .holdingsTable th, .holdingsTable td {
    white-space: nowrap;
    font-size: 0.85rem;
    padding: 5px 6px;
  }
}

/* Mobile-friendly yearly chart */
#yearlyBars{overflow-x:auto;display:flex;justify-content:flex-start;align-items:flex-end;height:240px;margin-top:12px;gap:10px;padding-bottom:10px;}
#yearlyBars>div{flex:0 0 auto;}
</style>
</head>

<body>
<h1>Aurora Master Dashboard â€“ Ultra Edition</h1>

<div class="dashboard">

  <!-- Portfolio Summary -->
  <div class="card" id="portfolio-summary">
    <h2>Portfolio Summary</h2>
    <p>Total Target: Â£<span id="targetValue">0.00</span></p>
    <div class="targetBar"><div id="targetFill" class="targetFill"></div></div>
    <p>Dividend Yield: <span id="divYield">0.00</span>%</p>
    <p>Total Gain: <span id="totalGain">0.00</span> (<span id="gainPercent">0.00</span>%)</p>
  </div>

  <!-- ISA Balances -->
  <div class="card" id="isa-balances">
    <h2>ISA Balances</h2>
    <p>IG ISA: Â£<span id="igBalance">0.00</span></p>
    <p>Trade212 ISA: Â£<span id="t212Balance">0.00</span></p>
  </div>

  <!-- Upcoming Dividends -->
  <div class="card" id="dividends-centre">
    <h2>ğŸ“… Upcoming Dividends</h2>
    <h3>ğŸ’° Next 5 Dividends</h3>
    <table class="divTable">
      <thead><tr><th>Company</th><th>Amount</th><th>Pay Date</th></tr></thead>
      <tbody id="nextDivs"></tbody>
    </table>
    <h3 style="margin-top:18px;">ğŸ—“ï¸ Next 5 Ex-Dividends</h3>
    <table class="divTable">
      <thead><tr><th>Company</th><th>Ex-Div Date</th></tr></thead>
      <tbody id="nextExDivs"></tbody>
    </table>
  </div>

  <!-- Dividend Overview -->
  <div class="card" id="dividend-overview">
    <h2>Dividend Overview</h2>
    <p>Forecast Annual Income: Â£<span id="forecastTotal">0.00</span></p>
    <p>YTD Received: Â£<span id="receivedYTD">0.00</span></p>
    <div class="targetBar"><div id="forecastProgress" class="targetFill"></div></div>
    <p style="font-size:.8rem;margin-top:6px;">Progress to Â£6 000 Goal: <span id="forecastPercent">0%</span></p>
    <h3>Quarterly Totals</h3>
    <div id="quarterlyBars" style="display:flex;justify-content:space-around;align-items:flex-end;height:220px;margin-top:12px;gap:10px;"></div>
    <h3 style="margin-top:20px;">Yearly Dividends (Janâ€“Dec)</h3>
    <div id="yearlyBars"></div>
  </div>

  <!-- IG ISA Holdings -->
  <div class="card">
    <h2>IG ISA Holdings</h2>
    <div class="holdingsTable-wrapper"><div id="igContent"></div></div>
  </div>

  <!-- Trade212 ISA Holdings -->
  <div class="card">
    <h2>Trade212 ISA Holdings</h2>
    <div class="holdingsTable-wrapper"><div id="t212Content"></div></div>
  </div>

</div>

<!-- ============== CONTINUES IN PART 2 ============== -->
<script>
const JSON_URL="https://raw.githubusercontent.com/webbchrisuk-max/Aurora/refs/heads/main/AuroraSync.json?nocache=";
const asNum=v=>isNaN(+v)?0:+v;

async function loadAurora(){
  try{
    const res=await fetch(JSON_URL+Date.now(),{cache:"no-store"});
    if(!res.ok)throw new Error("HTTP "+res.status);
    const d=await res.json();
    renderAll(d);
  }catch(e){console.error(e);}
}

function renderAll(d){
  renderBalances(d);
  renderDividends(d);
  renderForecast(d);
  renderQuarterly(d);
  renderYearly(d);
  renderHoldings(d);
}

function renderBalances(d){
  document.getElementById("igBalance").textContent=asNum(d.isa?.ig_isa?.balance).toFixed(2);
  document.getElementById("t212Balance").textContent=asNum(d.isa?.trade212_isa?.balance).toFixed(2);
}

function renderDividends(d){
  const now=new Date();
  const divs=document.getElementById("nextDivs");
  const exs=document.getElementById("nextExDivs");
  divs.innerHTML="";exs.innerHTML="";
  const pays=(d.dividends_feed||[]).filter(v=>new Date(v.pay_date)>now).sort((a,b)=>new Date(a.pay_date)-new Date(b.pay_date)).slice(0,5);
  const exes=(d.dividends_feed||[]).filter(v=>new Date(v.ex_div_date)>now).sort((a,b)=>new Date(a.ex_div_date)-new Date(b.ex_div_date)).slice(0,5);
  pays.forEach(v=>{
    divs.insertAdjacentHTML("beforeend",`<tr><td>${v.name}</td><td><span class='amount'>Â£${asNum(v.total_dividend).toFixed(2)}</span></td><td><span class='date'>${v.pay_date}</span></td></tr>`);
  });
  exes.forEach(v=>{
    exs.insertAdjacentHTML("beforeend",`<tr><td>${v.name}</td><td><span class='date'>${v.ex_div_date}</span></td></tr>`);
  });
}

function renderForecast(d){
  const f=d.dividend_planner||{};
  document.getElementById("forecastTotal").textContent=asNum(f.forecast_total).toFixed(2);
  document.getElementById("receivedYTD").textContent=asNum(f.received_ytd).toFixed(2);
  const pct=(asNum(f.forecast_total)/6000*100).toFixed(1);
  document.getElementById("forecastPercent").textContent=pct+"%";
  document.getElementById("forecastProgress").style.width=Math.min(pct,100)+"%";
}

function renderQuarterly(d){
  const el=document.getElementById("quarterlyBars");el.innerHTML="";
  const q=d.dividend_planner?.quarterly_breakdown||{};
  const max=Math.max(1,...Object.values(q));
  Object.entries(q).forEach(([k,v])=>{
    const bar=document.createElement("div");
    bar.style.width="60px";bar.style.height=(v/max*190)+"px";
    bar.style.borderRadius="6px 6px 0 0";
    bar.style.background="linear-gradient(180deg,#9dfcff,var(--cyan))";
    bar.style.boxShadow="0 0 15px var(--cyan)";
    const lbl=document.createElement("div");
    lbl.innerHTML=`${k}<br>Â£${v.toFixed(0)}`;
    lbl.style.fontSize=".8rem";lbl.style.textAlign="center";lbl.style.marginTop="6px";
    const wrap=document.createElement("div");
    wrap.style.display="flex";wrap.style.flexDirection="column";wrap.style.alignItems="center";
    wrap.appendChild(bar);wrap.appendChild(lbl);el.appendChild(wrap);
  });
}

function renderYearly(d){
  const el=document.getElementById("yearlyBars");el.innerHTML="";
  const m=d.dividend_planner?.monthly_breakdown||{};
  const months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
  const vals=months.map(k=>+m[k]||0);
  const max=Math.max(1,...vals);
  months.forEach((k,i)=>{
    const v=vals[i];
    const bar=document.createElement("div");
    bar.style.width="40px";
    bar.style.height=(v/max*190)+"px";
    bar.style.borderRadius="6px 6px 0 0";
    bar.style.background="linear-gradient(180deg,var(--cyan),var(--coral))";
    bar.style.boxShadow="0 0 15px rgba(0,255,255,0.5)";
    const lbl=document.createElement("div");
    lbl.innerHTML=`${k}<br>Â£${v.toFixed(0)}`;
    lbl.style.fontSize=".75rem";lbl.style.textAlign="center";lbl.style.marginTop="6px";
    const wrap=document.createElement("div");
    wrap.style.display="flex";wrap.style.flexDirection="column";wrap.style.alignItems="center";
    wrap.appendChild(bar);wrap.appendChild(lbl);el.appendChild(wrap);
  });
}

/* Holdings renderer */
function renderHoldings(d){
  renderSection("igContent",d.isa_feed.filter(x=>x.account==="IG ISA"),"var(--teal)");
  renderSection("t212Content",d.isa_feed.filter(x=>x.account==="TRADE212"),"var(--amber)");
}
function renderSection(id,list,color){
  const el=document.getElementById(id);el.innerHTML="";
  if(!list.length){el.innerHTML="<p>No holdings available.</p>";return;}
  let h=`<table class='holdingsTable'>
  <thead><tr style="color:${color};text-shadow:0 0 8px ${color};"><th>Name</th><th>Value (Â£)</th><th>Gain (Â£)</th><th>Gain (%)</th><th>Yield (%)</th><th>Income (Â£)</th></tr></thead><tbody>`;
  list.forEach(v=>{
    const gcls=asNum(v.gain_value)>=0?"style='color:#00ffcc'":"style='color:#ff5555'";
    h+=`<tr><td>${v.name}</td><td>${asNum(v.value).toFixed(2)}</td><td ${gcls}>${asNum(v.gain_value).toFixed(2)}</td><td ${gcls}>${asNum(v.gain_percentage).toFixed(2)}%</td><td>${asNum(v.annual_div_yield).toFixed(2)}%</td><td>${asNum(v.annual_income).toFixed(2)}</td></tr>`;
  });h+="</tbody></table>";el.innerHTML=h;
}

document.addEventListener("DOMContentLoaded",loadAurora);
</script>

<!-- ===================== NAV DISCOUNT LEADERBOARD ===================== -->
<section style="max-width:1200px;margin:40px auto 60px;padding:0 20px;">
  <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;">
    <div style="flex:1;height:3px;background:linear-gradient(90deg,rgba(0,255,255,0),var(--cyan),var(--coral),rgba(0,255,255,0));animation:pulseLine 6s ease-in-out infinite;"></div>
    <div style="white-space:nowrap;font-weight:700;letter-spacing:.3px;color:#bfffff;text-shadow:0 0 10px rgba(0,255,255,.9);">NAV Discount Leaderboard</div>
    <div style="flex:1;height:3px;background:linear-gradient(90deg,rgba(0,255,255,0),var(--coral),var(--cyan),rgba(0,255,255,0));animation:pulseLine 6s ease-in-out infinite;"></div>
  </div>

  <div class="aurora-nav-leaderboard" id="navDiscountCard">
    <div class="navlb-header">
      <div class="navlb-title">NAV Discount Leaderboard</div>
      <div class="navlb-meta" id="navlbMeta">Loadingâ€¦</div>
    </div>

    <div class="navlb-movers" id="navlbMovers" hidden>
      <div class="navlb-movers-col"><h4>Top 3 Weekly Wideners</h4><ul id="navlbWideners"></ul></div>
      <div class="navlb-movers-col"><h4>Top 3 Weekly Narrowers</h4><ul id="navlbNarrowers"></ul></div>
    </div>

    <div class="navlb-category cat-green" id="navlbGreen" hidden><div class="navlb-cat-title">ğŸŸ© Deep discount (â‰¤ âˆ’10 %)</div><div id="navlbGreenList"></div></div>
    <div class="navlb-category cat-yellow" id="navlbYellow" hidden><div class="navlb-cat-title">ğŸŸ¨ Moderate discount (âˆ’5 to âˆ’9 %)</div><div id="navlbYellowList"></div></div>
    <div class="navlb-category cat-white" id="navlbWhite" hidden><div class="navlb-cat-title">â¬œï¸ Tight discount (0 to âˆ’4 %)</div><div id="navlbWhiteList"></div></div>

    <div class="navlb-footnote" id="navlbFoot">Figures auto-sourced from AuroraSync.json â€¢ Times shown Europe/London</div>
  </div>
</section>

<style>
@keyframes pulseLine{0%,100%{opacity:.8}50%{opacity:.3}}
.aurora-nav-leaderboard{padding:14px 16px;border-radius:12px;background:rgba(10,10,30,0.65);border:1px solid rgba(0,255,255,0.25);box-shadow:0 0 25px rgba(0,255,255,0.25);backdrop-filter:blur(6px);}
.aurora-nav-leaderboard .navlb-header{display:flex;justify-content:space-between;align-items:baseline;gap:12px;margin-bottom:10px;}
.aurora-nav-leaderboard .navlb-title{font-weight:700;color:var(--cyan);text-shadow:0 0 10px rgba(0,255,255,.6);}
.aurora-nav-leaderboard .navlb-meta{opacity:.85;font-size:.9rem;}
.aurora-nav-leaderboard .navlb-movers{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:10px 0 12px;}
.aurora-nav-leaderboard .navlb-movers h4{margin:0 0 6px;font-size:.95rem;color:#ffd580;text-shadow:0 0 8px rgba(255,213,128,.5);}
.aurora-nav-leaderboard .navlb-movers ul{margin:0;padding-left:18px;line-height:1.35;}
.aurora-nav-leaderboard .navlb-category{margin:12px 0;padding:10px 10px 8px;border-left:4px solid transparent;border-radius:10px;}
.aurora-nav-leaderboard .cat-green{border-left-color:rgba(0,255,170,.6);}
.aurora-nav-leaderboard .cat-yellow{border-left-color:rgba(255,220,0,.7);}
.aurora-nav-leaderboard .cat-white{border-left-color:rgba(255,255,255,.55);}
.aurora-nav-leaderboard .navlb-row{display:grid;grid-template-columns:70px 1fr 80px 80px 80px 80px;gap:8px;align-items:center;padding:8px;border:1px solid rgba(255,255,255,.08);border-radius:10px;background:rgba(255,255,255,.02);}
.aurora-nav-leaderboard .navlb-row .ticker{font-weight:700;color:var(--cyan);text-shadow:0 0 6px rgba(0,255,200,.7);}
.aurora-nav-leaderboard .badge{padding:2px 8px;border-radius:999px;font-size:.8rem;border:1px solid rgba(255,255,255,.12);}
.aurora-nav-leaderboard .navlb-footnote{margin-top:12px;opacity:.75;font-size:.84rem;text-align:center;}
@media(max-width:560px){.aurora-nav-leaderboard .navlb-row{grid-template-columns:70px 1fr;row-gap:6px;}.aurora-nav-leaderboard .navlb-row>*:not(:first-child){grid-column:1/-1;}}
</style>

<script>
(async function(){
  const url="https://raw.githubusercontent.com/webbchrisuk-max/Aurora/refs/heads/main/AuroraSync.json?nocache="+Date.now();
  const meta=document.getElementById("navlbMeta");
  const wid=document.getElementById("navlbWideners");
  const nar=document.getElementById("navlbNarrowers");
  const gl=document.getElementById("navlbGreenList");
  const yl=document.getElementById("navlbYellowList");
  const wl=document.getElementById("navlbWhiteList");
  const green=document.getElementById("navlbGreen");
  const yellow=document.getElementById("navlbYellow");
  const white=document.getElementById("navlbWhite");
  const foot=document.getElementById("navlbFoot");
  const movers=document.getElementById("navlbMovers");
  try{
    const r=await fetch(url,{cache:"no-store"});
    const d=await r.json();
    const w=d.nav_discount_leaderboard?.weekly||{};
    const keys=Object.keys(w);
    if(!keys.length){meta.textContent="No leaderboard data yet.";return;}
    const latest=keys.sort().slice(-1)[0];
    const pack=w[latest];
    meta.textContent=`Week ${latest} â€¢ Generated ${pack.generated_at||"n/a"}`;
    const list=(pack.entries||[]).sort((a,b)=>a.discount_percent-b.discount_percent);
    const rows=e=>`<div class='navlb-row'><div class='ticker'>${e.ticker}</div><div>${e.name}</div><div>Â£${e.share_price}</div><div>Â£${e.nav_or_fair_value}</div><div class='badge'>${e.discount_percent.toFixed(1)}%</div><div class='badge'>${e.wow_change_percent?.toFixed?.(1)||"n/a"}%</div></div>`;
    list.forEach(v=>{
      if(v.discount_percent<=-10)gl.insertAdjacentHTML("beforeend",rows(v));
      else if(v.discount_percent<=-5)yl.insertAdjacentHTML("beforeend",rows(v));
      else if(v.discount_percent<=0)wl.insertAdjacentHTML("beforeend",rows(v));
    });
    if(gl.children.length)green.hidden=false;
    if(yl.children.length)yellow.hidden=false;
    if(wl.children.length)white.hidden=false;
    const top=pack.top_movers||{};
    const widL=(top.wideners||[]).slice(0,3);
    const narL=(top.narrowers||[]).slice(0,3);
    if(widL.length||narL.length){
      movers.hidden=false;
      wid.innerHTML=widL.map(x=>`<li><b>${x.ticker}</b> ${x.wow_change_percent.toFixed(1)}%</li>`).join("");
      nar.innerHTML=narL.map(x=>`<li><b>${x.ticker}</b> ${x.wow_change_percent.toFixed(1)}%</li>`).join("");
    }
    if(d.integrity?.last_validated)
      foot.textContent=`Figures auto-sourced from AuroraSync.json â€¢ Last validated ${d.integrity.last_validated}`;
  }catch(err){meta.textContent="Error loading leaderboard.";console.error(err);}
})();
</script>

</body>
</html>
