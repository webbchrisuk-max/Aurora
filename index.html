<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aurora ISA Tracker – Ultra Edition</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet" />

<style>
:root {
  --cyan:#00ffff;
  --coral:#ff7f50;
  --teal:#00ffd0;
  --amber:#ffb347;
  --green:#00ff7f;
  --bg1:#060018;
  --bg2:#120035;
  --bg3:#001a33;
}

body {
  margin:0;
  padding:0;
  font-family:'Orbitron',sans-serif;
  color:#fff;
  background:linear-gradient(120deg,var(--bg1),var(--bg2),var(--bg3));
  background-size:600% 600%;
  animation:auroraMove 45s ease-in-out infinite;
  overflow-x:hidden;
}

@keyframes auroraMove {
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}

/* ===================== CARDS ===================== */
.card {
  background:rgba(0,0,0,0.35);
  border:1px solid rgba(255,255,255,0.05);
  border-radius:18px;
  padding:18px;
  margin:16px;
  transition:0.35s;
  backdrop-filter:blur(6px);
}

/* Hover & Tap Glow – WORKS ON iPhone + iPad */
.card:hover,
.card:active {
  box-shadow:0 0 20px var(--cyan), 0 0 30px var(--cyan);
  transform:translateY(-3px);
}

/* iPad — WIDE SCREEN CARD LAYOUT IMPROVED */
@media (min-width: 768px) {
  .card {
    max-width:650px;
    margin-left:auto;
    margin-right:auto;
  }
}

/* ===================== GLOW VALUES ===================== */
.positive {
  color:var(--green);
  text-shadow:0 0 10px var(--green);
}

/* ===================== SECTIONS ===================== */
.section-title {
  font-size:1.4rem;
  margin:25px 16px 5px 16px;
  text-shadow:0 0 10px var(--cyan);
}

/* ===================== COUNTDOWN ===================== */
#isa-countdown {
  font-size:1.3rem;
  color:var(--teal);
  text-align:center;
  margin-top:10px;
}

/* ===================== iPad ONLY extra info in cards ===================== */
@media (min-width: 820px) {
  .ipad-extra {
    display:block;
    margin-top:10px;
    font-size:0.9rem;
    opacity:0.85;
  }
}

@media (max-width: 819px) {
  .ipad-extra { display:none; }
}
</style>
</head>
<body>

<h2 class="section-title">Portfolio Summary</h2>
<div class="card">
  <p>Total Value: <span id="totalValue">£0</span></p>
  <p>Total Gain: <span id="totalGain" class="positive">+£0</span></p>
</div>

<h2 class="section-title">ISA Maturity Countdown</h2>
<div class="card">
  <p id="isa-countdown">Loading…</p>
</div>

<h2 class="section-title">Next 5 Dividends</h2>
<div id="nextDivsContainer"></div>

<h2 class="section-title">Next Ex-Dividend Dates</h2>
<div id="nextExDivsContainer"></div>

<h2 class="section-title">Tesco SIP & SAYE</h2>
<div class="card">
  <p>SIP Value: <span class="positive">+£0</span></p>
  <p>SAYE: <span class="positive">+£0</span></p>
</div>

<h2 class="section-title">Holdings</h2>
<div id="holdingsContainer"></div>
<script>
// ========================================================
// FETCH LIVE JSON (AuroraSync.json)
// ========================================================
async function loadData() {
  const url = "https://raw.githubusercontent.com/webbchrisuk-max/Aurora/refs/heads/main/AuroraSync.json";
  const res = await fetch(url + "?nocache=" + Date.now());
  const data = await res.json();
  return data;
}

// ========================================================
// BUILD NEXT 5 DIVIDENDS
// ========================================================
function buildUpcoming(divs) {
  const container = document.getElementById("nextDivsContainer");
  container.innerHTML = "";

  const sorted = divs
    .filter(x => x.upcoming_date)
    .sort((a,b)=> new Date(a.upcoming_date) - new Date(b.upcoming_date))
    .slice(0,5);

  sorted.forEach(d => {
    container.innerHTML += `
      <div class="card">
        <p><strong>${d.ticker}</strong></p>
        <p>Upcoming Dividend: £${d.amount}</p>
        <p>Date: ${d.upcoming_date}</p>
      </div>
    `;
  });
}

// ========================================================
// BUILD NEXT EX-DIV DATES
// ========================================================
function buildExDiv(divs) {
  const container = document.getElementById("nextExDivsContainer");
  container.innerHTML = "";

  const sorted = divs
    .filter(x => x.ex_div)
    .sort((a,b)=> new Date(a.ex_div) - new Date(b.ex_div))
    .slice(0,5);

  sorted.forEach(d => {
    container.innerHTML += `
      <div class="card">
        <p><strong>${d.ticker}</strong></p>
        <p>Ex-Dividend: ${d.ex_div}</p>
      </div>
    `;
  });
}

// ========================================================
// HOLDINGS CARDS (iPad gets extra detail)
// ========================================================
function buildHoldings(holdings) {
  const container = document.getElementById("holdingsContainer");
  container.innerHTML = "";

  holdings.forEach(h => {
    container.innerHTML += `
      <div class="card">
        <p><strong>${h.ticker}</strong></p>
        <p>Shares: ${h.shares}</p>
        <p>Value: £${h.value}</p>
        <p class="positive">Gain: £${h.gain}</p>

        <!-- Only visible on iPad -->
        <div class="ipad-extra">
          <p>Annual Dividend: £${h.annual_dividend}</p>
          <p>Yield: ${h.yield}%</p>
          <p>Next Dividend: £${h.next_div}</p>
          <p>Live Price: £${h.price}</p>
        </div>
      </div>
    `;
  });
}

// ========================================================
// COUNTDOWN TO ISA MATURITY
// ========================================================
function startCountdown(targetDate) {
  const el = document.getElementById("isa-countdown");

  function update() {
    const now = new Date();
    const diff = new Date(targetDate) - now;

    if (diff <= 0) {
      el.innerHTML = "ISA Fully Matured!";
      return;
    }

    const days = Math.floor(diff / (1000*60*60*24));
    const hours = Math.floor((diff / (1000*60*60)) % 24);

    el.innerHTML = `${days} days ${hours} hours remaining`;
  }

  update();
  setInterval(update, 60000);
}

// ========================================================
// MAIN LOAD
// ========================================================
loadData().then(data => {
  buildUpcoming(data.dividend_planner.upcoming);
  buildExDiv(data.dividend_planner.schedule_by_holding);
  buildHoldings(data.isa.ig.holdings);

  document.getElementById("totalValue").innerText = "£" + data.isa.ig.balance;
  document.getElementById("totalGain").innerText = "£" + data.isa.ig.total_gain;

  startCountdown("2026-04-06T00:00:00");
});
</script>

</body>
</html>
