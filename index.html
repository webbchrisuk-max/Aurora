<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aurora ISA Tracker â€“ Ultra Edition</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet" />

<style>
:root {
  --cyan:#00ffff;
  --coral:#ff7f50;
  --teal:#00ffd0;
  --amber:#ffb347;
  --green:#00ff7f;
  --bg1:#060018;
  --bg2:#120035;
  --bg3:#001a33;
}

body {
  margin:0;
  padding:0;
  font-family:'Orbitron',sans-serif;
  color:#fff;
  background:linear-gradient(120deg,var(--bg1),var(--bg2),var(--bg3));
  background-size:600% 600%;
  animation:auroraMove 45s ease-in-out infinite;
  overflow-x:hidden;
}

@keyframes auroraMove {
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}

/* ===================== CARDS ===================== */
.card {
  background:rgba(0,0,0,0.35);
  border:1px solid rgba(255,255,255,0.05);
  border-radius:18px;
  padding:18px;
  margin:16px;
  transition:0.35s;
  backdrop-filter:blur(6px);
}

/* Hover + Tap Glow */
.card:hover,
.card:active {
  box-shadow:0 0 20px var(--cyan), 0 0 30px var(--cyan);
  transform:translateY(-3px);
}

/* iPad wide layout fix */
@media (min-width: 768px) {
  .card {
    max-width:650px;
    margin-left:auto;
    margin-right:auto;
  }
}

/* ===================== GLOW ===================== */
.positive {
  color:var(--green);
  text-shadow:0 0 10px var(--green);
}

.section-title {
  font-size:1.4rem;
  margin:25px 16px 5px 16px;
  text-shadow:0 0 10px var(--cyan);
}

/* ===================== COUNTDOWN ===================== */
#isa-countdown {
  font-size:1.3rem;
  color:var(--teal);
  text-align:center;
  margin-top:10px;
}

/* ===================== iPad extra details ===================== */
@media (min-width: 820px) {
  .ipad-extra {
    display:block;
    margin-top:10px;
    font-size:0.9rem;
    opacity:0.85;
  }
}
@media (max-width: 819px) {
  .ipad-extra { display:none; }
}
</style>
</head>

<body>

<h2 class="section-title">Portfolio Summary</h2>
<div class="card">
  <p>Total Value: <span id="totalValue">Â£0</span></p>
  <p>Total Gain: <span id="totalGain">Â£0</span></p>
</div>

<h2 class="section-title">ISA Maturity Countdown</h2>
<div class="card">
  <p id="isa-countdown">Loadingâ€¦</p>
</div>

<h2 class="section-title">Next 5 Dividends</h2>
<div id="nextDivsContainer"></div>

<h2 class="section-title">Next Ex-Dividend Dates</h2>
<div id="nextExDivsContainer"></div>

<h2 class="section-title">Tesco SIP & SAYE</h2>
<div class="card">
  <p>SIP Value: <span id="sipValue" class="positive">Â£0</span></p>
  <p>SAYE Value: <span id="sayeValue" class="positive">Â£0</span></p>
  <p>Potential Gain: <span id="sayeGain" class="positive">Â£0</span></p>
</div>

<h2 class="section-title">IG ISA Holdings</h2>
<div id="igHoldingsContainer"></div>

<h2 class="section-title">Trade212 ISA Holdings</h2>
<div id="t212HoldingsContainer"></div>
<script>
// ========================================================
// LOAD AURORASYNC.JSON
// ========================================================
async function loadData() {
  const url = "https://raw.githubusercontent.com/webbchrisuk-max/Aurora/main/AuroraSync.json";
  const res = await fetch(url + "?nocache=" + Date.now());
  return await res.json();
}

// ========================================================
// NEXT 5 DIVIDENDS
// ========================================================
function buildNextFive(divs) {
  const container = document.getElementById("nextDivsContainer");
  container.innerHTML = "";

  divs.slice(0, 5).forEach(d => {
    container.innerHTML += `
      <div class="card">
        <p><strong>${d.ticker}</strong></p>
        <p>Dividend: Â£${d.total_dividend}</p>
        <p>Pay Date: ${d.pay_date}</p>
      </div>`;
  });
}

// ========================================================
// NEXT EX-DIV DATES (sorted from upcoming)
// ========================================================
function buildExDiv(divs) {
  const container = document.getElementById("nextExDivsContainer");
  container.innerHTML = "";

  const sorted = divs
    .filter(x => x.ex_div_date)
    .sort((a, b) => new Date(a.ex_div_date) - new Date(b.ex_div_date))
    .slice(0, 5);

  sorted.forEach(x => {
    container.innerHTML += `
      <div class="card">
        <p><strong>${x.ticker}</strong></p>
        <p>Ex-Div Date: ${x.ex_div_date}</p>
      </div>`;
  });
}

// ========================================================
// HOLDINGS SECTIONS
// ========================================================
function buildHoldings(list, target) {
  const container = document.getElementById(target);
  container.innerHTML = "";

  list.forEach(h => {
    container.innerHTML += `
      <div class="card">
        <p><strong>${h.ticker}</strong> â€” ${h.name}</p>
        <p>Shares: ${h.shares}</p>
        <p>Value: Â£${h.value.toFixed(2)}</p>
        <p class="positive">Gain: Â£${h.gain_value.toFixed(2)}</p>

        <div class="ipad-extra">
          <p>Annual Dividend: Â£${h.annual_income.toFixed(2)}</p>
          <p>Yield: ${h.annual_div_yield.toFixed(2)}%</p>
          <p>Live Price: Â£${h.live_price}</p>
        </div>
      </div>`;
  });
}

// ========================================================
// COUNTDOWN TO ISA MATURITY (2029)
// ========================================================
function startCountdown(date) {
  const el = document.getElementById("isa-countdown");

  function tick() {
    const now = new Date();
    const diff = new Date(date) - now;

    if (diff <= 0) {
      el.innerHTML = "ISA Migration Year Started ðŸ”¥";
      return;
    }

    const days = Math.floor(diff / 86400000);
    const hours = Math.floor((diff % 86400000) / 3600000);

    el.innerHTML = `${days} days ${hours} hours remaining`;
  }

  tick();
  setInterval(tick, 60000);
}

// ========================================================
// MAIN EXECUTION
// ========================================================
loadData().then(data => {

  // ===== Portfolio Summary =====
  const totalValue = data.isa.ig_isa.balance + data.isa.trade212_isa.balance;
  const totalGain = data.isa.ig_isa.unrealised_gain + data.isa.trade212_isa.unrealised_gain;

  document.getElementById("totalValue").innerText = "Â£" + totalValue.toFixed(2);
  document.getElementById("totalGain").innerText = "Â£" + totalGain.toFixed(2);

  // ===== Tesco =====
  document.getElementById("sipValue").innerText = "Â£" + data.tesco.summary.sip_value_gbp.toFixed(2);
  document.getElementById("sayeValue").innerText = "Â£" + data.tesco.summary.saye_current_value_gbp.toFixed(2);
  document.getElementById("sayeGain").innerText = "Â£" + data.tesco.summary.saye_potential_gain_gbp.toFixed(2);

  // ===== Dividends =====
  buildNextFive(data.isa.dividends.next_five);
  buildExDiv(data.isa.dividends.upcoming);

  // ===== Holdings =====
  buildHoldings(data.isa.holdings.ig_isa, "igHoldingsContainer");
  buildHoldings(data.isa.holdings.trade212_isa, "t212HoldingsContainer");

  // ===== Countdown =====
  startCountdown(data.tesco.isa_migration_plan.maturity_date);

});
</script>

</body>
</html>
