<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aurora Tracker – HyperGrid Live Feed v3.3</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

<!-- ===================== SECTION: THEME & BACKGROUND ===================== -->
<style>
:root{
  --cyan:#00ffff;
  --magenta:#ff00ff;
  --green:#00ff99;
  --bg1:#01000a;
  --bg2:#090024;
  --bg3:#001a33;
  --bg4:#1a0033;
  --bg5:#003344;
}

body{
  margin:0;padding:0;font-family:'Orbitron',sans-serif;color:#fff;
  background:linear-gradient(125deg,var(--bg1),var(--bg2),var(--bg3),var(--bg4),var(--bg5));
  background-size:800% 800%;
  animation:auroraDrift 40s linear infinite;
  overflow-x:hidden;
}
@keyframes auroraDrift{
  0%{background-position:0% 50%;}
  25%{background-position:50% 100%;}
  50%{background-position:100% 50%;}
  75%{background-position:50% 0%;}
  100%{background-position:0% 50%;}
}

/* headers */
h1{text-align:center;font-size:1.8rem;margin:20px 0;color:#fff;text-shadow:0 0 25px var(--cyan);}
h2,h3{color:#fff;text-shadow:0 0 12px rgba(255,255,255,0.8);margin-top:0.5em;}

.dashboard{display:grid;grid-template-columns:repeat(auto-fit,minmax(480px,1fr));gap:20px;margin:0 5%;}
.card{
  background:rgba(10,10,30,0.65);
  border:1px solid rgba(0,255,255,0.25);
  border-radius:10px;padding:20px;
  box-shadow:0 0 20px rgba(0,255,255,0.15);
  backdrop-filter:blur(6px);
  animation:fadeIn 1s ease-in-out;
}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}

/* tables */
.table-holder{overflow-x:auto;max-height:350px;}
table{width:100%;border-collapse:collapse;font-size:0.9rem;}
th,td{padding:6px 8px;text-align:left;}
th{color:var(--cyan);}
tr:nth-child(even){background:rgba(255,255,255,0.05);}
tr:hover{background:rgba(0,255,255,0.1);}
.value{color:var(--cyan);}
.gain-pos{color:var(--green);}
.gain-neg{color:#ff5555;}

/* sync */
#auroraSyncStatus{position:fixed;top:10px;right:20px;font-size:0.85rem;color:#fff;}
#auroraSyncDot{display:inline-block;width:10px;height:10px;border-radius:50%;
background:var(--cyan);box-shadow:0 0 10px var(--cyan);
margin-right:6px;vertical-align:middle;animation:pulseGlow 3s ease-in-out infinite;}
@keyframes pulseGlow{0%,100%{box-shadow:0 0 10px var(--cyan);}50%{box-shadow:0 0 25px var(--magenta);}}
#syncTime{display:block;font-size:0.75rem;color:#aaa;margin-top:2px;}
.amount-green{color:var(--green);}
.date-pink{color:#ff66cc;}

@media(max-width:720px){.dashboard{grid-template-columns:1fr;margin:0 3%;}}

/* bar charts and sector bars */
.bar{border-radius:4px;transition:height 0.5s ease;}
.sector-bars{margin-top:25px;display:flex;flex-direction:column;gap:10px;}
.sector-bar{display:flex;align-items:center;justify-content:space-between;gap:10px;font-size:0.9rem;}
.sector-bar span{min-width:110px;text-shadow:0 0 8px rgba(255,255,255,0.6);}
.sector-bar .val{min-width:40px;text-align:right;}
.bar-line{flex-grow:1;height:10px;border-radius:5px;background:rgba(255,255,255,0.1);position:relative;overflow:hidden;}
.bar-line::after{content:"";position:absolute;top:0;left:0;height:100%;width:var(--p);
background:linear-gradient(90deg,var(--cyan),var(--magenta));border-radius:5px;
box-shadow:0 0 8px var(--cyan);animation:growBar 1.6s ease-out forwards;}
@keyframes growBar{from{width:0;opacity:0.4;}to{width:var(--p);opacity:1;}}
</style>
</head>

<body>
<h1>Aurora Tracker – HyperGrid Live Feed v3.3</h1>

<!-- ===================== SYNC STATUS ===================== -->
<div id="auroraSyncStatus">
  <span id="auroraSyncDot"></span>Synced
  <span id="syncTime">Last updated --:--</span>
</div>

<!-- ===================== DASHBOARD ===================== -->
<div class="dashboard">

  <div class="card" id="portfolio-summary">
    <h2>Portfolio Summary</h2>
    <p>Total Target: £<span id="targetValue">0.00</span></p>
    <p>Dividend Yield: <span id="divYield">0.00</span>%</p>
    <p>Total Gain: £<span id="totalGain">0.00</span> (<span id="gainPercent">0.00</span>%)</p>
  </div>

  <div class="card" id="isa-balances">
    <h2>ISA Balances</h2>
    <p>IG ISA: £<span id="igBalance">0.00</span></p>
    <p>Trade212 ISA: £<span id="t212Balance">0.00</span></p>
  </div>

  <div class="card" id="ig-holdings">
    <h2>IG ISA Holdings</h2>
    <div class="table-holder">
      <table id="igTable">
        <thead><tr><th>Name</th><th>Value (£)</th><th>Gain (£)</th><th>Gain (%)</th><th>Yield (%)</th><th>Income (£)</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="card" id="t212-holdings">
    <h2>Trade212 Holdings</h2>
    <div class="table-holder">
      <table id="t212Table">
        <thead><tr><th>Name</th><th>Value (£)</th><th>Gain (£)</th><th>Gain (%)</th><th>Yield (%)</th><th>Income (£)</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="card" id="dividends">
    <h2>Dividends Centre</h2>
    <h3>Next 5 Dividends</h3>
    <ul id="nextDivs"></ul>
    <h3>Next 5 Ex-Dividends</h3>
    <ul id="nextExDivs"></ul>
  </div>

  <!-- ===================== DIVIDEND CHARTS ===================== -->
  <div class="card" id="dividend-charts">
    <h2>Dividend Income Overview</h2>
    <div style="display:flex;flex-wrap:wrap;justify-content:space-between;gap:18px;">
      <div style="flex:1 1 45%;text-align:center;">
        <h3>Monthly Breakdown</h3>
        <div id="monthlyBars" style="display:flex;justify-content:space-around;align-items:flex-end;height:240px;margin-top:12px;gap:10px;"></div>
      </div>
      <div style="flex:1 1 45%;text-align:center;">
        <h3>Quarterly Totals</h3>
        <div id="quarterlyBars" style="display:flex;justify-content:space-around;align-items:flex-end;height:240px;margin-top:12px;gap:10px;"></div>
      </div>
    </div>
  </div>

  <!-- ===================== SECTOR ALLOCATION (RINGS + BARS) ===================== -->
  <div class="card" id="sector-allocation">
    <h2>Sector Allocation Overview</h2>
    <div style="display:flex;flex-wrap:wrap;justify-content:space-around;gap:20px;">
      <div style="text-align:center;">
        <h3>IG ISA</h3>
        <canvas id="igSectorRing" width="200" height="200"></canvas>
      </div>
      <div style="text-align:center;">
        <h3>Trade212 ISA</h3>
        <canvas id="t212SectorRing" width="200" height="200"></canvas>
      </div>
    </div>
    <div class="sector-bars">
      <div class="sector-bar"><span>Financials</span><div class="bar-line" style="--p:28%;"></div><span class="val">28%</span></div>
      <div class="sector-bar"><span>Utilities</span><div class="bar-line" style="--p:14%;"></div><span class="val">14%</span></div>
      <div class="sector-bar"><span>Consumer Defensive</span><div class="bar-line" style="--p:22%;"></div><span class="val">22%</span></div>
      <div class="sector-bar"><span>Real Estate</span><div class="bar-line" style="--p:9%;"></div><span class="val">9%</span></div>
      <div class="sector-bar"><span>Energy</span><div class="bar-line" style="--p:10%;"></div><span class="val">10%</span></div>
      <div class="sector-bar"><span>Technology</span><div class="bar-line" style="--p:17%;"></div><span class="val">17%</span></div>
    </div>
  </div>

</div>

<!-- ===================== SCRIPT ===================== -->
<script>
async function loadAuroraSync() {
  const dot=document.getElementById("auroraSyncDot");
  const syncTime=document.getElementById("syncTime");
  try{
    const url="https://raw.githubusercontent.com/webbchrisuk-max/Aurora/main/AuroraSync.json?nocache="+Date.now();
    const response=await fetch(url);
    const data=await response.json();
    dot.style.background="var(--green)";
    dot.style.boxShadow="0 0 15px var(--green)";
    syncTime.textContent="Last updated "+new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})+" · Live";
    populateDashboard(data);
  }catch(err){
    dot.style.background="#666";
    dot.style.boxShadow="0 0 8px #666";
    syncTime.textContent="Sync failed · retrying soon";
  }
}

function populateDashboard(data){
  document.getElementById("targetValue").textContent=data.isa.portfolio_summary.annual_target_value.toFixed(2);
  document.getElementById("divYield").textContent=data.isa.portfolio_summary.dividend_yield.toFixed(2);
  document.getElementById("igBalance").textContent=data.isa.ig_isa.balance.toFixed(2);
  document.getElementById("t212Balance").textContent=data.isa.trade212_isa.balance.toFixed(2);
  const gain=data.isa.ig_isa.unrealised_gain+data.isa.trade212_isa.unrealised_gain;
  const gainPct=(gain/(data.isa.ig_isa.book_cost+data.isa.trade212_isa.book_cost))*100;
  document.getElementById("totalGain").textContent=gain.toFixed(2);
  document.getElementById("gainPercent").textContent=gainPct.toFixed(2);
  populateTables(data);
  populateDividends(data);
  buildCharts(data);
  buildSectorRings(data);
}

function populateTables(data){
  const igBody=document.querySelector("#igTable tbody");igBody.innerHTML="";
  data.isa_feed.filter(x=>x.account==="IG ISA").forEach(h=>{
    igBody.innerHTML+=`<tr><td>${h.name}</td><td class="value">${(+h.value).toFixed(2)}</td>
    <td class="${(+h.gain_value)>=0?'gain-pos':'gain-neg'}">${(+h.gain_value).toFixed(2)}</td>
    <td>${(+h.gain_percentage).toFixed(2)}%</td><td>${(+h.annual_div_yield).toFixed(2)}%</td>
    <td>£${(+h.annual_income).toFixed(2)}</td></tr>`;});
  const tBody=document.querySelector("#t212Table tbody");tBody.innerHTML="";
  data.isa_feed.filter(x=>x.account==="TRADE212").forEach(h=>{
    tBody.innerHTML+=`<tr><td>${h.name}</td><td class="value">${(+h.value).toFixed(2)}</td>
    <td class="${(+h.gain_value)>=0?'gain-pos':'gain-neg'}">${(+h.gain_value).toFixed(2)}</td>
    <td>${(+h.gain_percentage).toFixed(2)}%</td><td>${(+h.annual_div_yield).toFixed(2)}%</td>
    <td>£${(+h.annual_income).toFixed(2)}</td></tr>`;});
}

function populateDividends(data){
  const nextDivs=data.dividends_feed.filter(x=>["Confirmed","Estimated"].includes(x.status))
    .sort((a,b)=>new Date(a.pay_date)-new Date(b.pay_date)).slice(0,5);
  const nextEx=data.dividends_feed.filter(x=>["Confirmed","Estimated"].includes(x.status))
    .sort((a,b)=>new Date(a.ex_div_date)-new Date(b.ex_div_date)).slice(0,5);
  const nd=document.getElementById("nextDivs"),ne=document.getElementById("nextExDivs");
  nd.innerHTML="";ne.innerHTML="";
  nextDivs.forEach(d=>{nd.innerHTML+=`<li><span>${d.ticker}</span> – 
  <span class="amount-green">£${(+d.total_dividend).toFixed(2)}</span> 
  <span class="date-pink">(${d.pay_date})</span></li>`;});
  nextEx.forEach(d=>{ne.innerHTML+=`<li><span>${d.ticker}</span> – 
  <span class="date-pink">${d.ex_div_date}</span></li>`;});
}

function buildCharts(data){
  const monthly=document.getElementById("monthlyBars");
  const quarterly=document.getElementById("quarterlyBars");
  monthly.innerHTML="";quarterly.innerHTML="";
  data.dividend_planner.monthly_breakdown.forEach(m=>{
    const val=+m.total_estimated_income;
    const h=Math.max(8,Math.min(220,val/10));
    const b=document.createElement("div");
    b.className="bar";b.style.height=h+"px";b.style.width="18px";
    b.style.background="linear-gradient(180deg,var(--cyan),var(--magenta))";
    b.title=`${m.month}: £${val.toFixed(2)}`;
    monthly.appendChild(b);
  });
  Object.entries(data.dividend_planner.quarterly_breakdown).forEach(([q,v])=>{
    const val=+v;const h=Math.max(12,Math.min(220,val/5));
    const b=document.createElement("div");
    b.className="bar";b.style.height=h+"px";b.style.width="45px";
    b.style.background="linear-gradient(180deg,var(--magenta),var(--cyan))";
    b.title=`${q}: £${val.toFixed(2)}`;
    quarterly.appendChild(b);
  });
}

function buildSectorRings(data){
  const ctx1=document.getElementById("igSectorRing").getContext("2d");
  const ctx2=document.getElementById("t212SectorRing").getContext("2d");
  drawRing(ctx1,data.isa.portfolio_summary.sector_allocation,"var(--cyan)");
  drawRing(ctx2,data.isa.portfolio_summary.sector_allocation,"var(--magenta)");
}
function drawRing(ctx,sectors,color){
  const total=Object.values(sectors).reduce((a,b)=>a+b,0);let start=0;
  Object.entries(sectors).forEach(([k,v])=>{
    const slice=(v/total)*2*Math.PI;
    ctx.beginPath();ctx.strokeStyle=color;ctx.lineWidth=18;ctx.shadowBlur=10;ctx.shadowColor=color;
    ctx.arc(100,100,70,start,start+slice);ctx.stroke();start+=slice;
  });
}

loadAuroraSync();
setInterval(loadAuroraSync,300000);
</script>
</body>
</html>
