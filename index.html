<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aurora ISA Tracker â€“ Cinematic Edition</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />

<style>
:root{
  --cyan:#00eaff;
  --coral:#ff7f50;
  --teal:#00ffd0;
  --amber:#ffb347;
  --bg1:#060018;
  --bg2:#120035;
  --bg3:#001a33;
}

body{
  margin:0;padding:0;
  font-family:'Orbitron',sans-serif;
  background:linear-gradient(120deg,var(--bg1),var(--bg2),var(--bg3));
  background-size:600% 600%;
  animation:auroraDrift 40s ease-in-out infinite;
  color:#fff;
}

@keyframes auroraDrift{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}

.container{
  padding:20px;
  max-width:1100px;
  margin:auto;
}

.section-title{
  font-size:22px;
  font-weight:700;
  color:var(--cyan);
  margin-top:35px;
  text-align:center;
  text-shadow:0 0 10px var(--cyan);
}

.card{
  background:rgba(255,255,255,0.06);
  border:1px solid rgba(255,255,255,0.15);
  border-radius:16px;
  padding:18px;
  margin-bottom:20px;
  backdrop-filter:blur(8px);
  box-shadow:0 0 15px rgba(0,255,255,0.2);
}

.table{
  width:100%;
  border-collapse:collapse;
  margin-top:12px;
}

.table th{
  padding:10px;
  background:rgba(0,200,255,0.3);
  border-bottom:1px solid var(--cyan);
}

.table td{
  padding:8px;
  border-bottom:1px solid rgba(255,255,255,0.1);
}

.dividend-item{
  padding:10px 12px;
  background:rgba(255,255,255,0.07);
  border:1px solid rgba(255,255,255,0.15);
  border-radius:12px;
  display:flex;
  justify-content:space-between;
  margin-bottom:10px;
  font-size:14px;
}
</style>

<script>
const AURORA_SYNC =
  "https://raw.githubusercontent.com/webbchrisuk-max/Aurora/refs/heads/main/AuroraSync.json";

async function loadJSON(url){
  const r = await fetch(url + "?nocache=" + Date.now());
  return await r.json();
}

async function initAurora(){
  const sync = await loadJSON(AURORA_SYNC);

  renderPortfolio(sync);
  renderWatchlist(sync);
  renderIG(sync);
  renderT212(sync);
  renderTesco(sync);
  renderReits(sync);
  renderFinancials(sync);
  renderNextFive(sync);
  renderUpcoming(sync);
  renderYTD(sync);
  renderChart(sync);
}
</script>
</head>

<body onload="initAurora()">

<div class="container">

  <h1 class="section-title">ðŸŒŒ Aurora ISA Tracker â€“ Cinematic Edition</h1>

  <!-- ====================== PORTFOLIO SUMMARY ====================== -->
  <div class="card">
    <h2 class="section-title">Portfolio Summary</h2>
    <div id="portfolio-summary"></div>
  </div>

  <!-- ====================== WATCHLIST SUMMARY ====================== -->
  <div class="card">
    <h2 class="section-title">Watchlist Summary</h2>
    <div id="watchlist-summary"></div>
  </div>

  <!-- ====================== IG ISA ====================== -->
  <div class="card">
    <h2 class="section-title">IG ISA Holdings</h2>
    <div id="ig-table"></div>
  </div>

  <!-- ====================== TRADE212 ISA ====================== -->
  <div class="card">
    <h2 class="section-title">Trade212 ISA Holdings</h2>
    <div id="t212-table"></div>
  </div>

  <!-- ====================== TESCO SHARE PLAN ====================== -->
  <div class="card">
    <h2 class="section-title">Tesco Share Plan</h2>
    <div id="tesco-block"></div>
  </div>

  <!-- ====================== REITS OUTLOOK ====================== -->
  <div class="card">
    <h2 class="section-title">REITs Outlook</h2>
    <div id="reits-outlook"></div>
  </div>

  <!-- ====================== FINANCIALS OUTLOOK ====================== -->
  <div class="card">
    <h2 class="section-title">Financials Outlook</h2>
    <div id="financials-outlook"></div>
  </div>

  <!-- ====================== NEXT 5 DIVIDENDS ====================== -->
  <div class="card">
    <h2 class="section-title">Next 5 Dividends</h2>
    <div id="next5"></div>
  </div>

  <!-- ====================== UPCOMING DIVIDENDS ====================== -->
  <div class="card">
    <h2 class="section-title">Upcoming Dividends</h2>
    <div id="upcoming"></div>
  </div>

  <!-- ====================== 12-MONTH FORECAST ====================== -->
  <div class="card chart-box">
    <h2 class="section-title">12-Month Dividend Forecast</h2>
    <canvas id="divChart"></canvas>
  </div>

  <!-- ====================== YEAR-TO-DATE ====================== -->
  <div class="card">
    <h2 class="section-title">Year-To-Date Income</h2>
    <div id="ytd"></div>
  </div>

</div>

<script>

/* ---------------- PORTFOLIO SUMMARY ---------------- */
function renderPortfolio(sync){
  const ig = sync?.isa?.ig_isa?.balance || 0;
  const t212 = sync?.isa?.trade212_isa?.balance || 0;
  const annual = sync?.isa?.portfolio_summary?.annual_income_gbp || 0;
  const total = sync?.isa?.portfolio_summary?.total_value || 0;

  document.getElementById("portfolio-summary").innerHTML = `
    <p><strong>IG ISA Value:</strong> Â£${ig.toFixed(2)}</p>
    <p><strong>Trade212 ISA Value:</strong> Â£${t212.toFixed(2)}</p>
    <p><strong>Total Portfolio Value:</strong> Â£${total.toFixed(2)}</p>
    <p><strong>Projected Annual Income:</strong> Â£${annual.toFixed(2)}</p>
  `;
}

/* ---------------- WATCHLIST SUMMARY ---------------- */
function renderWatchlist(sync){
  const w = sync?.watchlist_summary;
  if(!w){
    document.getElementById("watchlist-summary").innerHTML = "<p>No watchlist data.</p>";
    return;
  }

  let html = "<ul>";
  w.top_discounted.forEach(x=>{
    html += `<li>${x.ticker} â€“ ${x.discount}% discount</li>`;
  });
  html += "</ul>";

  document.getElementById("watchlist-summary").innerHTML = html;
}

/* ---------------- IG ---------------- */
function renderIG(sync){
  const ig = sync?.isa?.holdings?.ig_isa;
  if(!ig){
    document.getElementById("ig-table").innerHTML = "<p>No IG data.</p>";
    return;
  }

  let html = `
  <table class="table">
    <tr>
      <th>Ticker</th><th>Name</th><th>Shares</th><th>Value</th><th>Book</th><th>Gain</th>
    </tr>
  `;

  ig.forEach(h=>{
    const gain = Number(h.gain_value || 0);
    html += `
      <tr>
        <td>${h.ticker}</td>
        <td>${h.name}</td>
        <td>${h.shares}</td>
        <td>Â£${Number(h.value).toFixed(2)}</td>
        <td>Â£${Number(h.book_cost).toFixed(2)}</td>
        <td style="color:${gain>=0?"lime":"red"}">Â£${gain.toFixed(2)}</td>
      </tr>
    `;
  });

  html += `</table>`;
  document.getElementById("ig-table").innerHTML = html;
}

/* ---------------- T212 ---------------- */
function renderT212(sync){
  const t = sync?.isa?.holdings?.trade212_isa;
  if(!t){
    document.getElementById("t212-table").innerHTML = "<p>No Trade212 data.</p>";
    return;
  }

  let html = `
  <table class="table">
    <tr>
      <th>Ticker</th><th>Name</th><th>Shares</th><th>Value</th><th>Book</th><th>Gain</th>
    </tr>
  `;

  t.forEach(h=>{
    const gain = Number(h.gain_value || 0);
    html += `
      <tr>
        <td>${h.ticker}</td>
        <td>${h.name}</td>
        <td>${h.shares}</td>
        <td>Â£${Number(h.value).toFixed(2)}</td>
        <td>Â£${Number(h.book_cost).toFixed(2)}</td>
        <td style="color:${gain>=0?"lime":"red"}">Â£${gain.toFixed(2)}</td>
      </tr>
    `;
  });

  html += `</table>`;
  document.getElementById("t212-table").innerHTML = html;
}

/* ---------------- TESCO BLOCK ---------------- */
function renderTesco(sync){
  const t = sync?.tesco_share_plan;
  if(!t){
    document.getElementById("tesco-block").innerHTML = "<p>No Tesco data.</p>";
    return;
  }

  document.getElementById("tesco-block").innerHTML = `
    <p><strong>Total Shares:</strong> ${t.total_shares}</p>
    <p><strong>BAYE Shares:</strong> ${t.baye_shares}</p>
    <p><strong>Dividend Shares:</strong> ${t.dividend_shares}</p>
    <p><strong>Current Price:</strong> Â£${t.current_price_pence / 100}</p>
    <p><strong>Indicative Value:</strong> Â£${t.indicative_value_gbp.toFixed(2)}</p>
    <p><strong>Potential Gain:</strong> Â£${t.potential_gain_gbp.toFixed(2)}</p>
  `;
}

/* ---------------- REITS OUTLOOK ---------------- */
function renderReits(sync){
  const r = sync?.reits_outlook;
  let html = "<ul>";
  for(const key in r){
    html += `<li><strong>${key}</strong> â€“ ${r[key].status}<br>${r[key].notes}</li>`;
  }
  html += "</ul>";
  document.getElementById("reits-outlook").innerHTML = html;
}

/* ---------------- FINANCIALS OUTLOOK ---------------- */
function renderFinancials(sync){
  const f = sync?.financials_outlook;
  let html = "<ul>";
  for(const key in f){
    html += `<li><strong>${key}</strong> â€“ ${f[key].status}<br>${f[key].notes}</li>`;
  }
  html += "</ul>";
  document.getElementById("financials-outlook").innerHTML = html;
}

/* ---------------- NEXT FIVE ---------------- */
function renderNextFive(sync){
  const next = sync?.isa?.dividends?.next_five || [];
  if(next.length === 0){
    document.getElementById("next5").innerHTML = "<p>No data.</p>";
    return;
  }

  let html = "";
  next.forEach(d=>{
    html += `
      <div class="dividend-item">
        <div><strong>${d.ticker}</strong><br>Ex: ${d.ex_div_date}<br>Pay: ${d.pay_date}</div>
        <div>Â£${Number(d.total_dividend).toFixed(2)}</div>
      </div>
    `;
  });

  document.getElementById("next5").innerHTML = html;
}

/* ---------------- UPCOMING ---------------- */
function renderUpcoming(sync){
  const all = sync?.isa?.dividends?.upcoming || [];
  if (!all.length){
    document.getElementById("upcoming").innerHTML = "<p>No upcoming ex-dividend dates.</p>";
    return;
  }

  const today = new Date();

  const futureEx = all.filter(d => new Date(d.ex_div_date) >= today);
  futureEx.sort((a,b)=>new Date(a.ex_div_date)-new Date(b.ex_div_date));

  const next5 = futureEx.slice(0,5);

  let html = "";
  next5.forEach(d => {
    html += `
      <div class="dividend-item">
        <div>
          <strong>${d.ticker}</strong><br>
          Ex: ${d.ex_div_date}<br>
          Pay: ${d.pay_date}<br>
          Status: ${d.status}
        </div>
        <div>Â£${Number(d.total_dividend).toFixed(2)}</div>
      </div>
    `;
  });

  document.getElementById("upcoming").innerHTML = html;
}

/* ---------------- YTD ---------------- */
function renderYTD(sync){
  const totals = sync?.isa?.dividends?.monthly_totals || {};
  let ytd = 0;
  const year = new Date().getFullYear();

  Object.keys(totals).forEach(m=>{
    if(m.startsWith(year.toString())) ytd += totals[m];
  });

  document.getElementById("ytd").innerHTML = `<h3>Â£${ytd.toFixed(2)}</h3>`;
}

/* ---------------- CHART ---------------- */
function renderChart(sync){
  const totals = sync?.isa?.dividends?.monthly_totals;
  if(!totals) return;

  const labels = Object.keys(totals);
  const values = labels.map(k=>totals[k]);

  const ctx = document.getElementById("divChart").getContext("2d");

  new Chart(ctx,{
    type:"bar",
    data:{
      labels:labels,
      datasets:[{
        label:"Total (Â£)",
        data:values,
        borderWidth:1
      }]
    },
    options:{
      plugins:{legend:{display:false}},
      scales:{y:{beginAtZero:true}}
    }
  });
}
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>
</html>