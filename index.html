<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aurora Tracker â€“ Cinematic Edition</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />

<style>
/* ================================================
   CINEMATIC GLOBAL STYLING
================================================ */
:root {
  --cyan: #00eaff;
  --coral: #ff7f50;
  --teal: #00ffd0;
  --amber: #ffb347;
  --bg1: #060018;
  --bg2: #120035;
  --bg3: #001a33;
}

body {
  margin: 0;
  padding: 0;
  font-family: 'Orbitron', sans-serif;
  background: linear-gradient(120deg, var(--bg1), var(--bg2), var(--bg3));
  background-size: 600% 600%;
  animation: auroraDrift 40s ease-in-out infinite;
  color: #fff;
}

@keyframes auroraDrift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* ================================================
   CONTAINERS + TITLES
================================================ */
.container {
  padding: 20px;
  max-width: 1100px;
  margin: auto;
}

.section-title {
  font-size: 22px;
  font-weight: 700;
  color: var(--cyan);
  margin-top: 35px;
  text-align: center;
  text-shadow: 0 0 10px var(--cyan);
}

/* ================================================
   CARD STYLING
================================================ */
.card {
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 16px;
  padding: 18px;
  margin-bottom: 18px;
  backdrop-filter: blur(8px);
  box-shadow: 0 0 15px rgba(0,255,255,0.2);
}

/* ================================================
   TABLE STYLING
================================================ */
.table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 12px;
}

.table th {
  padding: 10px;
  background: rgba(0, 200, 255, 0.3);
  border-bottom: 1px solid var(--cyan);
}

.table td {
  padding: 8px;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}

/* ================================================
   UPCOMING DIVIDENDS 5x
================================================ */
.dividend-item {
  padding: 8px 12px;
  background: rgba(255,255,255,0.07);
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 12px;
  margin-bottom: 10px;
  display: flex;
  justify-content: space-between;
}

/* ================================================
   CHART AREA
================================================ */
.chart-box {
  padding: 18px;
  margin-bottom: 25px;
}

/* ================================================
   JS FETCH URLs (IMPORTANT)
================================================ */
</style>

<script>
/* ==========================================================
   DATA SOURCES â€” LIVE ENDPOINTS
========================================================== */
const AURORA_SYNC =
  "https://raw.githubusercontent.com/webbchrisuk-max/Aurora/refs/heads/main/AuroraSync.json";

const AURORA_MONZO =
  "https://raw.githubusercontent.com/webbchrisuk-max/Aurora/refs/heads/main/AuroraMonzo.json";

/* JSON LOADER */
async function loadJSON(url) {
  const r = await fetch(url + "?nocache=" + Date.now());
  return await r.json();
}

/* ==========================================================
   LOAD ALL DATA
========================================================== */
async function initAurora() {
  const sync = await loadJSON(AURORA_SYNC);
  const monzo = await loadJSON(AURORA_MONZO);

  renderHoldings(sync);
  renderPortfolio(sync);
  renderUpcoming(sync);
  renderDivChart(sync);
  renderYTD(sync);
}
</script>
</head>

<body onload="initAurora()">

<div class="container">
  <h1 class="section-title">ðŸŒŒ Aurora Tracker â€“ Cinematic Edition</h1>

  <!-- HOLDINGS TABLE -->
  <div class="card" id="holdings-card">
    <h2 class="section-title">Holdings Overview</h2>
    <div id="holdings-table"></div>
  </div>

  <!-- PORTFOLIO SUMMARY -->
  <div class="card">
    <h2 class="section-title">Portfolio Summary</h2>
    <div id="portfolio-summary"></div>
  </div>

  <!-- NEXT 5 DIVIDENDS -->
  <div class="card">
    <h2 class="section-title">Next 5 Dividends</h2>
    <div id="next5"></div>
  </div>

  <!-- DIVIDEND CHART -->
  <div class="card chart-box">
    <h2 class="section-title">Dividend Forecast (12 Months)</h2>
    <canvas id="divChart"></canvas>
  </div>

  <!-- YEAR TO DATE -->
  <div class="card">
    <h2 class="section-title">Year-To-Date Dividend Income</h2>
    <div id="ytd"></div>
  </div>
  <script>
/* ==========================================================
   RENDER HOLDINGS TABLE
========================================================== */
function renderHoldings(sync) {
  if (!sync.isa?.trade212_isa?.holdings &&
      !sync.isa?.ig_isa_holdings &&
      !sync.holdings) {
    document.getElementById("holdings-table").innerHTML =
      "<p>No holdings found.</p>";
    return;
  }

  const holdings =
    sync.isa?.trade212_isa?.holdings ||
    sync.isa?.ig_isa_holdings ||
    sync.holdings;

  let html = `
    <table class="table">
      <tr>
        <th>Ticker</th>
        <th>Name</th>
        <th>Value</th>
        <th>Book Cost</th>
        <th>G/L</th>
      </tr>
  `;

  holdings.forEach(h => {
    const gain = (h.value - h.book_cost).toFixed(2);
    html += `
      <tr>
        <td>${h.ticker}</td>
        <td>${h.name}</td>
        <td>Â£${h.value}</td>
        <td>Â£${h.book_cost}</td>
        <td style="color:${gain >= 0 ? 'lime' : 'red'}">Â£${gain}</td>
      </tr>
    `;
  });

  html += `</table>`;
  document.getElementById("holdings-table").innerHTML = html;
}

/* ==========================================================
   PORTFOLIO SUMMARY
========================================================== */
function renderPortfolio(sync) {
  if (!sync.isa?.portfolio_summary) return;

  const p = sync.isa.portfolio_summary;

  document.getElementById("portfolio-summary").innerHTML = `
    <p><strong>Total Value:</strong> Â£${p.total_value || "?"}</p>
    <p><strong>Annual Yield:</strong> ${p.dividend_yield}%</p>
    <p><strong>Projected Annual Income:</strong> Â£${p.annual_income_gbp}</p>
    <p><strong>Last Calculated:</strong> ${p.last_calculated}</p>
  `;
}

/* ==========================================================
   NEXT 5 UPCOMING DIVIDENDS
========================================================== */
function renderUpcoming(sync) {
  const schedule = sync.dividend_planner?.schedule_by_holding;
  if (!schedule) return;

  // Flatten + sort by date
  let events = [];
  for (const key in schedule) {
    const e = schedule[key];
    events.push({
      ticker: key,
      amount: e.next_amount,
      ex: e.next_ex_date,
      pay: e.next_pay_date
    });
  }

  events = events
    .filter(e => e.pay)
    .sort((a,b) => new Date(a.pay) - new Date(b.pay))
    .slice(0,5);

  let html = "";
  events.forEach(e => {
    html += `
      <div class="dividend-item">
        <div>
          <strong>${e.ticker}</strong><br>
          Ex: ${e.ex}<br>
          Pay: ${e.pay}
        </div>
        <div>Â£${e.amount}</div>
      </div>
    `;
  });

  document.getElementById("next5").innerHTML = html;
}

/* ==========================================================
   YEAR TO DATE DIVIDENDS
========================================================== */
function renderYTD(sync) {
  const months = sync.dividend_planner?.monthly_breakdown;
  if (!months) return;

  let total = 0;
  for (const m in months) {
    const val = parseFloat(months[m].actual || 0);
    total += val;
  }

  document.getElementById("ytd").innerHTML = `
    <h3>Â£${total.toFixed(2)}</h3>
  `;
}

/* ==========================================================
   DIVIDEND FORECAST CHART
========================================================== */
function renderDivChart(sync) {
  const months = sync.dividend_planner?.monthly_breakdown;
  if (!months) return;

  const labels = Object.keys(months);
  const values = labels.map(k => months[k].forecast);

  const ctx = document.getElementById('divChart').getContext('2d');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels,
      datasets: [{
        label: "Forecast (Â£)",
        data: values,
        borderWidth: 1,
      }]
    },
    options: {
      plugins: { legend: { display: false } },
      scales: { y: { beginAtZero: true } }
    }
  });
}
</script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</div>
</body>
</html>
  
