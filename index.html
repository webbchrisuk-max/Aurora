<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aurora Master Dashboard ‚Äì Ultra Edition</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet" />

<!-- ===================== SECTION: CORE THEME ===================== -->
<style>
:root{
  --cyan:#00ffff;
  --coral:#ff7f50;
  --green:#00ff99;
  --teal:#00ffd0;
  --amber:#ffb347;
  --bg1:#060018;
  --bg2:#120035;
  --bg3:#001a33;
}
body{
  margin:0;padding:0;
  font-family:'Orbitron',sans-serif;
  color:#fff;
  background:linear-gradient(120deg,var(--bg1),var(--bg2),var(--bg3));
  background-size:600% 600%;
  animation:auroraDrift 45s ease-in-out infinite;
  overflow-x:hidden;
}
@keyframes auroraDrift{
  0%{background-position:0% 50%;}
  25%{background-position:50% 100%;}
  50%{background-position:100% 50%;}
  75%{background-position:50% 0%;}
  100%{background-position:0% 50%;}
}
h1{text-align:center;font-size:1.8rem;margin:20px 0;color:#fff;
  text-shadow:0 0 14px rgba(0,255,255,0.7),0 0 28px rgba(0,255,255,0.35);}
h2,h3{color:#fff;text-shadow:0 0 10px rgba(0,255,255,0.55);margin-top:.5em;}
.dashboard{
  display:grid;grid-template-columns:repeat(2,1fr);gap:20px;
  margin:0 auto;max-width:1200px;padding:0 20px 30px;align-items:start;
}
@media(max-width:820px){.dashboard{grid-template-columns:1fr;padding:0 16px 24px;}}
.card{
  background:rgba(10,10,30,0.65);
  border:1px solid rgba(0,255,255,0.25);
  border-radius:10px;padding:20px;
  box-shadow:0 0 20px rgba(0,255,255,0.15);
  backdrop-filter:blur(6px);
  animation:fadeIn .8s ease-in-out;
}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
#auroraSyncStatus{position:fixed;top:10px;right:20px;font-size:.85rem;color:#fff;}
#auroraSyncDot{display:inline-block;width:10px;height:10px;border-radius:50%;
  background:var(--cyan);box-shadow:0 0 10px var(--cyan);
  margin-right:6px;vertical-align:middle;animation:pulseGlow 3s ease-in-out infinite;}
@keyframes pulseGlow{0%,100%{box-shadow:0 0 10px var(--cyan);}50%{box-shadow:0 0 25px var(--cyan);}}
#syncTime{display:block;font-size:.75rem;color:#aaa;margin-top:2px;}
.collapsible{
  background:rgba(255,255,255,0.05);
  border:1px solid rgba(0,255,255,0.2);
  color:#fff;
  cursor:pointer;
  padding:12px 18px;
  width:100%;
  border-radius:8px;
  text-align:left;
  font-size:1rem;
  text-shadow:0 0 6px rgba(0,255,255,0.4);
  transition:background .3s;
}
.collapsible:hover{background:rgba(0,255,255,0.08);}
.content{padding:0 18px;max-height:0;overflow:hidden;transition:max-height 0.4s ease-out;}
.collapsible.active + .content{max-height:1200px;}
#ig-zone .collapsible{border-color:var(--teal);text-shadow:0 0 8px var(--teal);}
#t212-zone .collapsible{border-color:var(--amber);text-shadow:0 0 8px var(--amber);}
.targetBar{
  width:100%;background:rgba(255,255,255,0.1);
  border-radius:10px;height:16px;overflow:hidden;margin-top:8px;
}
.targetFill{
  height:100%;width:0%;
  background:linear-gradient(90deg,var(--cyan),#9dfcff);
  box-shadow:0 0 10px var(--cyan);
  transition:width 1s ease;
}
</style>
</head>

<body>
<h1>Aurora Master Dashboard ‚Äì Ultra Edition</h1>
<div id="auroraSyncStatus">
  <span id="auroraSyncDot"></span>Synced
  <span id="syncTime">Last updated --:-- ¬∑ Next sync in 5 min</span>
</div>

<!-- ===================== MAIN DASHBOARD ===================== -->
<div class="dashboard">
  <div class="card" id="portfolio-summary">
    <h2>Portfolio Summary</h2>
    <p>Total Target: ¬£<span id="targetValue">0.00</span></p>
    <div class="targetBar"><div id="targetFill" class="targetFill"></div></div>
    <p>Dividend Yield: <span id="divYield">0.00</span>%</p>
    <p>Total Gain: <span id="totalGain">0.00</span> (<span id="gainPercent">0.00</span>%)</p>
  </div>

  <div class="card" id="isa-balances">
    <h2>ISA Balances</h2>
    <p>IG ISA: ¬£<span id="igBalance">0.00</span></p>
    <p>Trade212 ISA: ¬£<span id="t212Balance">0.00</span></p>
  </div>

  <div class="card" id="dividends-centre">
    <h2>üìÖ Upcoming Dividends</h2>
    <h3>Next 5 Dividends üí∞</h3>
    <ul id="nextDivs"></ul>
    <h3>Next 5 Ex-Dividends üóìÔ∏è</h3>
    <ul id="nextExDivs"></ul>
  </div>

  <div class="card" id="dividend-overview">
    <h2>Dividend Overview</h2>
    <p>Forecast Annual Income: ¬£<span id="forecastTotal">0.00</span></p>
    <p>YTD Received: ¬£<span id="receivedYTD">0.00</span></p>
    <div class="targetBar"><div id="forecastProgress" class="targetFill"></div></div>
    <p style="font-size:.8rem;margin-top:6px;">Progress to ¬£6 000 Goal: <span id="forecastPercent">0%</span></p>
    <h3>Quarterly Totals</h3>
    <div id="quarterlyBars"
         style="display:flex;justify-content:space-around;align-items:flex-end;height:220px;margin-top:12px;gap:10px;"></div>

    <!-- ===================== YEARLY DIVIDENDS CHART ===================== -->
    <h3 style="margin-top:20px;">Yearly Dividends (Jan ‚Äì Dec)</h3>
    <div id="yearlyBars"
         style="display:flex;justify-content:space-around;align-items:flex-end;
                height:240px;margin-top:12px;gap:10px;"></div>
  </div>

  <div id="ig-zone">
    <button class="collapsible">‚ñ∂ IG ISA Details</button>
    <div class="content" id="igContent"></div>
  </div>

  <div id="t212-zone">
    <button class="collapsible">‚ñ∂ Trade212 ISA Details</button>
    <div class="content" id="t212Content"></div>
  </div>
</div>

<!-- ===================== SCRIPT ENGINE ===================== -->
<script>
const JSON_URL="https://raw.githubusercontent.com/webbchrisuk-max/Aurora/refs/heads/main/AuroraSync.json?ts=";
let lastGain=0;
const asNum=v=>isNaN(+v)?0:+v;
async function loadAuroraSync(attempt=1){
  const dot=document.getElementById("auroraSyncDot");
  const time=document.getElementById("syncTime");
  try{
    const res=await fetch(JSON_URL+Date.now(),{cache:"no-store"});
    if(!res.ok)throw new Error("HTTP "+res.status);
    const d=await res.json();
    renderAll(d);
    const now=new Date();
    time.textContent=`Last updated ${now.getHours().toString().padStart(2,"0")}:${now.getMinutes().toString().padStart(2,"0")} ¬∑ Next sync in 5 min`;
    dot.style.background="#00ffcc";
  }catch(e){
    console.error(e);
    dot.style.background="#ff3333";time.textContent="Sync error";
    if(attempt<3)setTimeout(()=>loadAuroraSync(attempt+1),2000);
  }
}
function renderAll(d){
  const g=asNum(d.isa?.ig_isa?.unrealised_gain)+asNum(d.isa?.trade212_isa?.unrealised_gain);
  const pct=((g/(asNum(d.isa?.ig_isa?.book_cost)+asNum(d.isa?.trade212_isa?.book_cost)))*100)||0;
  const target=asNum(d.isa.portfolio_summary.annual_target_value)||0;
  const totalBal=asNum(d.isa.ig_isa.balance)+asNum(d.isa.trade212_isa.balance);
  const progress=Math.min((totalBal/target)*100,100);
  document.getElementById("targetValue").textContent=target.toFixed(2);
  document.getElementById("divYield").textContent=asNum(d.isa.portfolio_summary.dividend_yield).toFixed(2);
  document.getElementById("totalGain").textContent=g.toFixed(2);
  document.getElementById("gainPercent").textContent=pct.toFixed(2);
  document.getElementById("targetFill").style.width=progress+"%";
  document.getElementById("igBalance").textContent=asNum(d.isa.ig_isa.balance).toFixed(2);
  document.getElementById("t212Balance").textContent=asNum(d.isa.trade212_isa.balance).toFixed(2);
  renderDividends(d);
  renderForecast(d);
  renderQuarterly(d);
  renderYearlyDividends(d);
  renderHoldings(d);
}
function renderDividends(d){
  const now=new Date(),n=document.getElementById("nextDivs"),x=document.getElementById("nextExDivs");
  n.innerHTML="";x.innerHTML="";
  const pays=(d.dividends_feed||[]).filter(v=>new Date(v.pay_date)>now).sort((a,b)=>new Date(a.pay_date)-new Date(b.pay_date)).slice(0,5);
  const exes=(d.dividends_feed||[]).filter(v=>new Date(v.ex_div_date)>now).sort((a,b)=>new Date(a.ex_div_date)-new Date(b.ex_div_date)).slice(0,5);
  pays.forEach(v=>n.insertAdjacentHTML("beforeend",`<li>üí∞ ${v.name} ‚Äì <span style='color:#00ffcc'>¬£${asNum(v.total_dividend).toFixed(2)}</span> on <span style='color:#ff66cc'>${v.pay_date}</span></li>`));
  exes.forEach(v=>x.insertAdjacentHTML("beforeend",`<li>üóìÔ∏è ${v.name} ‚Äì Ex-Div <span style='color:#ff66cc'>${v.ex_div_date}</span></li>`));
}
function renderForecast(d){
  const f=d.dividend_planner||{};
  document.getElementById("forecastTotal").textContent=asNum(f.forecast_total).toFixed(2);
  document.getElementById("receivedYTD").textContent=asNum(f.received_ytd).toFixed(2);
  const pct=(asNum(f.forecast_total)/6000*100).toFixed(1);
  document.getElementById("forecastPercent").textContent=pct+"%";
  document.getElementById("forecastProgress").style.width=Math.min(pct,100)+"%";
}
function renderQuarterly(d){
  const el=document.getElementById("quarterlyBars");el.innerHTML="";
  const qd=d.dividend_planner?.quarterly_breakdown||{};
  const max=Math.max(1,...Object.values(qd));
  Object.entries(qd).forEach(([q,v])=>{
    const bar=document.createElement("div");
    bar.style.width="60px";bar.style.height=(v/max*190)+"px";
    bar.style.borderRadius="6px 6px 0 0";
    bar.style.background="linear-gradient(180deg,#9dfcff,var(--cyan))";
    bar.style.boxShadow="0 0 15px var(--cyan)";
    const lbl=document.createElement("div");
    lbl.innerHTML=`${q}<br>¬£${v.toFixed(2)}`;
    lbl.style.fontSize=".8rem";lbl.style.textAlign="center";lbl.style.marginTop="6px";
    const wrap=document.createElement("div");
    wrap.style.display="flex";wrap.style.flexDirection="column";wrap.style.alignItems="center";
    wrap.appendChild(bar);wrap.appendChild(lbl);el.appendChild(wrap);
  });
}
function renderYearlyDividends(d){
  const el=document.getElementById("yearlyBars");
  if(!el)return;
  el.innerHTML="";
  const months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
  const mb=d.dividend_planner?.monthly_breakdown||{};
  const vals=months.map(m=>+mb[m]||0);
  const max=Math.max(1,...vals);
  months.forEach((m,i)=>{
    const v=vals[i];
    const bar=document.createElement("div");
    bar.style.width="40px";
    bar.style.height=(v/max*190)+"px";
    bar.style.borderRadius="6px 6px 0 0";
    bar.style.background="linear-gradient(180deg,var(--cyan),var(--coral))";
    bar.style.boxShadow="0 0 15px rgba(0,255,255,0.5)";
    const lbl=document.createElement("div");
    lbl.innerHTML=`${m}<br>¬£${v.toFixed(0)}`;
    lbl.style.fontSize=".75rem";lbl.style.textAlign="center";lbl.style.marginTop="6px";
    const wrap=document.createElement("div");
    wrap.style.display="flex";wrap.style.flexDirection="column";wrap.style.alignItems="center";
    wrap.appendChild(bar);
    wrap.appendChild(lbl);
    el.appendChild(wrap);
  });
}
function renderHoldings(d){
  renderSection("igContent",d.isa_feed.filter(x=>x.account==="IG ISA"),"var(--teal)");
  renderSection("t212Content",d.isa_feed.filter(x=>x.account==="TRADE212"),"var(--amber)");
}
function renderSection(id,list,color){
  const el=document.getElementById(id);el.innerHTML="";
  if(!list.length){el.innerHTML="<p>No holdings available.</p>";return;}
  let h=`<table style="width:100%;border-collapse:collapse;font-size:.9rem;">
  <thead><tr style="color:${color};text-shadow:0 0 8px ${color};"><th>Name</th><th>Value (¬£)</th><th>Gain (¬£)</th><th>Gain (%)</th><th>Yield (%)</th><th>Income (¬£)</th></tr></thead><tbody>`;
  list.forEach(v=>{
    const gcls=asNum(v.gain_value)>=0?"style='color:#00ffcc'":"style='color:#ff5555'";
    h+=`<tr><td>${v.name}</td><td>${asNum(v.value).toFixed(2)}</td><td ${gcls}>${asNum(v.gain_value).toFixed(2)}</td><td ${gcls}>${asNum(v.gain_percentage).toFixed(2)}%</td><td>${asNum(v.annual_div_yield).toFixed(2)}%</td><td>${asNum(v.annual_income).toFixed(2)}</td></tr>`;
  });h+="</tbody></table>";el.innerHTML=h;
}
document.querySelectorAll(".collapsible").forEach(b=>b.addEventListener("click",function(){this.classList.toggle("active");const c=this.nextElementSibling;c.style.maxHeight?c.style.maxHeight=null:c.style.maxHeight=c.scrollHeight+"px";}));
document.addEventListener("DOMContentLoaded",()=>{loadAuroraSync();setInterval(loadAuroraSync,300000);});
</script>
<!-- ===================== SECTION: NAV DISCOUNT LEADERBOARD ===================== -->
<section style="max-width:1200px;margin:40px auto 60px;padding:0 20px;">
  <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;">
    <div style="flex:1;height:3px;background:linear-gradient(90deg,rgba(0,255,255,0),var(--cyan),var(--coral),rgba(0,255,255,0));animation:pulseLine 6s ease-in-out infinite;"></div>
    <div style="white-space:nowrap;font-weight:700;letter-spacing:.3px;color:#bfffff;text-shadow:0 0 10px rgba(0,255,255,.9);">NAV Discount Leaderboard</div>
    <div style="flex:1;height:3px;background:linear-gradient(90deg,rgba(0,255,255,0),var(--coral),var(--cyan),rgba(0,255,255,0));animation:pulseLine 6s ease-in-out infinite;"></div>
  </div>

  <div class="aurora-nav-leaderboard" id="navDiscountCard">
    <div class="navlb-header">
      <div class="navlb-title">NAV Discount Leaderboard</div>
      <div class="navlb-meta" id="navlbMeta">Loading‚Ä¶</div>
    </div>

    <div class="navlb-movers" id="navlbMovers" hidden>
      <div class="navlb-movers-col">
        <h4>Top 3 Weekly Wideners</h4><ul id="navlbWideners"></ul>
      </div>
      <div class="navlb-movers-col">
        <h4>Top 3 Weekly Narrowers</h4><ul id="navlbNarrowers"></ul>
      </div>
    </div>

    <div class="navlb-category cat-green" id="navlbGreen" hidden>
      <div class="navlb-cat-title">üü© Deep discount (‚â§ ‚àí10 %)</div>
      <div id="navlbGreenList"></div>
    </div>
    <div class="navlb-category cat-yellow" id="navlbYellow" hidden>
      <div class="navlb-cat-title">üü® Moderate discount (‚àí5 to ‚àí9 %)</div>
      <div id="navlbYellowList"></div>
    </div>
    <div class="navlb-category cat-white" id="navlbWhite" hidden>
      <div class="navlb-cat-title">‚¨úÔ∏è Tight discount (0 to ‚àí4 %)</div>
      <div id="navlbWhiteList"></div>
    </div>

    <div class="navlb-footnote" id="navlbFoot">
      Figures auto-sourced from AuroraSync.json ‚Ä¢ Times shown Europe/London
    </div>
  </div>
</section>

<!-- ===================== STYLES: LEADERBOARD GLOW ===================== -->
<style>
@keyframes pulseLine{0%,100%{opacity:.8}50%{opacity:.3}}
.aurora-nav-leaderboard{
  padding:14px 16px;border-radius:12px;
  background:rgba(10,10,30,0.65);
  border:1px solid rgba(0,255,255,0.25);
  box-shadow:0 0 25px rgba(0,255,255,0.25);
  backdrop-filter:blur(6px);
}
.aurora-nav-leaderboard .navlb-header{display:flex;justify-content:space-between;align-items:baseline;gap:12px;margin-bottom:10px;}
.aurora-nav-leaderboard .navlb-title{font-weight:700;color:var(--cyan);text-shadow:0 0 10px rgba(0,255,255,.6);}
.aurora-nav-leaderboard .navlb-meta{opacity:.85;font-size:.9rem;}
.aurora-nav-leaderboard .navlb-movers{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:10px 0 12px;}
.aurora-nav-leaderboard .navlb-movers h4{margin:0 0 6px;font-size:.95rem;color:#ffd580;text-shadow:0 0 8px rgba(255,213,128,.5);}
.aurora-nav-leaderboard .navlb-movers ul{margin:0;padding-left:18px;line-height:1.35;}
.aurora-nav-leaderboard .navlb-category{margin:12px 0;padding:10px 10px 8px;border-left:4px solid transparent;border-radius:10px;}
.aurora-nav-leaderboard .navlb-cat-title{font-weight:600;margin-bottom:8px;}
.aurora-nav-leaderboard .cat-green{border-left-color:rgba(0,255,170,.6);}
.aurora-nav-leaderboard .cat-yellow{border-left-color:rgba(255,220,0,.7);}
.aurora-nav-leaderboard .cat-white{border-left-color:rgba(255,255,255,.55);}
.aurora-nav-leaderboard .navlb-row{display:grid;grid-template-columns:70px 1fr 80px 80px 80px 80px;gap:8px;align-items:center;padding:8px;border:1px solid rgba(255,255,255,.08);border-radius:10px;background:rgba(255,255,255,.02);}
.aurora-nav-leaderboard .navlb-row .ticker{font-weight:700;color:var(--cyan);text-shadow:0 0 6px rgba(0,255,200,.7);}
.aurora-nav-leaderboard .navlb-row .mono{font-variant-numeric:tabular-nums;}
.aurora-nav-leaderboard .badge{padding:2px 8px;border-radius:999px;font-size:.8rem;border:1px solid rgba(255,255,255,.12);}
.aurora-nav-leaderboard .navlb-footnote{margin-top:12px;opacity:.75;font-size:.84rem;text-align:center;}
@media(max-width:560px){
  .aurora-nav-leaderboard .navlb-row{grid-template-columns:70px 1fr;row-gap:6px;}
  .aurora-nav-leaderboard .navlb-row>*:not(:first-child){grid-column:1/-1;}
}
</style>

<!-- ===================== SCRIPT: LEADERBOARD DATA FETCH ===================== -->
<script>
(async function(){
  const url="https://raw.githubusercontent.com/webbchrisuk-max/Aurora/refs/heads/main/AuroraSync.json?nocache="+Date.now();
  const meta=document.getElementById("navlbMeta");
  const wid=document.getElementById("navlbWideners");
  const nar=document.getElementById("navlbNarrowers");
  const green=document.getElementById("navlbGreen");
  const yellow=document.getElementById("navlbYellow");
  const white=document.getElementById("navlbWhite");
  const gl=document.getElementById("navlbGreenList");
  const yl=document.getElementById("navlbYellowList");
  const wl=document.getElementById("navlbWhiteList");
  const foot=document.getElementById("navlbFoot");
  const movers=document.getElementById("navlbMovers");
  try{
    const r=await fetch(url,{cache:"no-store"});
    const d=await r.json();
    const w=d.nav_discount_leaderboard?.weekly||{};
    const keys=Object.keys(w);
    if(!keys.length){meta.textContent="No leaderboard data yet.";return;}
    const latest=keys.sort().slice(-1)[0];
    const pack=w[latest];
    meta.textContent=`Week ${latest} ‚Ä¢ Generated ${pack.generated_at||"n/a"}`;
    const list=(pack.entries||[]).sort((a,b)=>a.discount_percent-b.discount_percent);
    const rows=e=>`<div class='navlb-row'>
      <div class='ticker'>${e.ticker}</div>
      <div>${e.name}</div>
      <div class='mono'>¬£${e.share_price}</div>
      <div class='mono'>¬£${e.nav_or_fair_value}</div>
      <div class='mono badge'>${e.discount_percent.toFixed(1)}%</div>
      <div class='mono badge'>${e.wow_change_percent?.toFixed?.(1)||"n/a"}%</div>
    </div>`;
    list.forEach(v=>{
      if(v.discount_percent<=-10)gl.insertAdjacentHTML("beforeend",rows(v));
      else if(v.discount_percent<=-5)yl.insertAdjacentHTML("beforeend",rows(v));
      else if(v.discount_percent<=0)wl.insertAdjacentHTML("beforeend",rows(v));
    });
    if(gl.children.length)green.hidden=false;
    if(yl.children.length)yellow.hidden=false;
    if(wl.children.length)white.hidden=false;
    const top=pack.top_movers||{};
    const widL=(top.wideners||[]).slice(0,3);
    const narL=(top.narrowers||[]).slice(0,3);
    if(widL.length||narL.length){
      movers.hidden=false;
      wid.innerHTML=widL.map(x=>`<li><b>${x.ticker}</b> ${x.wow_change_percent.toFixed(1)}%</li>`).join("");
      nar.innerHTML=narL.map(x=>`<li><b>${x.ticker}</b> ${x.wow_change_percent.toFixed(1)}%</li>`).join("");
    }
    if(d.integrity?.last_validated)
      foot.textContent=`Figures auto-sourced from AuroraSync.json ‚Ä¢ Last validated ${d.integrity.last_validated}`;
  }catch(err){meta.textContent="Error loading leaderboard.";console.error(err);}
})();
</script>

</body>
</html>
