<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aurora ISA Tracker – Ultra Edition</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet" />

<style>
:root {
  --cyan:#00ffff;
  --coral:#ff7f50;
  --teal:#00ffd0;
  --amber:#ffb347;
  --green:#00ff7f;
  --bg1:#060018;
  --bg2:#120035;
  --bg3:#001a33;
}

/* ===================== PAGE ===================== */
body {
  margin:0;
  padding:0;
  font-family:'Orbitron',sans-serif;
  color:#fff;
  background:linear-gradient(120deg,var(--bg1),var(--bg2),var(--bg3));
  background-size:600% 600%;
  animation:auroraMove 45s ease-in-out infinite;
  overflow-x:hidden;
}

@keyframes auroraMove {
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}

/* ===================== CARDS ===================== */
.card {
  background:rgba(0,0,0,0.35);
  border:1px solid rgba(255,255,255,0.05);
  border-radius:18px;
  padding:18px;
  margin:16px;
  transition:0.35s;
  backdrop-filter:blur(6px);
}

.card:hover,
.card:active {
  box-shadow:0 0 20px var(--cyan), 0 0 30px var(--cyan);
  transform:translateY(-3px);
}

/* iPad layout fix */
@media (min-width: 768px) {
  .card {
    max-width:650px;
    margin-left:auto;
    margin-right:auto;
  }
}

.section-title {
  font-size:1.4rem;
  margin:25px 16px 5px 16px;
  text-shadow:0 0 10px var(--cyan);
}

.positive {
  color:var(--green);
  text-shadow:0 0 10px var(--green);
}

/* ===================== COUNTDOWN ===================== */
#isa-countdown {
  font-size:1.3rem;
  color:var(--teal);
  text-align:center;
  margin-top:10px;
}

/* ===================== iPad EXTRA ===================== */
@media (min-width: 820px) {
  .ipad-extra {
    display:block;
    margin-top:10px;
    font-size:0.9rem;
    opacity:0.85;
  }
}

@media (max-width: 819px) {
  .ipad-extra { display:none; }
}

/* ===================== EXPAND PANEL ===================== */
.expand-btn {
  margin-top:12px;
  padding:10px;
  text-align:center;
  border-radius:12px;
  cursor:pointer;
  background:rgba(0,255,255,0.12);
  border:1px solid rgba(0,255,255,0.3);
  font-size:1rem;
  transition:0.25s;
  text-shadow:0 0 8px var(--cyan);
}

.expand-btn:hover {
  background:rgba(0,255,255,0.3);
  box-shadow:0 0 14px var(--cyan);
}

.expand-panel {
  margin-top:10px;
  padding:10px;
  background:rgba(255,255,255,0.04);
  border-left:2px solid var(--cyan);
  border-radius:10px;
  display:none;
  font-size:0.9rem;
}
</style>
</head>

<body>

<h2 class="section-title">Portfolio Summary</h2>
<div class="card">
  <p>Total Value: <span id="totalValue">£0</span></p>
  <p>Total Gain: <span id="totalGain" class="positive">+£0</span></p>
</div>

<h2 class="section-title">ISA Maturity Countdown</h2>
<div class="card">
  <p id="isa-countdown">Loading…</p>
</div>

<h2 class="section-title">Next 5 Dividends</h2>
<div id="nextDivsContainer"></div>

<h2 class="section-title">Next Ex-Dividend Dates</h2>
<div id="nextExDivsContainer"></div>

<h2 class="section-title">Tesco SIP & SAYE</h2>
<div class="card">
  <p>SIP Value: <span class="positive">+£0</span></p>
  <p>SAYE: <span class="positive">+£0</span></p>
</div>

<h2 class="section-title">Holdings</h2>
<div id="holdingsContainer"></div>

<script>
// ========================================================
// FETCH LIVE JSON
// ========================================================
async function loadData() {
  const url = "https://raw.githubusercontent.com/webbchrisuk-max/Aurora/refs/heads/main/AuroraSync.json";
  const res = await fetch(url + "?nocache=" + Date.now());
  const data = await res.json();
  return data;
}

// ========================================================
// UPCOMING DIVIDENDS
// ========================================================
function buildUpcoming(divs) {
  const container = document.getElementById("nextDivsContainer");
  container.innerHTML = "";

  const sorted = divs
    .filter(x => x.upcoming_date)
    .sort((a,b)=> new Date(a.upcoming_date) - new Date(b.upcoming_date))
    .slice(0,5);

  sorted.forEach(d => {
    container.innerHTML += `
      <div class="card">
        <p><strong>${d.ticker}</strong></p>
        <p>Upcoming Dividend: £${d.amount}</p>
        <p>Date: ${d.upcoming_date}</p>
      </div>
    `;
  });
}

// ========================================================
// EX-DIV
// ========================================================
function buildExDiv(divs) {
  const container = document.getElementById("nextExDivsContainer");
  container.innerHTML = "";

  const sorted = divs
    .filter(x => x.ex_div)
    .sort((a,b)=> new Date(a.ex_div) - new Date(b.ex_div))
    .slice(0,5);

  sorted.forEach(d => {
    container.innerHTML += `
      <div class="card">
        <p><strong>${d.ticker}</strong></p>
        <p>Ex-Dividend: ${d.ex_div}</p>
      </div>
    `;
  });
}
  // ========================================================
// HOLDINGS + EXPAND PANELS
// ========================================================
function buildHoldings(holdings) {
  const container = document.getElementById("holdingsContainer");
  container.innerHTML = "";

  holdings.forEach((h, i) => {
    const panelId = "panel_" + i;

    container.innerHTML += `
      <div class="card">
        <p><strong>${h.ticker}</strong></p>

        <div style="display:flex; justify-content:space-between;">
          <div>
            <p>Shares: ${h.shares}</p>
            <p>Value: £${h.value.toFixed(2)}</p>
            <p class="positive">Gain: £${h.gain_value?.toFixed(2)}</p>
          </div>

          <div style="text-align:right;">
            <p>Live Price: £${h.live_price}</p>
            <p>Annual Income: £${h.annual_income}</p>
            <p>Yield: ${h.annual_div_yield}%</p>
            <p>Gain %: ${h.gain_percentage?.toFixed(2)}%</p>
          </div>
        </div>

        <!-- Expand Button -->
        <div class="expand-btn" onclick="togglePanel('${panelId}')">Tap to Expand</div>

        <!-- Expand Panel -->
        <div id="${panelId}" class="expand-panel">
          <p><strong>${h.name}</strong></p>
          <p>Sector: ${h.sector}</p>
          <p>Fair Value: ${h.fair_value}</p>
          <p>Discount: ${h.discount_pct}</p>
          <p>Status: ${h.rating}</p>
          <p>Last Updated: ${h.last_updated}</p>
        </div>
      </div>
    `;
  });
}

// ========================================================
// Expand/Collapse Panels
// ========================================================
function togglePanel(id) {
  const el = document.getElementById(id);
  el.style.display = (el.style.display === "block") ? "none" : "block";
}

// ========================================================
// ISA COUNTDOWN
// ========================================================
function startCountdown(targetDate) {
  const el = document.getElementById("isa-countdown");

  function update() {
    const now = new Date();
    const diff = new Date(targetDate) - now;

    if (diff <= 0) {
      el.innerHTML = "ISA Fully Matured!";
      return;
    }

    const days = Math.floor(diff / (1000*60*60*24));
    const hours = Math.floor((diff / (1000*60*60)) % 24);

    el.innerHTML = `${days} days ${hours} hours remaining`;
  }

  update();
  setInterval(update, 60000);
}

// ========================================================
// MAIN INITIALISATION
// ========================================================
loadData().then(data => {

  // ====== Portfolio Summary ======
  document.getElementById("totalValue").innerText = "£" + data.isa.ig_isa?.balance;
  document.getElementById("totalGain").innerText = "£" + data.isa.ig_isa?.unrealised_gain;

  // ====== Dividends ======
  buildUpcoming(data.dividends.next_five ?? []);
  buildExDiv(data.dividends.upcoming ?? []);

  // ====== Holdings ======
  // combine IG ISA + T212 ISA into one panel
  const ig = data.isa.holdings.ig_isa || [];
  const t212 = data.isa.holdings.trade212_isa || [];
  const combined = ig.concat(t212);

  buildHoldings(combined);

  // ====== ISA Countdown ======
  startCountdown("2026-04-06T00:00:00");
});
</script>

</body>
</html>
