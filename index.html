<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aurora Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

<style>
:root{
  --cyan:#00ffff;
  --magenta:#ff00ff;
  --green:#00ff99;
  --bg1:#020010;
  --bg2:#180040;
  --bg3:#002255;
  --bg4:#330033;
  --bg5:#004466;
}

body{
  margin:0;
  padding:0;
  font-family:'Orbitron',sans-serif;
  color:#fff;
  background:radial-gradient(circle at top right,#030010 0%,#0a0120 70%);
  background-size:800% 800%;
  animation:auroraDrift 35s linear infinite;
  overflow-x:hidden;
}
@keyframes auroraDrift{
  0%{background-position:0% 50%;}
  25%{background-position:50% 100%;}
  50%{background-position:100% 50%;}
  75%{background-position:50% 0%;}
  100%{background-position:0% 50%;}
}

h1{
  text-align:center;
  font-size:1.8rem;
  margin:20px 0;
  color:#fff;
  text-shadow:0 0 25px var(--cyan);
}
h2,h3{
  color:#fff;
  text-shadow:0 0 15px var(--magenta);
  margin-top:0.5em;
}

.dashboard{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(480px,1fr));
  gap:20px;
  margin:0 5%;
}

.card{
  background:rgba(10,10,30,0.65);
  border:1px solid rgba(0,255,255,0.25);
  border-radius:10px;
  padding:20px;
  box-shadow:0 0 20px rgba(0,255,255,0.15);
  backdrop-filter:blur(6px);
  animation:fadeIn 1s ease-in-out;
}
@keyframes fadeIn{
  from{opacity:0;transform:translateY(10px);}
  to{opacity:1;transform:translateY(0);}
}

.table-holder{overflow-x:auto;max-height:350px;}
table{width:100%;border-collapse:collapse;font-size:0.9rem;}
th,td{padding:6px 8px;text-align:left;}
th{color:var(--cyan);}
tr:nth-child(even){background:rgba(255,255,255,0.05);}
tr:hover{background:rgba(0,255,255,0.1);}
.value{color:var(--cyan);}
.gain-pos{color:var(--green);}
.gain-neg{color:#ff5555;}

/* === Sync indicator === */
#auroraSyncStatus{
  position:fixed;top:10px;right:20px;
  font-size:0.85rem;color:#fff;
}
#auroraSyncDot{
  display:inline-block;width:10px;height:10px;border-radius:50%;
  background:var(--cyan);
  box-shadow:0 0 10px var(--cyan);
  margin-right:6px;vertical-align:middle;
  animation:pulseGlow 3s ease-in-out infinite;
}
@keyframes pulseGlow{
  0%,100%{box-shadow:0 0 10px var(--cyan);}
  50%{box-shadow:0 0 25px var(--magenta);}
}
#syncTime{display:block;font-size:0.75rem;color:#aaa;margin-top:2px;}
.amount-green{color:var(--green);}
.date-pink{color:var(--magenta);}

/* === Digital Wave Line (Dual Layer) === */
.wave-container {
  width:100%;
  height:80px;
  margin:-5px 0 10px 0;
  position:relative;
}
.wave-container svg {
  width:100%;
  height:100%;
  position:absolute;
  top:0;left:0;
}
.wave {
  fill:none;
  stroke-width:2;
  stroke-dasharray:10 8;
  animation:waveFlow 6s linear infinite;
}
.wave.cyan {
  stroke:rgba(0,255,255,0.9);
  filter:drop-shadow(0 0 8px rgba(0,255,255,0.8));
  animation-duration:5s;
}
.wave.magenta {
  stroke:rgba(255,0,255,0.6);
  filter:drop-shadow(0 0 6px rgba(255,0,255,0.7));
  animation-direction:reverse;
  animation-duration:8s;
}
@keyframes waveFlow{
  to{stroke-dashoffset:-36;}
}
.wave-container{
  animation:waveGlow 7s ease-in-out infinite;
}
@keyframes waveGlow{
  0%,100%{opacity:0.7;}
  50%{opacity:1;}
}

@media(max-width:720px){
  .dashboard{grid-template-columns:1fr;margin:0 3%;}
}
</style>
</head>

<body>
<h1>Aurora Tracker</h1>

<div id="auroraSyncStatus">
  <span id="auroraSyncDot"></span>Synced
  <span id="syncTime">Last updated --:--</span>
</div>

<div class="dashboard">

  <div class="card" id="portfolio-summary">
    <h2>Portfolio Summary</h2>
    <p>Total Target: £<span id="targetValue">0.00</span></p>
    <p>Dividend Yield: <span id="divYield">0.00</span>%</p>
    <p>Total Gain: £<span id="totalGain">0.00</span> (<span id="gainPercent">0.00</span>%)</p>
  </div>

  <!-- ===== Aurora Digital Wave Line (Dual Layer) ===== -->
  <div class="wave-container">
    <svg viewBox="0 0 600 100" preserveAspectRatio="none">
      <path d="M0,50 Q150,0 300,50 T600,50" class="wave cyan"></path>
      <path d="M0,55 Q150,100 300,55 T600,55" class="wave magenta"></path>
    </svg>
  </div>

  <div class="card" id="isa-balances">
    <h2>ISA Balances</h2>
    <p>IG ISA: £<span id="igBalance">0.00</span></p>
    <p>Trade212 ISA: £<span id="t212Balance">0.00</span></p>
  </div>

  <div class="card" id="ig-holdings">
    <h2>IG ISA Holdings</h2>
    <div class="table-holder">
      <table id="igTable">
        <thead>
          <tr><th>Name</th><th>Value (£)</th><th>Gain (£)</th><th>Gain (%)</th><th>Yield (%)</th><th>Income (£)</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="card" id="t212-holdings">
    <h2>Trade212 Holdings</h2>
    <div class="table-holder">
      <table id="t212Table">
        <thead>
          <tr><th>Name</th><th>Value (£)</th><th>Gain (£)</th><th>Gain (%)</th><th>Yield (%)</th><th>Income (£)</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

</div>

<script>
async function loadAuroraSync(){
  const dot=document.getElementById("auroraSyncDot");
  const syncTime=document.getElementById("syncTime");
  try{
    const url="https://raw.githubusercontent.com/webbchrisuk-max/Aurora/main/AuroraSync.json?nocache="+Date.now();
    const res=await fetch(url);
    const data=await res.json();

    dot.style.background="var(--green)";
    dot.style.boxShadow="0 0 15px var(--green)";
    syncTime.textContent="Last updated "+new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})+" · Live";

    populate(data);
  }catch(e){
    dot.style.background="#666";
    dot.style.boxShadow="0 0 8px #666";
    syncTime.textContent="Sync failed · retrying soon";
  }
}

function populate(data){
  document.getElementById("targetValue").textContent=data.isa.portfolio_summary.annual_target_value.toFixed(2);
  document.getElementById("divYield").textContent=data.isa.portfolio_summary.dividend_yield.toFixed(2);
  document.getElementById("igBalance").textContent=data.isa.ig_isa.balance.toFixed(2);
  document.getElementById("t212Balance").textContent=data.isa.trade212_isa.balance.toFixed(2);

  const gain=data.isa.ig_isa.unrealised_gain+data.isa.trade212_isa.unrealised_gain;
  const gainPct=((gain/(data.isa.ig_isa.book_cost+data.isa.trade212_isa.book_cost))*100);
  document.getElementById("totalGain").textContent=gain.toFixed(2);
  document.getElementById("gainPercent").textContent=gainPct.toFixed(2);

  populateTables(data);
}

function populateTables(data){
  const igBody=document.querySelector("#igTable tbody");
  igBody.innerHTML="";
  data.isa_feed.filter(x=>x.account==="IG ISA").forEach(h=>{
    igBody.innerHTML+=`<tr><td>${h.name}</td><td class="value">${(+h.value).toFixed(2)}</td><td class="${(+h.gain_value)>=0?'gain-pos':'gain-neg'}">${(+h.gain_value).toFixed(2)}</td><td>${(+h.gain_percentage).toFixed(2)}%</td><td>${(+h.annual_div_yield).toFixed(2)}%</td><td>£${(+h.annual_income).toFixed(2)}</td></tr>`;
  });
  const tBody=document.querySelector("#t212Table tbody");
  tBody.innerHTML="";
  data.isa_feed.filter(x=>x.account==="TRADE212").forEach(h=>{
    tBody.innerHTML+=`<tr><td>${h.name}</td><td class="value">${(+h.value).toFixed(2)}</td><td class="${(+h.gain_value)>=0?'gain-pos':'gain-neg'}">${(+h.gain_value).toFixed(2)}</td><td>${(+h.gain_percentage).toFixed(2)}%</td><td>${(+h.annual_div_yield).toFixed(2)}%</td><td>£${(+h.annual_income).toFixed(2)}</td></tr>`;
  });
}

loadAuroraSync();
setInterval(loadAuroraSync,300000);
</script>
</body>
</html>
