<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aurora Tracker ‚Äì HyperGrid Live Feed</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<style>
/* =======================================================
   HYPERGRID THEME
   ======================================================= */
body {
  margin:0;
  padding:0;
  font-family:'Orbitron',sans-serif;
  color:#fff;
  background-color:#030012;
  background-image:
    linear-gradient(90deg,rgba(255,0,255,0.05) 1px,transparent 1px),
    linear-gradient(rgba(0,255,255,0.05) 1px,transparent 1px);
  background-size:40px 40px;
  animation:scrollGrid 60s linear infinite;
  overflow-x:hidden;
}
@keyframes scrollGrid {
  from{background-position:0 0,0 0;}
  to{background-position:400px 400px,400px 400px;}
}

h1{
  text-align:center;
  font-size:1.8rem;
  margin:20px 0;
  color:#00ffff;
  text-shadow:0 0 15px #00ffff;
}

.dashboard{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(480px,1fr));
  gap:20px;
  margin:0 5%;
}

.card{
  background:rgba(10,10,30,0.65);
  border:1px solid rgba(0,255,255,0.25);
  border-radius:10px;
  padding:20px;
  box-shadow:0 0 20px rgba(0,255,255,0.15);
  backdrop-filter:blur(6px);
  animation:fadeIn 1s ease-in-out;
}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}

/* small headers */
.card h2{
  color:#00ffff;
  font-size:1.2rem;
  border-bottom:1px solid rgba(0,255,255,0.3);
  padding-bottom:6px;
  margin-bottom:12px;
}

.table-holder{
  overflow-x:auto;
  max-height:350px;
}
table{
  width:100%;
  border-collapse:collapse;
  font-size:0.9rem;
}
th,td{padding:6px 8px;text-align:left;}
th{color:#ff66cc;}
tr:nth-child(even){background:rgba(255,255,255,0.05);}
tr:hover{background:rgba(0,255,255,0.1);}
.value{color:#00ffff;}
.gain-pos{color:#00ff99;}
.gain-neg{color:#ff6666;}

#auroraSyncStatus{
  position:fixed;
  top:10px;
  right:20px;
  font-size:0.85rem;
  color:#ccc;
}
#auroraSyncDot{
  display:inline-block;
  width:10px;
  height:10px;
  border-radius:50%;
  background:#888;
  box-shadow:0 0 10px #888;
  margin-right:6px;
  vertical-align:middle;
}
</style>
</head>
<body>
<h1>Aurora Tracker ‚Äì HyperGrid Live Feed</h1>
<div id="auroraSyncStatus"><span id="auroraSyncDot"></span>Syncing‚Ä¶</div>

<div class="dashboard">
  <!-- ===================== SECTION: Portfolio Summary ===================== -->
  <div class="card" id="portfolio-summary">
    <h2>Portfolio Summary</h2>
    <p>Total Target: ¬£<span id="targetValue">0.00</span></p>
    <p>Dividend Yield: <span id="divYield">0.00</span>%</p>
  </div>

  <!-- ===================== SECTION: ISA Balances ===================== -->
  <div class="card" id="isa-balances">
    <h2>ISA Balances</h2>
    <p>IG ISA: ¬£<span id="igBalance">0.00</span></p>
    <p>Trade212 ISA: ¬£<span id="t212Balance">0.00</span></p>
  </div>

  <!-- ===================== SECTION: IG ISA Holdings ===================== -->
  <div class="card" id="ig-holdings">
    <h2>IG ISA Holdings</h2>
    <div class="table-holder">
      <table id="igTable"><thead><tr><th>Ticker</th><th>Value (¬£)</th><th>Gain %</th></tr></thead><tbody></tbody></table>
    </div>
  </div>

  <!-- ===================== SECTION: Trade212 Holdings ===================== -->
  <div class="card" id="t212-holdings">
    <h2>Trade212 Holdings</h2>
    <div class="table-holder">
      <table id="t212Table"><thead><tr><th>Ticker</th><th>Value (¬£)</th><th>Gain %</th></tr></thead><tbody></tbody></table>
    </div>
  </div>

  <!-- ===================== SECTION: Dividends ===================== -->
  <div class="card" id="dividends">
    <h2>Next 5 Dividends</h2>
    <ul id="nextDivs"></ul>
    <h2>Next 5 Ex-Dividends</h2>
    <ul id="nextExDivs"></ul>
  </div>

  <!-- ===================== SECTION: Monthly Dividend Chart ===================== -->
  <div class="card" id="chart">
    <h2>Monthly Dividend Projection</h2>
    <div id="divChart" style="height:300px;"></div>
  </div>
</div>

<script>
/* =======================================================
   AURORA LIVE SYNC
   ======================================================= */
async function loadAuroraSync(){
  const STATUS=document.getElementById("auroraSyncStatus");
  const DOT=document.getElementById("auroraSyncDot");
  const url="https://cdn.jsdelivr.net/gh/webbchrisuk-max/Aurora@main/AuroraSync.json?nocache="+Date.now();

  try{
    const response=await fetch(url,{cache:"no-store"});
    if(!response.ok)throw new Error("HTTP "+response.status);
    const data=await response.json();
    window.AuroraSync=data;

    if(data.integrity && data.integrity.is_valid){
      STATUS.innerHTML='<span id="auroraSyncDot"></span>üü¢ Synced ‚Ä¢ '+data.integrity.last_validated;
      DOT.style.background="#00ffcc";
      DOT.style.boxShadow="0 0 20px #00ffcc";
    }else{
      STATUS.innerHTML='<span id="auroraSyncDot"></span>‚ö†Ô∏è Integrity issue';
      DOT.style.background="#ffaa00";
      DOT.style.boxShadow="0 0 20px #ffaa00";
    }

    renderData(data);
  }catch(err){
    STATUS.innerHTML='<span id="auroraSyncDot"></span>üî¥ Sync failed';
    DOT.style.background="#ff4444";
    DOT.style.boxShadow="0 0 20px #ff4444";
    console.error("AuroraSync load error:",err);
  }
}

/* =======================================================
   RENDER SECTIONS
   ======================================================= */
function renderData(data){
  document.getElementById("targetValue").textContent=data.isa.portfolio_summary.annual_target_value.toFixed(2);
  document.getElementById("divYield").textContent=data.isa.portfolio_summary.dividend_yield.toFixed(2);
  document.getElementById("igBalance").textContent=data.isa.ig_isa.balance.toFixed(2);
  document.getElementById("t212Balance").textContent=data.isa.trade212_isa.balance.toFixed(2);

  // Holdings
  const igBody=document.querySelector("#igTable tbody");
  const tBody=document.querySelector("#t212Table tbody");
  igBody.innerHTML="";
  tBody.innerHTML="";
  data.isa_feed.forEach(h=>{
    const row=document.createElement("tr");
    row.innerHTML=`<td>${h.ticker}</td><td class="value">${(+h.value).toFixed(2)}</td>
    <td class="${h.gain_value>=0?'gain-pos':'gain-neg'}">${(+h.gain_percentage).toFixed(2)}%</td>`;
    if(h.account==="IG ISA")igBody.appendChild(row);
    if(h.account==="TRADE212")tBody.appendChild(row);
  });

  // Dividends
  const now=new Date();
  const upcoming=data.dividends_feed.filter(d=>new Date(d.pay_date)>now)
    .sort((a,b)=>new Date(a.pay_date)-new Date(b.pay_date))
    .slice(0,5);
  const upcomingEx=data.dividends_feed.filter(d=>new Date(d.ex_div_date)>now)
    .sort((a,b)=>new Date(a.ex_div_date)-new Date(b.ex_div_date))
    .slice(0,5);

  const nextDivs=document.getElementById("nextDivs");
  const nextExDivs=document.getElementById("nextExDivs");
  nextDivs.innerHTML="";
  nextExDivs.innerHTML="";
  upcoming.forEach(d=>{
    const li=document.createElement("li");
    li.textContent=`${d.name} ‚Äì ¬£${(+d.total_dividend).toFixed(2)} on ${d.pay_date}`;
    nextDivs.appendChild(li);
  });
  upcomingEx.forEach(d=>{
    const li=document.createElement("li");
    li.textContent=`${d.name} ‚Äì Ex-Div ${d.ex_div_date}`;
    nextExDivs.appendChild(li);
  });

  // Chart
  const months=data.dividend_planner.monthly_breakdown.map(m=>m.month);
  const totals=data.dividend_planner.monthly_breakdown.map(m=>m.total_estimated_income);
  Plotly.newPlot('divChart',[{
    x:months,
    y:totals,
    type:'bar',
    marker:{color:'#00ffff'}
  }],{margin:{t:10},paper_bgcolor:'rgba(0,0,0,0)',plot_bgcolor:'rgba(0,0,0,0)',font:{color:'#fff'}});
}

/* =======================================================
   INIT
   ======================================================= */
loadAuroraSync();
setInterval(loadAuroraSync,300000); // every 5 min
</script>
</body>
</html>
