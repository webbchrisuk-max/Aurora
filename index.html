<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aurora Master Dashboard â€“ Ultra Edition (Mobile Fixed)</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet" />

<style>
:root{
  --cyan:#00ffff;
  --coral:#ff7f50;
  --teal:#00ffd0;
  --amber:#ffb347;
  --bg1:#060018;
  --bg2:#120035;
  --bg3:#001a33;
}
body{
  margin:0;padding:0;
  font-family:'Orbitron',sans-serif;
  color:#fff;
  background:linear-gradient(120deg,var(--bg1),var(--bg2),var(--bg3));
  background-size:600% 600%;
  animation:auroraDrift 45s ease-in-out infinite;
  overflow-x:hidden;
}
@keyframes auroraDrift{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}
h1{text-align:center;font-size:1.8rem;margin:20px 0;text-shadow:0 0 14px rgba(0,255,255,.7);}
.dashboard{display:grid;grid-template-columns:repeat(auto-fit,minmax(360px,1fr));gap:20px;max-width:1200px;margin:0 auto;padding:0 20px 30px;}
.card{
  background:rgba(10,10,30,0.65);
  border:1px solid rgba(0,255,255,0.25);
  border-radius:10px;
  padding:20px;
  box-shadow:0 0 20px rgba(0,255,255,0.15);
  backdrop-filter:blur(6px);
  animation:fadeIn .8s ease-in-out;
}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
.targetBar{width:100%;background:rgba(255,255,255,.1);border-radius:10px;height:16px;margin-top:8px;overflow:hidden;}
.targetFill{height:100%;width:0%;background:linear-gradient(90deg,var(--cyan),#9dfcff);transition:width 1s ease;}
.divTable{width:100%;border-collapse:collapse;font-size:.9rem;margin-top:6px;}
.divTable th,.divTable td{padding:6px 8px;border-bottom:1px solid rgba(255,255,255,.08);text-align:left;}
.divTable th{color:var(--cyan);font-weight:600;text-shadow:0 0 8px rgba(0,255,255,.5);}
.divTable tr:hover{background:rgba(0,255,255,.08);transition:background .3s;}
.divTable td span.amount{color:#00ffcc;text-shadow:0 0 6px rgba(0,255,255,.5);}
.divTable td span.date{color:#ff66cc;text-shadow:0 0 6px rgba(255,102,204,.4);}

/* Holdings Table */
.holdingsTable{width:100%;border-collapse:collapse;font-size:.9rem;margin-top:8px;}
.holdingsTable th,.holdingsTable td{padding:6px 8px;border-bottom:1px solid rgba(255,255,255,.08);text-align:left;}
.holdingsTable th{color:var(--teal);font-weight:600;text-shadow:0 0 8px var(--teal);}
.holdingsTable tr:nth-child(even){background:rgba(255,255,255,.03);}
.holdingsTable tr:hover{background:rgba(0,255,255,.08);transition:background .3s;}

/* Responsive fix for Holdings Tables (iPhone portrait safe) */
.holdingsTable-wrapper {
  width: 100%;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  padding-bottom: 6px;
  margin-bottom: 6px;
}
.holdingsTable-wrapper::-webkit-scrollbar {
  height: 6px;
}
.holdingsTable-wrapper::-webkit-scrollbar-thumb {
  background: rgba(0,255,255,0.4);
  border-radius: 3px;
}
@media (max-width: 600px){
  .holdingsTable th, .holdingsTable td {
    white-space: nowrap;
    font-size: 0.85rem;
    padding: 5px 6px;
  }
}

/* Mobile-friendly yearly chart */
#yearlyBars{overflow-x:auto;display:flex;justify-content:flex-start;align-items:flex-end;height:240px;margin-top:12px;gap:10px;padding-bottom:10px;}
#yearlyBars>div{flex:0 0 auto;}
</style>
</head>

<body>
<h1>Aurora Master Dashboard â€“ Ultra Edition</h1>

<div class="dashboard">

  <!-- Portfolio Summary -->
  <div class="card" id="portfolio-summary">
    <h2>Portfolio Summary</h2>
    <p>Total Target: Â£<span id="targetValue">0.00</span></p>
    <div class="targetBar"><div id="targetFill" class="targetFill"></div></div>
    <p>Dividend Yield: <span id="divYield">0.00</span>%</p>
    <p>Total Gain: <span id="totalGain">0.00</span> (<span id="gainPercent">0.00</span>%)</p>
  </div>

  <!-- ISA Balances -->
  <div class="card" id="isa-balances">
    <h2>ISA Balances</h2>
    <p>IG ISA: Â£<span id="igBalance">0.00</span></p>
    <p>Trade212 ISA: Â£<span id="t212Balance">0.00</span></p>
  </div>

  <!-- Upcoming Dividends -->
  <div class="card" id="dividends-centre">
    <h2>ğŸ“… Upcoming Dividends</h2>
    <h3>ğŸ’° Next 5 Dividends</h3>
    <table class="divTable">
      <thead><tr><th>Company</th><th>Amount</th><th>Pay Date</th></tr></thead>
      <tbody id="nextDivs"></tbody>
    </table>
    <h3 style="margin-top:18px;">ğŸ—“ï¸ Next 5 Ex-Dividends</h3>
    <table class="divTable">
      <thead><tr><th>Company</th><th>Ex-Div Date</th></tr></thead>
      <tbody id="nextExDivs"></tbody>
    </table>
  </div>

  <!-- Dividend Overview -->
  <div class="card" id="dividend-overview">
    <h2>Dividend Overview</h2>
    <p>Forecast Annual Income: Â£<span id="forecastTotal">0.00</span></p>
    <p>YTD Received: Â£<span id="receivedYTD">0.00</span></p>
    <div class="targetBar"><div id="forecastProgress" class="targetFill"></div></div>
    <p style="font-size:.8rem;margin-top:6px;">Progress to Â£6 000 Goal: <span id="forecastPercent">0%</span></p>
    <h3>Quarterly Totals</h3>
    <div id="quarterlyBars" style="display:flex;justify-content:space-around;align-items:flex-end;height:220px;margin-top:12px;gap:10px;"></div>
    <h3 style="margin-top:20px;">Yearly Dividends (Janâ€“Dec)</h3>
    <div id="yearlyBars"></div>
  </div>

  <!-- IG ISA Holdings -->
  <div class="card">
    <h2>IG ISA Holdings</h2>
    <div class="holdingsTable-wrapper"><div id="igContent"></div></div>
  </div>

  <!-- Trade212 ISA Holdings -->
  <div class="card">
    <h2>Trade212 ISA Holdings</h2>
    <div class="holdingsTable-wrapper"><div id="t212Content"></div></div>
  </div>

</div>

<!-- ===================== FIXED SCRIPT ===================== -->
<!-- ===================== SECTION: DATA FETCH + RENDER ===================== -->
<script>
const JSON_URL = "https://raw.githubusercontent.com/webbchrisuk-max/Aurora/refs/heads/main/AuroraSync.json?nocache=";

async function loadAurora() {
  try {
    console.log("Fetching Aurora data...");
    const res = await fetch(JSON_URL + Date.now(), { cache: "no-store" });
    if (!res.ok) throw new Error("HTTP " + res.status);
    const d = await res.json();
    console.log("âœ… Aurora data loaded:", d);

    renderAll(d);
  } catch (e) {
    console.error("âŒ Failed to load Aurora data:", e);
    alert("Data fetch failed. Check your internet connection or JSON link.");
  }
}

// ===================== SECTION: RENDER FUNCTIONS =====================

// Simple example renderer â€” your existing style remains unchanged
function renderSection(containerId, holdings, color) {
  const container = document.getElementById(containerId);
  if (!container) return;

  if (!holdings || holdings.length === 0) {
    container.innerHTML = `<p style="color:#888;">No holdings found</p>`;
    return;
  }

  container.innerHTML = holdings.map(h => `
    <div class="holding-card" style="border-left:4px solid ${color};padding:8px;margin:6px 0;background:rgba(255,255,255,0.05);border-radius:6px;">
      <strong>${h.name}</strong> (${h.ticker})<br>
      Shares: ${h.shares}<br>
      Value: Â£${Number(h.value).toLocaleString()}<br>
      Gain: Â£${Number(h.gain_value).toLocaleString()} (${Number(h.gain_percentage).toFixed(2)}%)<br>
      Yield: ${Number(h.annual_div_yield).toFixed(2)}% | Income Â£${Number(h.annual_income).toFixed(2)}
    </div>
  `).join("");
}

function renderAll(d) {
  // ===================== IG ISA =====================
  renderSection("igContent", d.isa?.holdings?.filter(x => x.account === "IG ISA") || [], "var(--teal)");

  // ===================== Trade212 ISA =====================
  renderSection("t212Content", d.isa?.holdings?.filter(x => x.account === "TRADE212") || [], "var(--blue)");

  // ===================== Dividends (if present) =====================
  if (document.getElementById("dividendsContent")) {
    const upcoming = d.isa?.dividends || [];
    const sorted = upcoming.sort((a, b) => new Date(a.pay_date) - new Date(b.pay_date));
    document.getElementById("dividendsContent").innerHTML = sorted.slice(0, 10).map(div => `
      <div class="div-card" style="border-left:4px solid var(--coral);padding:8px;margin:6px 0;background:rgba(255,255,255,0.05);border-radius:6px;">
        <strong>${div.name}</strong> (${div.ticker})<br>
        Pay Date: ${div.pay_date}<br>
        Dividend: Â£${Number(div.total_dividend).toFixed(2)} (${div.status})
      </div>
    `).join("");
  }
}

loadAurora();
</script>
<!-- ===================== END OF FILE ===================== -->

<!-- ===================== NAV DISCOUNT LEADERBOARD SECTION REMAINS UNCHANGED ===================== -->
<!-- (Your existing NAV leaderboard code from the previous version continues here exactly as is) -->
</body>
</html>
