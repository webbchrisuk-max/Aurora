<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aurora Tracker – HyperGrid Live Feed v2.1 (Dual Dividend Display)</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;padding:0;
  font-family:'Orbitron',sans-serif;
  color:#fff;
  background:#030012;
  background-image:
    linear-gradient(90deg,rgba(255,0,255,0.05) 1px,transparent 1px),
    linear-gradient(rgba(0,255,255,0.05) 1px,transparent 1px);
  background-size:40px 40px;
  animation:scrollGrid 60s linear infinite;
  overflow-x:hidden;
}
@keyframes scrollGrid{from{background-position:0 0,0 0;}to{background-position:400px 400px,400px 400px;}}

h1{text-align:center;font-size:1.8rem;margin:20px 0;color:#00ffff;text-shadow:0 0 15px #00ffff;}
.dashboard{display:grid;grid-template-columns:repeat(auto-fit,minmax(480px,1fr));gap:20px;margin:0 5%;}
.card{
  background:rgba(10,10,30,0.65);
  border:1px solid rgba(0,255,255,0.25);
  border-radius:10px;
  padding:20px;
  box-shadow:0 0 20px rgba(0,255,255,0.15);
  backdrop-filter:blur(6px);
  animation:fadeIn 1s ease-in-out;
}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
.table-holder{overflow-x:auto;max-height:350px;}
table{width:100%;border-collapse:collapse;font-size:0.9rem;}
th,td{padding:6px 8px;text-align:left;}
th{color:#ff66cc;}
tr:nth-child(even){background:rgba(255,255,255,0.05);}
tr:hover{background:rgba(0,255,255,0.1);}
.value{color:#00ffff;}
.gain-pos{color:#00ff99;}
.gain-neg{color:#ff6666;}

#auroraSyncStatus{position:fixed;top:10px;right:20px;font-size:0.85rem;color:#fff;}
#auroraSyncDot{
  display:inline-block;width:10px;height:10px;border-radius:50%;
  background:#00ffcc;box-shadow:0 0 10px #00ffcc;margin-right:6px;vertical-align:middle;
  animation:pulseGlow 3s ease-in-out infinite;
}
@keyframes pulseGlow{0%,100%{box-shadow:0 0 10px #00ffcc;}50%{box-shadow:0 0 25px #00ffff;}}

/* ===================== DIVIDEND CHARTS ===================== */
#dividendCharts{display:flex;flex-wrap:wrap;justify-content:space-between;align-items:flex-start;}
.chartBlock{flex:1 1 45%;text-align:center;}
.chartHolder{display:flex;justify-content:space-around;align-items:flex-end;height:220px;margin-top:10px;}
.bar{
  width:22px;
  background:linear-gradient(180deg,#ff00ff,#00ffff);
  border-radius:6px 6px 0 0;
  box-shadow:0 0 15px #00ffff;
  animation:pulseBar 4s ease-in-out infinite;
}
@keyframes pulseBar{0%,100%{opacity:0.9;box-shadow:0 0 15px #00ffff;}50%{opacity:1;box-shadow:0 0 25px #ff00ff;}}
.bar-label{text-align:center;margin-top:4px;font-size:0.75rem;}
.qbar{width:75px;background:linear-gradient(180deg,#ff00ff,#00ffff);border-radius:6px 6px 0 0;
  box-shadow:0 0 15px #00ffff;animation:pulseBar 4s ease-in-out infinite;}
.qbar-label{text-align:center;margin-top:6px;font-size:0.8rem;}
</style>
</head>

<body>
<h1>Aurora Tracker – HyperGrid Live Feed v2.1 (Dual Dividend Display)</h1>
<div id="auroraSyncStatus"><span id="auroraSyncDot"></span>Synced</div>

<div class="dashboard">

  <!-- PORTFOLIO SUMMARY -->
  <div class="card" id="portfolio-summary">
    <h2>Portfolio Summary</h2>
    <p>Total Target: £<span id="targetValue">0.00</span></p>
    <p>Dividend Yield: <span id="divYield">0.00</span>%</p>
  </div>

  <!-- ISA BALANCES -->
  <div class="card" id="isa-balances">
    <h2>ISA Balances</h2>
    <p>IG ISA: £<span id="igBalance">0.00</span></p>
    <p>Trade212 ISA: £<span id="t212Balance">0.00</span></p>
  </div>

  <!-- IG ISA HOLDINGS -->
  <div class="card" id="ig-holdings">
    <h2>IG ISA Holdings</h2>
    <div class="table-holder"><table id="igTable"><thead>
      <tr><th>Name</th><th>Value (£)</th><th>Gain (£)</th><th>Gain (%)</th><th>Yield (%)</th><th>Income (£)</th></tr>
    </thead><tbody></tbody></table></div>
  </div>

  <!-- TRADE212 HOLDINGS -->
  <div class="card" id="t212-holdings">
    <h2>Trade212 Holdings</h2>
    <div class="table-holder"><table id="t212Table"><thead>
      <tr><th>Name</th><th>Value (£)</th><th>Gain (£)</th><th>Gain (%)</th><th>Yield (%)</th><th>Income (£)</th></tr>
    </thead><tbody></tbody></table></div>
  </div>

  <!-- DIVIDENDS -->
  <div class="card" id="dividends">
    <h2>Next 5 Dividends</h2><ul id="nextDivs"></ul>
    <h2>Next 5 Ex-Dividends</h2><ul id="nextExDivs"></ul>
  </div>

  <!-- DIVIDEND CHARTS -->
  <div class="card" id="dividend-charts">
    <h2>Dividend Income Overview</h2>
    <div id="dividendCharts">
      <div class="chartBlock">
        <h3>Monthly Breakdown</h3>
        <div id="monthlyBars" class="chartHolder"></div>
      </div>
      <div class="chartBlock">
        <h3>Quarterly Totals</h3>
        <div id="quarterlyBars" class="chartHolder"></div>
      </div>
    </div>
  </div>

</div>

<script>
async function loadAuroraSync(){
  const STATUS=document.getElementById("auroraSyncStatus");
  const url="https://cdn.jsdelivr.net/gh/webbchrisuk-max/Aurora@main/AuroraSync.json?nocache="+Date.now();
  try{
    const res=await fetch(url,{cache:"no-store"});
    if(!res.ok) throw new Error("HTTP "+res.status);
    const data=await res.json();
    renderData(data);
  }catch(err){
    STATUS.innerHTML='<span id="auroraSyncDot" style="background:#ff4444;box-shadow:0 0 20px #ff4444;"></span>Sync Error';
    console.error(err);
  }
}

function renderData(data){
  document.getElementById("targetValue").textContent=data.isa.portfolio_summary.annual_target_value.toFixed(2);
  document.getElementById("divYield").textContent=data.isa.portfolio_summary.dividend_yield.toFixed(2);
  document.getElementById("igBalance").textContent=data.isa.ig_isa.balance.toFixed(2);
  document.getElementById("t212Balance").textContent=data.isa.trade212_isa.balance.toFixed(2);

  const igBody=document.querySelector("#igTable tbody");
  igBody.innerHTML="";
  data.isa_feed.filter(x=>x.account==="IG ISA").forEach(h=>{
    igBody.insertAdjacentHTML("beforeend",
      `<tr><td>${h.name}</td><td class="value">${(+h.value).toFixed(2)}</td>
      <td class="${h.gain_value>=0?'gain-pos':'gain-neg'}">${(+h.gain_value).toFixed(2)}</td>
      <td class="${h.gain_value>=0?'gain-pos':'gain-neg'}">${(+h.gain_percentage).toFixed(2)}%</td>
      <td>${(+h.annual_div_yield).toFixed(2)}%</td><td>${(+h.annual_income).toFixed(2)}</td></tr>`);
  });

  const tBody=document.querySelector("#t212Table tbody");
  tBody.innerHTML="";
  data.isa_feed.filter(x=>x.account==="TRADE212").forEach(h=>{
    tBody.insertAdjacentHTML("beforeend",
      `<tr><td>${h.name}</td><td class="value">${(+h.value).toFixed(2)}</td>
      <td class="${h.gain_value>=0?'gain-pos':'gain-neg'}">${(+h.gain_value).toFixed(2)}</td>
      <td class="${h.gain_value>=0?'gain-pos':'gain-neg'}">${(+h.gain_percentage).toFixed(2)}%</td>
      <td>${(+h.annual_div_yield).toFixed(2)}%</td><td>${(+h.annual_income).toFixed(2)}</td></tr>`);
  });

  const now=new Date();
  const upcoming=data.dividends_feed.filter(d=>new Date(d.pay_date)>now)
    .sort((a,b)=>new Date(a.pay_date)-new Date(b.pay_date)).slice(0,5);
  const upcomingEx=data.dividends_feed.filter(d=>new Date(d.ex_div_date)>now)
    .sort((a,b)=>new Date(a.ex_div_date)-new Date(b.ex_div_date)).slice(0,5);
  const nextDivs=document.getElementById("nextDivs");
  const nextExDivs=document.getElementById("nextExDivs");
  nextDivs.innerHTML=upcoming.map(d=>`<li>${d.name} – £${(+d.total_dividend).toFixed(2)} on ${d.pay_date}</li>`).join('');
  nextExDivs.innerHTML=upcomingEx.map(d=>`<li>${d.name} – Ex-Div ${d.ex_div_date}</li>`).join('');

  // MONTHLY CHART Nov25-Nov26
  const mData=data.dividend_planner.monthly_breakdown.slice(10,22); // Nov25→Nov26
  const mBars=document.getElementById("monthlyBars");
  mBars.innerHTML="";
  const mMax=Math.max(...mData.map(m=>m.total_estimated_income));
  mData.forEach(m=>{
    const wrap=document.createElement("div");
    wrap.style.display="flex";
    wrap.style.flexDirection="column";
    wrap.style.alignItems="center";
    const bar=document.createElement("div");
    bar.className="bar";
    bar.style.height=(m.total_estimated_income/mMax*180)+"px";
    wrap.appendChild(bar);
    const lbl=document.createElement("div");
    lbl.className="bar-label";
    lbl.textContent=m.month.split(" ")[0].slice(0,3);
    wrap.appendChild(lbl);
    mBars.appendChild(wrap);
  });

  // QUARTERLY CHART
  const qData=data.dividend_planner.quarterly_breakdown;
  const qBars=document.getElementById("quarterlyBars");
  qBars.innerHTML="";
  const qMax=Math.max(...Object.values(qData));
  Object.entries(qData).forEach(([q,v])=>{
    const wrap=document.createElement("div");
    wrap.style.display="flex";wrap.style.flexDirection="column";wrap.style.alignItems="center";
    const bar=document.createElement("div");
    bar.className="qbar";bar.style.height=(v/qMax*180)+"px";wrap.appendChild(bar);
    const lbl=document.createElement("div");
    lbl.className="qbar-label";lbl.innerHTML=`${q}<br>£${v.toFixed(2)}`;
    wrap.appendChild(lbl);
    qBars.appendChild(wrap);
  });
}

loadAuroraSync();
setInterval(loadAuroraSync,300000);
</script>
</body>
</html>
