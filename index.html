<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aurora Tracker â€“ Cinematic Edition (ISA Only)</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />

<style>
:root{
  --cyan:#00eaff;
  --coral:#ff7f50;
  --teal:#00ffd0;
  --amber:#ffb347;
  --bg1:#060018;
  --bg2:#120035;
  --bg3:#001a33;
}
body{
  margin:0;
  padding:0;
  font-family:'Orbitron',sans-serif;
  background:linear-gradient(120deg,var(--bg1),var(--bg2),var(--bg3));
  background-size:600% 600%;
  animation:auroraDrift 40s ease-in-out infinite;
  color:#fff;
}
@keyframes auroraDrift{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}

.container{
  max-width:1100px;
  margin:auto;
  padding:20px;
}

.section-title{
  font-size:22px;
  text-align:center;
  color:var(--cyan);
  text-shadow:0 0 10px var(--cyan);
  margin-top:30px;
}

.card{
  background:rgba(255,255,255,0.06);
  border:1px solid rgba(255,255,255,0.15);
  border-radius:16px;
  padding:18px;
  margin-bottom:18px;
  backdrop-filter:blur(8px);
  box-shadow:0 0 15px rgba(0,255,255,0.15);
}

.table{
  width:100%;
  border-collapse:collapse;
}
.table th{
  background:rgba(0,200,255,0.3);
  padding:10px;
}
.table td{
  padding:8px;
  border-bottom:1px solid rgba(255,255,255,0.1);
}

.dividend-item{
  padding:10px;
  background:rgba(255,255,255,0.07);
  border-radius:10px;
  margin-bottom:10px;
  border:1px solid rgba(255,255,255,0.15);
  display:flex;
  justify-content:space-between;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const AURORA_SYNC =
  "https://raw.githubusercontent.com/webbchrisuk-max/Aurora/refs/heads/main/AuroraSync.json";

async function loadJSON(url){
  const r=await fetch(url+"?nocache="+Date.now());
  return r.json();
}

async function init(){
  const sync = await loadJSON(AURORA_SYNC);

  renderHoldings(sync);
  renderPortfolio(sync);
  renderNextFive(sync);
  renderUpcoming(sync);
  renderYTD(sync);
  renderChart(sync);
  renderOutlook(sync);
}

/*** HOLDINGS TABLE ***/
function renderHoldings(sync){
  const holdings = sync.isa?.holdings || [];
  
  if(holdings.length===0){
    document.getElementById("holdings").innerHTML="<p>No holdings found.</p>";
    return;
  }

  let html=`<table class="table">
  <tr>
    <th>Ticker</th>
    <th>Name</th>
    <th>Shares</th>
    <th>Value</th>
    <th>Book</th>
    <th>G/L</th>
  </tr>`;

  holdings.forEach(h=>{
    const gain=(h.current_value - h.book_cost).toFixed(2);
    html+=`
      <tr>
        <td>${h.ticker}</td>
        <td>${h.name}</td>
        <td>${h.shares}</td>
        <td>Â£${h.current_value}</td>
        <td>Â£${h.book_cost}</td>
        <td style="color:${gain>=0?'lime':'red'}">Â£${gain}</td>
      </tr>
    `;
  });

  html+=`</table>`;
  document.getElementById("holdings").innerHTML=html;
}

/*** PORTFOLIO SUMMARY ***/
function renderPortfolio(sync){
  const p = sync.isa.portfolio_summary;
  document.getElementById("portfolio").innerHTML=`
    <p><strong>Total Value:</strong> Â£${p.total_value}</p>
    <p><strong>Annual Yield:</strong> ${p.dividend_yield}%</p>
    <p><strong>Projected Annual Income:</strong> Â£${p.annual_total || p.annual_income_gbp}</p>
  `;
}

/*** NEXT FIVE DIVIDENDS ***/
function renderNextFive(sync){
  const list = sync.isa?.dividends?.next_five || [];
  let html="";
  list.forEach(d=>{
    html+=`
      <div class="dividend-item">
        <div><strong>${d.ticker}</strong><br>${d.name}<br>Pay: ${d.pay_date}</div>
        <div>Â£${d.total_dividend.toFixed(2)}</div>
      </div>
    `;
  });
  document.getElementById("next5").innerHTML=html;
}

/*** FULL UPCOMING LIST ***/
function renderUpcoming(sync){
  const list = sync.isa?.dividends?.upcoming || [];
  let html="";
  list.forEach(d=>{
    html+=`
      <div class="dividend-item">
        <div>
          <strong>${d.ticker}</strong> â€“ ${d.name}<br>
          Ex: ${d.ex_div_date}<br>
          Pay: ${d.pay_date}
        </div>
        <div>Â£${d.total_dividend.toFixed(2)}</div>
      </div>
    `;
  });
  document.getElementById("upcoming").innerHTML=html;
}

/*** YTD ***/
function renderYTD(sync){
  const totals = sync.isa?.dividends?.monthly_totals || {};
  let sum = 0;
  Object.values(totals).forEach(v=> sum+=v);
  document.getElementById("ytd").innerHTML=`<h2>Â£${sum.toFixed(2)}</h2>`;
}

/*** 12-MONTH CHART ***/
function renderChart(sync){
  const totals = sync.isa?.dividends?.monthly_totals || {};
  const labels = Object.keys(totals);
  const values = Object.values(totals);

  new Chart(document.getElementById("divchart"),{
    type:"bar",
    data:{ labels, datasets:[{ data:values, borderWidth:1 }] },
    options:{ plugins:{legend:false}, scales:{y:{beginAtZero:true}} }
  });
}

/*** OUTLOOK PANELS ***/
function renderOutlook(sync){
  const r = sync.reits_outlook;
  const f = sync.financials_outlook;

  let htmlR="", htmlF="";
  for(const k in r){
    htmlR+=`<p><strong>${k}:</strong> ${r[k].status || "â€“"} â€” ${r[k].notes || ""}</p>`;
  }
  for(const k in f){
    htmlF+=`<p><strong>${k}:</strong> ${f[k].status || "â€“"} â€” ${f[k].notes || ""}</p>`;
  }

  document.getElementById("reits").innerHTML=htmlR;
  document.getElementById("financials").innerHTML=htmlF;
}

</script>

</head>
<body onload="init()">

<div class="container">

<h1 class="section-title">ðŸŒŒ Aurora Tracker â€“ Cinematic Edition (ISA)</h1>

<div class="card">
  <h2 class="section-title">Holdings</h2>
  <div id="holdings"></div>
</div>

<div class="card">
  <h2 class="section-title">Portfolio Summary</h2>
  <div id="portfolio"></div>
</div>

<div class="card">
  <h2 class="section-title">Next 5 Dividends</h2>
  <div id="next5"></div>
</div>

<div class="card">
  <h2 class="section-title">All Upcoming Dividends</h2>
  <div id="upcoming"></div>
</div>

<div class="card">
  <h2 class="section-title">Dividend Forecast (12 Months)</h2>
  <canvas id="divchart"></canvas>
</div>

<div class="card">
  <h2 class="section-title">YTD Dividend Income</h2>
  <div id="ytd"></div>
</div>

<div class="card">
  <h2 class="section-title">REITs Outlook</h2>
  <div id="reits"></div>
</div>

<div class="card">
  <h2 class="section-title">Financials Outlook</h2>
  <div id="financials"></div>
</div>

</div>
</body>
</html>
