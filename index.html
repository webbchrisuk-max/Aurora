<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aurora Tracker â€“ HyperGrid Live Feed v3.1 (Drift + Sector Alignment)</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

<!-- ===================== SECTION: CORE THEME + ENHANCED AURORA BACKGROUND ===================== -->
<style>
:root{
  --cyan:#00ffff;
  --magenta:#ff00ff;
  --pink:#ff66cc;
  --green:#00ff99;
  --bg1:#020010;
  --bg2:#180040;
  --bg3:#002255;
  --bg4:#330033;
  --bg5:#004466;
}

/* full-screen animated aurora gradient */
body{
  margin:0;
  padding:0;
  font-family:'Orbitron',sans-serif;
  color:#fff;
  background:linear-gradient(125deg,
    var(--bg1),
    var(--bg2),
    var(--bg3),
    var(--bg4),
    var(--bg5));
  background-size:800% 800%;
  animation:auroraDrift 35s linear infinite;
  overflow-x:hidden;
  will-change:background-position;
}
@keyframes auroraDrift{
  0%{background-position:0% 50%;}
  25%{background-position:50% 100%;}
  50%{background-position:100% 50%;}
  75%{background-position:50% 0%;}
  100%{background-position:0% 50%;}
}

/* titles and general grid */
h1{
  text-align:center;
  font-size:1.8rem;
  margin:20px 0;
  color:var(--cyan);
  text-shadow:0 0 20px var(--cyan);
}
h2,h3{color:var(--pink);margin-top:0.5em;}

.dashboard{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(480px,1fr));
  gap:20px;
  margin:0 5%;
}

/* cards */
.card{
  background:rgba(10,10,30,0.65);
  border:1px solid rgba(0,255,255,0.25);
  border-radius:10px;
  padding:20px;
  box-shadow:0 0 20px rgba(0,255,255,0.15);
  backdrop-filter:blur(6px);
  animation:fadeIn 1s ease-in-out;
}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}

/* glowing table */
.table-holder{overflow-x:auto;max-height:350px;}
table{width:100%;border-collapse:collapse;font-size:0.9rem;}
th,td{padding:6px 8px;text-align:left;}
th{color:var(--pink);}
tr:nth-child(even){background:rgba(255,255,255,0.05);}
tr:hover{background:rgba(0,255,255,0.1);}
.value{color:var(--cyan);}
.gain-pos{color:var(--green);}
.gain-neg{color:#ff5555;}

/* sync indicator */
#auroraSyncStatus{
  position:fixed;top:10px;right:20px;
  font-size:0.85rem;color:#fff;
}
#auroraSyncDot{
  display:inline-block;width:10px;height:10px;border-radius:50%;
  background:var(--cyan);
  box-shadow:0 0 10px var(--cyan);
  margin-right:6px;vertical-align:middle;
  animation:pulseGlow 3s ease-in-out infinite;
}
@keyframes pulseGlow{
  0%,100%{box-shadow:0 0 10px var(--cyan);}
  50%{box-shadow:0 0 25px var(--magenta);}
}

/* smart timestamp */
#syncTime{display:block;font-size:0.75rem;color:#aaa;margin-top:2px;}

/* highlight colours */
.amount-green{color:var(--green);}
.date-pink{color:var(--pink);}

/* responsive */
@media(max-width:720px){
  .dashboard{grid-template-columns:1fr;margin:0 3%;}
}
</style>
</head>
<body>
<h1>Aurora Tracker â€“ HyperGrid Live Feed v3.1 (Drift + Sector Alignment)</h1>

<!-- ===================== SECTION: SYNC STATUS ===================== -->
<div id="auroraSyncStatus">
  <span id="auroraSyncDot"></span>Synced
  <span id="syncTime">Last updated --:-- Â· Next sync in 5 min</span>
</div>

<!-- ===================== SECTION: DASHBOARD GRID ===================== -->
<div class="dashboard">

  <!-- ===================== SECTION: PORTFOLIO SUMMARY ===================== -->
  <div class="card" id="portfolio-summary">
    <h2>Portfolio Summary</h2>
    <p>Total Target: Â£<span id="targetValue">0.00</span></p>
    <p>Dividend Yield: <span id="divYield">0.00</span>%</p>
    <p>Total Gain: <span id="totalGain">0.00</span> ( <span id="gainPercent">0.00</span>% )</p>
  </div>

  <!-- ===================== SECTION: ISA BALANCES ===================== -->
  <div class="card" id="isa-balances">
    <h2>ISA Balances</h2>
    <p>IG ISA: Â£<span id="igBalance">0.00</span></p>
    <p>Trade212 ISA: Â£<span id="t212Balance">0.00</span></p>
  </div>

  <!-- ===================== SECTION: IG ISA HOLDINGS ===================== -->
  <div class="card" id="ig-holdings">
    <h2>IG ISA Holdings</h2>
    <div class="table-holder">
      <table id="igTable">
        <thead>
          <tr>
            <th>Name</th>
            <th>Value (Â£)</th>
            <th>Gain (Â£)</th>
            <th>Gain (%)</th>
            <th>Yield (%)</th>
            <th>Income (Â£)</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- ===================== SECTION: TRADE212 HOLDINGS ===================== -->
  <div class="card" id="t212-holdings">
    <h2>Trade212 Holdings</h2>
    <div class="table-holder">
      <table id="t212Table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Value (Â£)</th>
            <th>Gain (Â£)</th>
            <th>Gain (%)</th>
            <th>Yield (%)</th>
            <th>Income (Â£)</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- ===================== SECTION: DIVIDENDS CENTRE (LIST + CALENDAR TOGGLE) ===================== -->
  <div class="card" id="dividends">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <h2>Dividends Centre</h2>
      <button id="toggleCalendar" style="background:rgba(0,0,0,0.4);
        border:1px solid var(--cyan);color:#fff;padding:5px 10px;border-radius:6px;cursor:pointer;">
        ðŸ“… Calendar View
      </button>
    </div>

    <!-- List View -->
    <div id="dividendListView">
      <h3>Next 5 Dividends</h3>
      <ul id="nextDivs"></ul>
      <h3>Next 5 Ex-Dividends</h3>
      <ul id="nextExDivs"></ul>
    </div>

    <!-- Calendar View -->
    <div id="dividendCalendarView" style="display:none;text-align:center;">
      <canvas id="divCalendar" width="420" height="320"></canvas>
      <p style="font-size:0.8rem;color:#aaa;">Tap again to return to list view</p>
    </div>
  </div>

  <!-- ===================== SECTION: DIVIDEND CHARTS (MONTHLY + QUARTERLY) ===================== -->
  <div class="card" id="dividend-charts">
    <h2>Dividend Income Overview</h2>

    <div id="dividendCharts" style="display:flex;flex-wrap:wrap;justify-content:space-between;gap:18px;">
      <!-- Monthly -->
      <div class="chartBlock" style="flex:1 1 45%;text-align:center;">
        <h3>Monthly Breakdown (Nov 2025 â†’ Nov 2026)</h3>
        <div id="monthlyBars" class="chartHolder"
             style="display:flex;justify-content:space-around;align-items:flex-end;height:240px;margin-top:12px;gap:10px;"></div>
      </div>

      <!-- Quarterly -->
      <div class="chartBlock" style="flex:1 1 45%;text-align:center;">
        <h3>Quarterly Totals</h3>
        <div id="quarterlyBars" class="chartHolder"
             style="display:flex;justify-content:space-around;align-items:flex-end;height:240px;margin-top:12px;gap:10px;"></div>
      </div>
    </div>

    <!-- Forecast Band -->
    <div id="forecastBand" style="margin-top:25px;text-align:center;">
      <h3>Dividend Forecast</h3>
      <p>Forecast Annual Income: Â£<span id="forecastTotal">0.00</span> Â· YTD Received: Â£<span id="receivedYTD">0.00</span></p>
      <div style="width:90%;margin:0 auto;background:rgba(255,255,255,0.1);border-radius:8px;height:16px;overflow:hidden;">
        <div id="forecastProgress"
             style="height:100%;width:0%;
             background:linear-gradient(90deg,var(--cyan),var(--pink));
             box-shadow:0 0 10px var(--cyan);
             transition:width 1s ease;"></div>
      </div>
      <p style="font-size:0.8rem;margin-top:6px;">Progress to Â£6 000 Goal: <span id="forecastPercent">0%</span></p>
    </div>
  </div>

  <!-- ===================== SECTION: SECTOR ALLOCATION RINGS (MOVED BESIDE CHARTS) ===================== -->
  <div class="card" id="sector-allocation">
    <h2>Sector Allocation Rings</h2>
    <div style="display:flex;flex-wrap:wrap;justify-content:space-around;gap:20px;">
      <div style="text-align:center;">
        <h3>IG ISA</h3>
        <canvas id="igSectorRing" width="200" height="200"></canvas>
      </div>
      <div style="text-align:center;">
        <h3>Trade212 ISA</h3>
        <canvas id="t212SectorRing" width="200" height="200"></canvas>
      </div>
    </div>
  </div>

</div>
<!-- ===================== SECTION: SCRIPT CORE ===================== -->
<script>
async function loadAuroraSync() {
  const dot = document.getElementById("auroraSyncDot");
  const status = document.getElementById("auroraSyncStatus");
  const syncTime = document.getElementById("syncTime");

  try {
    const url = "https://raw.githubusercontent.com/webbchrisuk-max/Aurora/main/AuroraSync.json?nocache=" + Date.now();
    const response = await fetch(url);
    const data = await response.json();

    // âœ… live indicator
    dot.style.background = "var(--green)";
    dot.style.boxShadow = "0 0 15px var(--green)";
    syncTime.textContent = "Last updated " + new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'}) + " Â· Live";
    populateDashboard(data);

  } catch (err) {
    dot.style.background = "#666";
    dot.style.boxShadow = "0 0 8px #666";
    syncTime.textContent = "Sync failed Â· retrying soon";
  }
}

/* ===================== DASHBOARD POPULATION ===================== */
function populateDashboard(data){
  // Portfolio summary
  document.getElementById("targetValue").textContent = data.isa.portfolio_summary.annual_target_value.toFixed(2);
  document.getElementById("divYield").textContent = data.isa.portfolio_summary.dividend_yield.toFixed(2);
  document.getElementById("igBalance").textContent = data.isa.ig_isa.balance.toFixed(2);
  document.getElementById("t212Balance").textContent = data.isa.trade212_isa.balance.toFixed(2);

  // Gains
  const gain = data.isa.ig_isa.unrealised_gain + data.isa.trade212_isa.unrealised_gain;
  const gainPct = ((gain / (data.isa.ig_isa.book_cost + data.isa.trade212_isa.book_cost)) * 100);
  document.getElementById("totalGain").textContent = gain.toFixed(2);
  document.getElementById("gainPercent").textContent = gainPct.toFixed(2);

  // IG Holdings
  const igBody = document.querySelector("#igTable tbody");
  igBody.innerHTML = "";
  data.isa_feed.filter(x=>x.account==="IG ISA").forEach(h=>{
    igBody.innerHTML += `
      <tr>
        <td>${h.name}</td>
        <td class="value">${(+h.value).toFixed(2)}</td>
        <td class="${(+h.gain_value)>=0?'gain-pos':'gain-neg'}">${(+h.gain_value).toFixed(2)}</td>
        <td>${(+h.gain_percentage).toFixed(2)}%</td>
        <td>${(+h.annual_div_yield).toFixed(2)}%</td>
        <td>Â£${(+h.annual_income).toFixed(2)}</td>
      </tr>`;
  });

  // Trade212 Holdings
  const tBody = document.querySelector("#t212Table tbody");
  tBody.innerHTML = "";
  data.isa_feed.filter(x=>x.account==="TRADE212").forEach(h=>{
    tBody.innerHTML += `
      <tr>
        <td>${h.name}</td>
        <td class="value">${(+h.value).toFixed(2)}</td>
        <td class="${(+h.gain_value)>=0?'gain-pos':'gain-neg'}">${(+h.gain_value).toFixed(2)}</td>
        <td>${(+h.gain_percentage).toFixed(2)}%</td>
        <td>${(+h.annual_div_yield).toFixed(2)}%</td>
        <td>Â£${(+h.annual_income).toFixed(2)}</td>
      </tr>`;
  });

  // Dividends
  populateDividends(data);
  buildCharts(data);
  buildSectorRings(data);
}

/* ===================== DIVIDEND LISTS ===================== */
function populateDividends(data){
  const nextDivs = data.dividends_feed
    .filter(x=>["Confirmed","Estimated"].includes(x.status))
    .sort((a,b)=>new Date(a.pay_date)-new Date(b.pay_date))
    .slice(0,5);

  const nextEx = data.dividends_feed
    .filter(x=>["Confirmed","Estimated"].includes(x.status))
    .sort((a,b)=>new Date(a.ex_div_date)-new Date(b.ex_div_date))
    .slice(0,5);

  const nd = document.getElementById("nextDivs");
  const ne = document.getElementById("nextExDivs");
  nd.innerHTML = "";
  ne.innerHTML = "";

  nextDivs.forEach(d=>{
    nd.innerHTML += `<li>
      <span>${d.ticker}</span> â€“
      <span class="amount-green">Â£${(+d.total_dividend).toFixed(2)}</span>
      <span class="date-pink">(${d.pay_date})</span>
    </li>`;
  });
  nextEx.forEach(d=>{
    ne.innerHTML += `<li>
      <span>${d.ticker}</span> â€“
      <span class="date-pink">${d.ex_div_date}</span>
    </li>`;
  });
}

/* ===================== DIVIDEND CHARTS ===================== */
function buildCharts(data){
  const monthlyDiv = document.getElementById("monthlyBars");
  const qDiv = document.getElementById("quarterlyBars");

  const months = data.dividend_planner.monthly_breakdown;
  const quarters = Object.entries(data.dividend_planner.quarterly_breakdown);

  monthlyDiv.innerHTML="";
  months.forEach(m=>{
    const val = +m.total_estimated_income;
    const height = Math.min(220, val/10);
    const bar = document.createElement("div");
    bar.style.height = height+"px";
    bar.style.width = "18px";
    bar.style.background = "linear-gradient(180deg,var(--cyan),var(--pink))";
    bar.style.borderRadius="4px";
    bar.style.transition="height 1s";
    bar.title=`${m.month}: Â£${val.toFixed(2)}`;
    monthlyDiv.appendChild(bar);
  });

  qDiv.innerHTML="";
  quarters.forEach(([q,v])=>{
    const val = +v;
    const height = Math.min(220, val/5);
    const bar = document.createElement("div");
    bar.style.height = height+"px";
    bar.style.width = "45px";
    bar.style.background = "linear-gradient(180deg,var(--magenta),var(--cyan))";
    bar.style.borderRadius="6px";
    bar.title=`${q}: Â£${val.toFixed(2)}`;
    qDiv.appendChild(bar);
  });

  // forecast
  document.getElementById("forecastTotal").textContent = data.dividend_planner.cashflow_projection.annual_total_projection.toFixed(2);
  document.getElementById("receivedYTD").textContent = data.dividend_planner.received_ytd.toFixed(2);
  document.getElementById("forecastPercent").textContent = data.dividend_planner.cashflow_projection.percent_to_goal.toFixed(2)+"%";
  document.getElementById("forecastProgress").style.width = data.dividend_planner.cashflow_projection.percent_to_goal+"%";
}

/* ===================== SECTOR RINGS ===================== */
function buildSectorRings(data){
  const ctx1 = document.getElementById("igSectorRing").getContext("2d");
  const ctx2 = document.getElementById("t212SectorRing").getContext("2d");

  drawRing(ctx1, data.isa.portfolio_summary.sector_allocation, "var(--cyan)");
  drawRing(ctx2, data.isa.portfolio_summary.sector_allocation, "var(--magenta)");
}

function drawRing(ctx, sectors, color){
  const total = Object.values(sectors).reduce((a,b)=>a+b,0);
  let start=0;
  Object.entries(sectors).forEach(([k,v],i)=>{
    const slice = (v/total)*2*Math.PI;
    ctx.beginPath();
    ctx.strokeStyle=color;
    ctx.lineWidth=18;
    ctx.shadowBlur=10;
    ctx.shadowColor=color;
    ctx.arc(100,100,70,start,start+slice);
    ctx.stroke();
    start+=slice;
  });
}
</script>
<!-- ===================== SECTION: SCRIPT â€“ AUTO REFRESH LOOP ===================== -->
<script>
// Initial load and auto-refresh every 5 min
loadAuroraSync();
setInterval(loadAuroraSync, 300000); // 300 000 ms = 5 min

// Optional: toggle list/calendar for dividends
document.getElementById("toggleCalendar").addEventListener("click",()=>{
  const list=document.getElementById("dividendListView");
  const cal=document.getElementById("dividendCalendarView");
  list.style.display=list.style.display==="none"?"block":"none";
  cal.style.display=cal.style.display==="none"?"block":"none";
});
</script>
</body>
</html>  
  
