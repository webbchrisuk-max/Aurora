<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aurora ISA Tracker â€“ Cinematic Edition v2</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />

<style>
:root{
  --cyan:#00eaff;
  --teal:#00ffd0;
  --amber:#ffb347;
  --pink:#ff4dff;
  --purple:#8d4dff;
  --gainGreen:#6bff6b;
  --bg1:#050016;
  --bg2:#120035;
  --bg3:#001628;
}

/* ===================== GLOBAL BACKGROUND ===================== */
body{
  margin:0;
  padding:0;
  font-family:'Orbitron',sans-serif;

  background-image: url(https://raw.githubusercontent.com/webbchrisuk-max/Aurora/main/.png/C1FEE15E-E445-4155-AFA5-94F85F22C952.png);
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  background-attachment: fixed;

  color:#fff;
  overflow-x:hidden;
}

/* ===================== EXPANDER ENGINES ===================== */
.expander-content-inner{
  text-align:center;
}
.expander-row{
  display:flex;
  justify-content:center;
  gap:50px;
  margin:10px 0;
  font-size:1rem;
}
.expander-label{
  width:180px;
  text-align:right;
  color:var(--teal);
  font-weight:600;
}
.expander-value{
  width:180px;
  text-align:left;
  color:var(--amber);
  font-weight:700;
}
.expander-value.glow-gain{
  color:var(--gainGreen);
  text-shadow:0 0 10px var(--gainGreen),0 0 15px var(--gainGreen);
}

/* ===================== PAGE GRID ===================== */
.cinematic-grid{
  display:flex;
  gap:25px;
  padding:20px;
  max-width:1450px;
  margin:auto;
}
.left-panel{
  width:60%;
  display:flex;
  flex-direction:column;
  gap:25px;
}
.right-panel{
  width:40%;
  display:flex;
  flex-direction:column;
  gap:25px;
}

/* ===================== HOLOGRAPHIC CARD ===================== */
.holo-card{
  background:rgba(255,255,255,0.06);
  border:1px solid rgba(0,255,255,0.25);
  border-radius:20px;
  padding:20px;
  position:relative;
  box-shadow:0 0 18px rgba(0,255,255,0.2);
  backdrop-filter:blur(12px);
  overflow:hidden;
}
.holo-card::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius:20px;
  padding:2px;
  background:linear-gradient(120deg,var(--cyan),var(--teal),var(--pink),var(--purple),var(--cyan));
  background-size:400% 400%;
  animation:holoPulse 8s ease infinite;
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor;
          mask-composite:exclude;
}
@keyframes holoPulse{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}

.section-header{
  font-size:22px;
  font-weight:700;
  color:var(--cyan);
  margin-bottom:10px;
  text-shadow:0 0 12px var(--cyan);
}

/* ===================== EXPANDERS ===================== */
.expander-toggle{
  margin-top:14px;
  padding:12px 25px;
  display:block;
  font-size:0.95rem;
  cursor:pointer;
  border-radius:40px;
  user-select:none;
  width:85%;
  margin-left:auto;
  margin-right:auto;
  text-align:center;
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(6px);
  border:1px solid rgba(0,255,255,0.35);
  box-shadow:0 0 10px rgba(0,255,255,0.45), 0 0 22px rgba(0,255,255,0.25);
  color:#00faff;
  font-weight:700;
}
.expander-content{
  overflow:hidden;
  max-height:0;
  transition:max-height 0.35s ease-in-out;
}

/* ===================== PROGRESS BAR ===================== */
#saye-progress-wrap{
  width:100%;
  height:22px;
  background:rgba(255,255,255,0.1);
  border-radius:16px;
  overflow:hidden;
  box-shadow:0 0 12px rgba(0,255,255,0.35);
  margin-bottom:12px;
}
#saye-progress-bar{
  height:100%;
  width:0%;
  background:linear-gradient(120deg,var(--cyan),var(--teal));
  background-size:300% 300%;
  animation:progressFlow 4s ease infinite;
  transition:width 1.8s ease-out;
}
@keyframes progressFlow{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}

/* ===================== DIVIDEND TIMELINE ===================== */
#divTimeline{
  width:100%;
  height:260px;
  filter:drop-shadow(0 0 10px var(--cyan));
}

/* ===================== MOBILE ===================== */
@media(max-width:900px){
  .cinematic-grid{flex-direction:column;}
  .left-panel, .right-panel{width:100%;}
}
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const AURORA_SYNC =
"https://raw.githubusercontent.com/webbchrisuk-max/Aurora/main/AuroraSync.json";

/* ============================================================
   HOLDINGS ENGINE â€” FIXED & CLEAN
============================================================ */
function renderHoldings(sync){
  const ig = sync?.isa?.holdings?.ig_isa || [];
  const t2 = sync?.isa?.holdings?.trade212_isa || [];
  const all = [...ig, ...t2];

  if(all.length === 0){
    document.getElementById("isa-holdings-compact").innerHTML =
      "<p>No holdings found.</p>";
    return;
  }

  /* ---------- COMPACT TOP 5 ---------- */
  const top5 = [...all].sort((a,b)=>b.value-a.value).slice(0,5);

  let compact = `
    <table style="width:100%;text-align:center;">
      <tr style="color:var(--cyan);font-weight:700;">
        <td>Ticker</td><td>Value</td><td>Gain</td>
      </tr>
  `;
  top5.forEach(h=>{
    const col = h.gain_value >= 0 ? "var(--gainGreen)" : "var(--pink)";
    compact += `
      <tr>
        <td>${h.ticker}</td>
        <td>Â£${h.value.toFixed(2)}</td>
        <td style="color:${col};">Â£${h.gain_value.toFixed(2)}</td>
      </tr>`;
  });
  compact += `</table>`;
  document.getElementById("isa-holdings-compact").innerHTML = compact;

  /* ---------- FULL TABLE ---------- */
  let full = `
    <table style="width:100%;text-align:center;">
      <tr style="color:var(--teal);font-weight:700;">
        <td>Ticker</td><td>Shares</td><td>Price</td>
        <td>Value</td><td>Gain Â£</td><td>Gain %</td><td>Yield</td>
      </tr>
  `;
  all.forEach(h=>{
    const col = h.gain_value >= 0 ? "var(--gainGreen)" : "var(--pink)";
    full += `
      <tr>
        <td>${h.ticker}</td>
        <td>${h.shares}</td>
        <td>Â£${h.live_price.toFixed(2)}</td>
        <td>Â£${h.value.toFixed(2)}</td>
        <td style="color:${col};">Â£${h.gain_value.toFixed(2)}</td>
        <td style="color:${col};">${h.gain_percentage.toFixed(2)}%</td>
        <td>${h.annual_div_yield.toFixed(2)}%</td>
      </tr>`;
  });
  full += `</table>`;
  document.getElementById("isa-holdings-full").innerHTML = full;
}

/* ============================================================
   JSON LOADER + INIT
============================================================ */
async function loadJSON(url){
  const r = await fetch(url + "?nocache=" + Date.now());
  return r.json();
}

async function initAurora(){
  const sync = await loadJSON(AURORA_SYNC);

  renderPortfolio(sync);
  renderTescoSections(sync);
  renderSayeProgress(sync);
  renderDividendTimeline(sync);
  renderUpcomingDividends(sync);
  renderDividendHistory(sync);
  renderNextExDiv(sync);

  /* ðŸ”¥ FIXED: HOLDINGS NOW RENDERS */
  renderHoldings(sync);
}
</script>

</head>
<body onload="initAurora()">

<h1 style="
  text-align:center;margin-top:25px;color:var(--cyan);
  font-size:30px;text-shadow:0 0 18px var(--cyan);
">
ðŸŒŒ Aurora ISA Tracker â€“ Cinematic Edition v2
</h1>

<div style="
  width:100%;height:3px;
  background:linear-gradient(90deg,var(--cyan),var(--purple),var(--teal));
  margin:15px auto 25px auto;max-width:800px;
  border-radius:12px;box-shadow:0 0 16px var(--cyan);
"></div>

<div class="cinematic-grid">

<!-- ===================== LEFT PANEL ===================== -->
<div class="left-panel">

  <!-- PORTFOLIO SUMMARY -->
  <div class="holo-card">
    <div class="section-header">ðŸ“Š Portfolio Summary</div>
    <div id="portfolio-summary"></div>
  </div>

  <!-- ===================== HOLDINGS ===================== -->
  <div class="holo-card">
    <div class="section-header">ðŸ“ˆ ISA Holdings</div>

    <!-- Compact -->
    <div id="isa-holdings-compact"></div>

    <!-- Expander -->
    <div class="expander-toggle">View Full Holdings â–¼</div>
    <div class="expander-content">
      <div class="expander-content-inner" id="isa-holdings-full"></div>
    </div>
  </div>

  <!-- ===================== TESCO ===================== -->
  <div class="holo-card">
    <div class="section-header">ðŸ›’ Tesco SIP â€¢ SAYE â€¢ ISA Migration</div>

    <div class="expander-toggle">SIP Shares â–¼</div>
    <div class="expander-content"><div class="expander-content-inner" id="tesco-sip"></div></div>

    <div class="expander-toggle">SAYE Plan â–¼</div>
    <div class="expander-content"><div class="expander-content-inner" id="tesco-saye"></div></div>

    <div class="expander-toggle">ISA Migration â–¼</div>
    <div class="expander-content"><div class="expander-content-inner" id="tesco-migration"></div></div>

    <div class="expander-toggle">Aurora SAYE Progress â–¼</div>
    <div class="expander-content">
      <div class="expander-content-inner">

        <h3 style="color:var(--cyan);margin-bottom:10px;">SAYE Progress</h3>

        <div id="saye-progress-wrap"><div id="saye-progress-bar"></div></div>
        <div style="margin-bottom:15px;">
          <span id="saye-progress-text" style="color:var(--teal);font-weight:700;">0%</span> complete
        </div>

        <h3 style="color:var(--cyan);margin-bottom:6px;">Time Remaining</h3>
        <div id="saye-countdown" style="color:var(--amber);margin-bottom:14px;">Loadingâ€¦</div>

        <div class="expander-row"><span class="expander-label">Saved to Date</span><span class="expander-value" id="saye-saved"></span></div>
        <div class="expander-row"><span class="expander-label">Funds Pending</span><span class="expander-value" id="saye-pending"></span></div>
        <div class="expander-row"><span class="expander-label">Total Option Cost</span><span class="expander-value" id="saye-total"></span></div>
        <div class="expander-row"><span class="expander-label">Maturity Date</span><span class="expander-value" id="saye-end"></span></div>

      </div>
    </div>

  </div>

</div><!-- LEFT -->

<!-- ===================== RIGHT PANEL ===================== -->
<div class="right-panel">

  <div class="holo-card">
    <div class="section-header">ðŸ“ˆ Dividend Timeline</div>
    <canvas id="divTimeline"></canvas>
  </div>

  <div class="holo-card">
    <div class="section-header">ðŸ“† Upcoming Dividends</div>
    <div id="upcoming-dividends-limited"></div>
    <div class="expander-toggle" id="toggle-upcoming">Show More â–¼</div>

    <div class="expander-content">
      <div class="expander-content-inner" id="upcoming-dividends-full"></div>
    </div>
  </div>

  <div class="holo-card">
    <div class="section-header">ðŸ“œ Dividend History</div>
    <div class="expander-toggle">View History â–¼</div>
    <div class="expander-content">
      <div class="expander-content-inner" id="dividend-history"></div>
    </div>
  </div>

  <div class="holo-card">
    <div class="section-header">ðŸ”” Next Ex-Dividend Dates</div>
    <div id="next-exdiv"></div>
  </div>

</div><!-- RIGHT -->

</div><!-- GRID -->

<script>
/* ---------- Expanders ---------- */
document.addEventListener("click",e=>{
  if(!e.target.classList.contains("expander-toggle")) return;
  const t=e.target;
  const c=t.nextElementSibling;

  if(c.style.maxHeight){
    c.style.maxHeight = null;
    t.textContent = t.textContent.replace("â–²","â–¼");
  } else {
    c.style.maxHeight = c.scrollHeight + "px";
    t.textContent = t.textContent.replace("â–¼","â–²");
  }
});
</script>

</body>
</html>
